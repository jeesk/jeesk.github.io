"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[907],{2675:function(t){t.exports=JSON.parse('{"blogPosts":[{"id":"google-guice-source","metadata":{"permalink":"/java/google-guice-source","source":"@site/java/2022-04-16-google-juice-source.md","title":"google guice \u6846\u67b6\u6e90\u7801\u5b66\u4e60","description":"1. Google Guice \u6846\u67b6\u7b80\u4ecb","date":"2022-04-16T00:00:00.000Z","formattedDate":"April 16, 2022","tags":[{"label":"java","permalink":"/java/tags/java"},{"label":"DI","permalink":"/java/tags/di"},{"label":"IOC","permalink":"/java/tags/ioc"}],"readingTime":15.57,"truncated":false,"authors":[{"name":"jeesk","title":"java engineer","url":"https://shanjiancaofu.com","imageURL":"https://shanjiancaofu.com/img/avtor.png","key":"jeesk"}],"frontMatter":{"slug":"google-guice-source","title":"google guice \u6846\u67b6\u6e90\u7801\u5b66\u4e60","tags":["java","DI","IOC"],"authors":["jeesk"]},"nextItem":{"title":"java \u6e90\u7801\u5206\u6790","permalink":"/java/java \u6e90\u7801\u5206\u6790"}},"content":"##\\t1. Google Guice \u6846\u67b6\u7b80\u4ecb\\r\\n\\r\\n\\r\\n\\r\\n> \u200b\\t\u672c\u6587\u6709\u5927\u91cf\u7684\u622a\u56fe\u548c\u89e3\u91ca\uff0c \u4e0d\u59a8\u7528idea\u8fb9\u8c03\u8bd5\u8fb9\u770b\u6587\u7ae0\u3002 \\r\\n\\r\\n\\r\\n\\r\\n\u200b\\t\u5728\u5b66\u4e60 `Spring` \u7684\u65f6\u5019\uff0c \u6211\u4eec\u5e38\u5e38\u4e60\u60ef\u7528 `@Bean` \u5c06Bean\u7684\u521b\u5efa\u4ea4\u7ed9spirng \u6765\u7ba1\u7406\uff0c \u4f7f\u7528 `@Autowire` \u5b9e\u73b0\u4f9d\u8d56\u81ea\u52a8\u6ce8\u5165Bean\u3002\\r\\n\\r\\n```java\\r\\n@Configuration\\r\\nclass MyBean{\\r\\n @Bean\\r\\n public Person person {\\r\\n \\t return new Person();\\r\\n }\\r\\n}\\r\\n\\r\\nclass ABCService {\\r\\n    @Autowore\\r\\n    private Person Person;\\r\\n}\\r\\n```\\r\\n\\r\\n\u200b\\t\\t\u5728Spring \u7684\u9879\u76ee\u4e2d\u53ef\u4ee5\u968f\u4fbf\u4f7f\u7528\uff0c \u5728\u6ca1\u6709Spring \u7684\u9879\u76ee\u4f7f\u7528 DI \u548cIOC \uff0c\u8981\u5f15\u5165 `spring-core` , \u663e\u5f97\u4e0d\u662f\u90a3\u4e48\u53cb\u597d\uff0c\u4e00\u4e9b\u4e0d\u60f3\u7528spring \u6846\u67b6\u7684\u516c\u53f8\u5c31\u4f1a\u9020\u51fa\u4e00\u4e9b\u8f6e\u5b50\uff0c\u6bd4\u5982Google \u516c\u53f8\u51fa\u4e86\u4e00\u6b3e\u8f7b\u91cf\u7684IOC \u6846\u67b6\uff0c \u4e0b\u9762\u6211\u4eec\u6765\u7814\u7a76\u7814\u7a76\u3002\\r\\n\\r\\n\u672c\u6587\u6e90\u7801\u5c06\u4f1a\u4f7f\u7528 google juice \u7684\u7b2c\u4e00\u4e2a\u7248\u672c\u7248\u672c\u53f7\u4e3a\uff1a`66b415a2066cac9f36ed58070777de388f63a3a4 `\uff0c\u8fd9\u4e2a\u7248\u672c\u5927\u7ea6\u572820\u4e2a\u7c7b\u5de6\u53f3\uff0c\u57fa\u4e8ejdk 1.5\u7684\uff0c\u8fd9\u4e2a\u7248\u672c\u4ee3\u7801\u76f8\u5bf9\u6765\u8bf4\u975e\u5e38\u5c11\u3002  \u4e0b\u9762\u6211\u4eec\u5e26\u7740\u76ee\u7684\u53bb\u7814\u7a76\u4ee3\u7801\u3002\\r\\n\\r\\n##\\t2. \u5982\u4f55Bean\u521b\u5efa\u548c\u7ba1\u7406\\r\\n\\r\\n\u4e0b\u9762\u662fguice\u6846\u67b6\u5c06Bar\u63a5\u53e3\u548c\u5b9e\u73b0\u7c7bBarImpl\u7ed1\u5b9a\u7684\u4ee3\u7801\uff0c\u5e76\u4e14\u83b7\u53d6Bar\u7c7b\u578b\u7684\u5b9e\u4f8b\u5bf9\u8c61\u3002\\r\\n\\r\\n```java\\r\\n  public void testManageBean(){\\r\\n    ContainerBuilder builder = new ContainerBuilder();\\r\\n    builder.factory(Bar.class, BarImpl.class);\\r\\n    Container container = builder.create(false);\\r\\n    Bar instance = container.getInstance(Bar.class);\\r\\n    System.out.println(instance);\\r\\n  }\\r\\n```\\r\\n\\r\\n\u200b\\t    \u9996\u5148\u521b\u5efa\u4e86\u4e00\u4e2a\u5bb9\u5668Builder\uff0c \u518d\u5c06Bar \u548cBarImpl \u653e\u5165factory \u65b9\u6cd5\u4e2d\uff0c \u518d\u8c03\u7528create() \u521b\u5efa\u51fa\u5bb9\u5668\uff0c \u6700\u540e\u901a\u8fc7getInstance() \u65b9\u6cd5\u6765\u83b7\u53d6\u5b9e\u4f8b\u3002\u4e0b\u9762\u770b\u6846\u67b6\u4ee3\u7801\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u3002\\r\\n\\r\\n###\\t 1.  \u521b\u5efaContainerBuilder\\r\\n\\r\\n`ContainerBuilder builder = new ContainerBuilder();`\\r\\n\\r\\n\u9996\u5148\u770b\u770b\u6ce8\u91ca\\r\\n\\r\\n```english\\r\\nBuilds a dependency injection {@link Container}. The combination of\\r\\n dependency type and name uniquely identifies a dependency mapping; you can\\r\\nuse the same name for two different types. Not safe for concurrent use.\\r\\n```\\r\\n\\r\\n\u6784\u5efa\u4e00\u4e2a\u4f9d\u8d56\u6ce8\u5165\uff0c \u4f9d\u8d56\u7684\u7c7b\u578b\u548c\u552f\u4e00\u7684\u540d\u5b57\u4f5c\u4e3a\u6620\u5c04\uff0c\u4e24\u4e2a\u4e0d\u540c\u7684\u7c7b\u578b\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u540d\u5b57\uff08\u597d\u50cfspring \u4e0d\u53ef\u4ee5\u8fd9\u6837\uff09\uff0c \u8fd9\u4e2a\u7c7b\u5e76\u53d1\u4e0d\u5b89\u5168\u3002\\r\\n\\r\\n\u8fd9\u91cc\u8bf4\u4e00\u4e0bContainerBuilder \u91cc\u9762\u7684\u4e09\u4e2a\u53d8\u91cf\uff0c \u540e\u9762\u4f1a\u7528\u5230\u3002\\r\\n\\r\\n```java\\r\\n  final Map<Key<?>, InternalFactory<?>> factories =   new HashMap<Key<?>, InternalFactory<?>>();\\r\\n  final List<InternalFactory<?>> singletonFactories = new ArrayList<InternalFactory<?>>();\\r\\n  final List<Class<?>> staticInjections = new ArrayList<Class<?>>();\\r\\n  boolean created;\\r\\n```\\r\\n\\r\\n1. factories             \u63a5\u53e3\u7c7b\u578b\u548c\u5b9e\u4f8b\u5de5\u5382\u7684\u6620\u5c04\\r\\n1. singletonFactories    \u5355\u4f8bbean\u7684\u5de5\u5382\uff0c \u6240\u6709\u751f\u547d\u5468\u671f\u662f\u5355\u4f8b\u7684\u90fd\u4f1a\u52a0\u5165\u8fd9\u4e2a\u96c6\u5408\\r\\n2. staticInjections  \u9700\u8981\u9759\u6001\u6ce8\u5165\u7684Class \u7c7b\u96c6\u5408\\r\\n4. created               \u8868\u793a\u8be5\u5bb9\u5668\u662f\u5426\u5df2\u7ecf\u521b\u5efa\uff0c\u56e0\u4e3a\u5bb9\u5668\u662f\u662f\u975e\u7ebf\u7a0b\u5b89\u5168\uff0c\u6240\u4ee5\u7528\u8fd9\u4e2a\u5b57\u6bb5\u6807\u8bb0\u4e00\u4e0b\\r\\n\\r\\n\u4e0b\u9762\u5f00\u542fidea debug \u6a21\u5f0f\u8d70\u8d77\u3002\\r\\n\\r\\n1. builder.factory(Bar.class, BarImpl.class);\\r\\n\\r\\n   ![image-20220416135734557](2022-04-16-google-juice-source.assets/image-20220416135734557.png)\\r\\n\\r\\n    1. \u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe1\\r\\n\\r\\n\\r\\n\\r\\n![image-20220416135800301](2022-04-16-google-juice-source.assets/image-20220416135800301.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe2\\r\\n\\r\\n![image-20220416135815906](2022-04-16-google-juice-source.assets/image-20220416135815906.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe3\\r\\n\\r\\n\\r\\n\\r\\n\u4ece\u4ee3\u7801\u53d1\u73b0\u4e86\u65b9\u6cd5\u518d\u6b21\u91cd\u8f7d\uff0c \u540c\u65f6\u7ed9\u5bb9\u5668\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u9ed8\u8ba4\u7684\u540d\u5b57\u3002 \u4e0b\u9762\u518d\u8fdbfactory() \u65b9\u6cd5\u91cc\u9762\u770b\\r\\n\\r\\n\\r\\n\\r\\n![image-20220416140009260](2022-04-16-google-juice-source.assets/image-20220416140009260.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe4\\r\\n\\r\\n201\u884c\u7684\u4ee3\u7801\u751f\u6210\u4e86\u4e00\u4e2a\u5de5\u5382\u7c7b\uff0c \u8fd9\u4e2a\u5de5\u5382\u7c7b\u901a\u8fc7\u6784\u9020\u5668\u521b\u5efa\u4e00\u4e2a\u5b9e\u4f8b\u3002\u540c\u65f6\u5b9e\u73b0\u7c7b\u653e\u5230\u4e86implementation  \u5b57\u6bb5\u91cc\u9762\u4e86\u3002 \u518d\u7ee7\u7eeddebug\\r\\n\\r\\n![image-20220416140517464](2022-04-16-google-juice-source.assets/image-20220416140517464.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe5\\r\\n\\r\\n\u7b2c92 \u884c\u628akey\u548c\u5bf9\u5e94\u7684\u751f\u547d\u5468\u671f\u5de5\u5382\u7c7b\u653e\u5165\u4e86\u4e00\u4e2a\u88ab\u5c01\u88c5\u540e\u7684\u5de5\u5382\uff0c\u8fd9\u91cc\u4e3a\u4ec0\u4e48\u4f1a\u7528scope \u6765\u5c01\u88c5\u4e00\u4e0b\u5462\uff1f \u4e3b\u8981\u662f\u56e0\u4e3a\u4e0d\u540c\u7684\u751f\u547d\u5468\u671f\u6709\u4e0d\u540c\u7684\u521b\u5efa\u65b9\u5f0f\u3002 \u6bd4\u5982\u5355\u4f8b\u53ea\u9700\u8981\u521b\u5efa\u4e00\u6b21\u5373\u53ef\u3002\u4ece\u4e0b\u56fe\u7684\u4ee3\u7801\u768447\u884c\u4e2d\u53ef\u4ee5\u770b\u5230Singleton \u7684 scopeFactory  \u65b9\u6cd5\u52a0\u4e86\u9501\uff0c \u8fd9\u662f\u4fdd\u8bc1\u5355\u4f8b\u5b89\u5168\u3002\\r\\n\\r\\n![image-20220416140847252](2022-04-16-google-juice-source.assets/image-20220416140847252.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe6\\r\\n\\r\\n\u9ed8\u8ba4\u5de5\u5382\uff0c\u76f4\u63a5\u8fd4\u56de\u5de5\u5382\u5c31\u884c\u3002\\r\\n\\r\\n![image-20220416140923405](2022-04-16-google-juice-source.assets/image-20220416140923405.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe7\\r\\n\\r\\n### 2. \u521b\u5efa\u5bb9\u5668\\r\\n\\r\\n`builder.create(false)`\\r\\n\\r\\n![image-20220416142457081](2022-04-16-google-juice-source.assets/image-20220416142457081.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe8\\r\\n\\r\\n1. ensureNotCreated \u56e0\u4e3aBuilder\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u6240\u4ee5\u5148\u786e\u4fdd\u4e0d\u4f1a\u88ab\u521b\u5efa\u3002\u5c06factoryies  \u653e\u5165ContainerImpl \u91cc\u9762\uff0c \u56e0\u4e3aloadSingletons\u662ffalse\uff0c \u540c\u65f6\u6211\u4eec\u4e5f\u6ca1\u6709\u9759\u6001\u5b57\u6bb5(\u8fd9\u4e24\u884c\u4ee3\u7801\u5148\u4e0d\u5173\u6ce8\uff0c\u540e\u9762\u4f1a\u8bf4\uff09\u3002\u6240\u4ee5\u76f4\u63a5\u5c06\u5bb9\u5668\u8fd4\u56de\u3002\\r\\n\\r\\n###\\t3.\\t\u83b7\u53d6\u5b9e\u4f8b\\r\\n\\r\\n`Bar instance = container.getInstance(Bar.class);`\\r\\n\\r\\n![image-20220416143220942](2022-04-16-google-juice-source.assets/image-20220416143220942.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe9\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\tcallable.call(reference[0]) \u56de\u8c03\u4e86487\u884c\u7684getInstance(type, context)\uff0c \u518d\u7ee7\u7eed\u6df1\u5165\\r\\n\\r\\n\\r\\n\\r\\n\u200b\\t\\t\\t![image-20220416143523366](2022-04-16-google-juice-source.assets/image-20220416143523366.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe10\\r\\n\\r\\n447 \u884c\u4ee3\u7801\u4f7f\u7528Bar\u7684Class\u7c7b\u578b\u548c\u540d\u5b57\u521b\u5efa\u4e86\u4e2aKey\u7c7b\u578b\u5b9e\u4f8b\uff0c \u901a\u8fc7key\u5bf9\u8c61\u53bbfactories \u5bf9\u8c61\u91cc\u9762\u62ff\u5230\u5bf9\u5e94\u7684\u5de5\u5382\u7c7b\uff0c \u518d\u521b\u5efaBar\u5b9e\u73b0\u7684\u5b9e\u4f8b\u3002 \u6beb\u65e0\u7591\u95ee\u4e0b\u9762\u53c8\u4f1a\u8c03\u7528\u521b\u5efa\u5b9e\u4f8b\u7684create\u65b9\u6cd5\u3002\\r\\n\\r\\n![image-20220416143746681](2022-04-16-google-juice-source.assets/image-20220416143746681.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe11\\r\\n\\r\\n###\\t4.  \u5c0f\u7ed3\\r\\n\\r\\n\u200b\\t\\tguice\u5c06\u63a5\u53e3\u7684\u7c7b\u578b\uff0c\u540d\u5b57\u7b49\u751f\u6210\u4e00\u4e2akey\uff0c \u7136\u540e\u751f\u6210\u8be5\u63a5\u53e3\u5b9e\u73b0\u7c7b\u7684\u5de5\u5382\u7c7b\uff0c \u540c\u65f6\u5c06Key\u548c\u5de5\u5382\u7c7b\u5b9e\u4f8b\u653e\u5165map\u91cc\u9762\uff0c \u518d\u5c06map\u653e\u5165\u5bb9\u5668\u7c7b\u91cc\u9762\u3002\u5f53Containner.getInsance() \u83b7\u53d6\u5b9e\u4f8b\u7684\u65f6\u5019\uff0c \u9996\u5148\u901a\u8fc7\u63a5\u53e3\u7c7b\u578b\u548c\u540d\u5b57\u751f\u6210key\uff0c \u53bbMap \u91cc\u9762\u53bb\u627e\u5230\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\u7684\u5de5\u5382\u7c7b\uff0c \u518d\u8c03\u7528create \u65b9\u6cd5\u751f\u6210\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\u3002\\r\\n\\r\\n\\r\\n\\r\\n##\\t3. \u4f9d\u8d56\u6ce8\u5165\u5982\u4f55\u5b9e\u73b0\\r\\n\\r\\n```java\\r\\n   public void testInjection() {\\r\\n    Container container = createFooContainer();\\r\\n    Foo foo = container.inject(Foo.class);\\r\\n  }\\r\\n  static class Foo {\\r\\n    @Inject Bar bar;\\r\\n    @Inject Bar copy;\\r\\n    @Inject(\\"s\\") String s;\\r\\n    int i;\\r\\n    @Inject(\\"i\\")\\r\\n    void setI(int i) {\\r\\n      this.i = i;\\r\\n    }\\r\\n  }\\r\\n  private Container createFooContainer() {\\r\\n    ContainerBuilder builder = new ContainerBuilder();\\r\\n    builder\\r\\n      .factory(Bar.class, BarImpl.class)\\r\\n      .factory(Tee.class, TeeImpl.class)\\r\\n      // \u6307\u5b9a\u5b57\u6bb5s,i \u6ce8\u5165\\r\\n      .constant(\\"s\\", \\"test\\")\\r\\n      .constant(\\"i\\", 5);\\r\\n\\r\\n    return builder.create(false);\\r\\n  }\\r\\n\\r\\n```\\r\\n\\r\\n\u540d\u5b57\u53ebFoo\u7684\u7c7b\u91cc\u9762\u7684bar \u548ccopy \u548cs\uff0c \u8fd8\u6709\u5b57\u6bb5i\uff0c \u90fd\u662f\u4f7f\u7528\u4e86@Inject \u6ce8\u89e3\u7684\uff0c \u8bf4\u660e\u8fd9\u4e9b\u5b57\u6bb5\u90fd\u662f\u9700\u8981\u6ce8\u5165\u7684\u3002\\r\\n\\r\\n###\\t1.\\t\u9996\u5148\u521b\u5efa\u5bf9\u8c61\\r\\n\\r\\n1. Foo foo = container.inject(Foo.class);\\r\\n\\r\\n   ![image-20220416145409582](2022-04-16-google-juice-source.assets/image-20220416145409582.png)\\r\\n\\r\\n   \u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe12\\r\\n\\r\\n\\r\\n\\r\\n![image-20220416145540216](2022-04-16-google-juice-source.assets/image-20220416145540216.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe13\\r\\n\\r\\n\\r\\n\\r\\n![image-20220416150031356](2022-04-16-google-juice-source.assets/image-20220416150031356.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe14\\r\\n\\r\\n\u6211\u4eec\u53d1\u73b0\uff0c \u6700\u540e\u5176\u5b9e\u5728\u8c03\u7528472\u884c\u4e2dinject \u65b9\u6cd5\u3002 \u7ee7\u7eeddebug \u770b\u770binject \u65b9\u6cd5\u5230\u5e95\u5728\u5e72\u4ec0\u4e48\u3002\\r\\n\\r\\n![image-20220416150225452](2022-04-16-google-juice-source.assets/image-20220416150225452.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe15\\r\\n\\r\\ngetConstructor(implementation) \uff0c \u62ff\u5230\u6784\u9020\u5668\u8c03\u7528construct \u521b\u5efa\u5bf9\u8c61\u3002 \u7ee7\u7eed\u5411\u4e0b\u9762\u770b\\r\\n\\r\\n![image-20220416150619122](2022-04-16-google-juice-source.assets/image-20220416150619122.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe16(\u8bf7\u5ffd\u7565\u56fe\u91cc\u8bf4\u7684\u521b\u5efa\u4ee3\u7406\u5bf9\u8c61\uff0c\u8fd9\u662f\u521b\u5efa\u6784\u9020\u5668\u5bf9\u8c61)\\r\\n\\r\\n\u4e3aFoo\u521b\u5efa\u5bf9\u8c61\uff0c\u5e76\u4e14\u5c06\u521b\u5efa\u5bf9\u8c61\u8bbe\u7f6e\u5230\u4ee3\u7406\u4e2d\uff08\u8fd9\u91cc\u4ee3\u7406\u7528\u4e0d\u4e0a\uff0c\u540e\u9762\u5728\u89e3\u51b3\u5faa\u73af\u4f9d\u8d56\u7684\u65f6\u5019\u4f1a\u8bf4\uff09\uff0c\u5e76\u4e14\u62ff\u5230\u4e86\u8be5\u7c7b\u7684\u6ce8\u5165\u5668\u5bf9\u8c61injectors (\u5728373\u884c\uff09\uff0c \u8fd9\u4e2a\u6ce8\u5165\u5668\u5bf9\u8c61\u4ece\u54ea\u513f\u6765\u7684\uff1f \u4e3a\u4ec0\u4e48\u6211\u4eecdebug \u6ca1\u6709\u51fa\u6765\uff1f \u8fd9\u91cc\u5176\u5b9e\u5728\\r\\n\\r\\n\u56fe15\u7684433 \u884c\u4ee3\u7801\u4e2d\u7684  `ConstructorInjector constructor = getConstructor(implementation); `  \uff0c \u8c03\u7528\u7236\u7c7b\u7684\u5f02\u6b65\u65b9\u6cd5\u53bb\u83b7\u53d6\u6ce8\u5165\u5668\u3002 \u6846\u67b6\u91cc\u9762\u6709\u4e2a\u7c7b\u662f ReferenceCache\uff0c \u7528\u6765\u505a\u7f13\u5b58\u7684\uff0c \u91cc\u9762\u5f88\u591a\u7684\u5f02\u6b65\u64cd\u4f5c\u3002 \u4f46\u662f\u4eca\u5929\u6211\u4eec\u4e0d\u7814\u7a76\u8fd9\u4e2a\uff0c \u6240\u4ee5\u76f4\u63a5\u7565\u8fc7\u3002\\r\\n\\r\\n![image-20220416151157660](2022-04-16-google-juice-source.assets/image-20220416151157660.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe17\\r\\n\\r\\n###\\t 2.\\t\u6ce8\u5165\u5b57\u6bb5\\r\\n\\r\\n\u901a\u8fc7\u6784\u9020\u5668\u7684\u53bb\u62ff\u5230injects \u5bf9\u8c61\u96c6\u5408, \u521a\u597d\u662f4\u4e2a\uff0c \u56de\u60f3\u4e00\u4e0bFoo \u91cc\u9762\u7684\u5b57\u6bb5\u548c\u9759\u6001\u65b9\u6cd5\u4e5f\u662f4\u4e2a\u3002\u6211\u4eec\u7ee7\u7eed debug ` injector.inject(context, t)`\\r\\n\\r\\n![image-20220416152821637](2022-04-16-google-juice-source.assets/image-20220416152821637.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe18\\r\\n\\r\\n\u5982\u56fe18 \u6240\u793a\uff0c \u901a\u8fc7\u53cd\u5c04\u5c06\u5b57\u6bb5\u6ce8\u5165\u8fdb\u53bb\u3002 \u8fd9\u5c31\u662f\u6846\u67b6\u6ce8\u5165\u7684\u6b65\u9aa4\u3002\\r\\n\\r\\n###\\t3.\\t\u5c0f\u7ed3\\r\\n\\r\\n1. \u521b\u5efa\u4ee3\u7406\u5bf9\u8c61\\r\\n2. \u901a\u8fc7@Inject \u83b7\u53d6\u6ce8\u5165\u5668\uff0c\u4f7f\u7528\u53cd\u5c04\u6ce8\u5165\u5bf9\u5e94\u7684\u5b57\u6bb5\\r\\n\\r\\n\\r\\n\\r\\n##\\t4. \u5904\u7406\u4f9d\u8d56\u5faa\u73af\\r\\n\\r\\n```java\\r\\n  @Scoped(SINGLETON)\\r\\n  static class AImpl implements A {\\r\\n    final B b;\\r\\n    @Inject public AImpl(B b) {\\r\\n      this.b = b;\\r\\n    }\\r\\n    public B getB() {\\r\\n      return b;\\r\\n    }\\r\\n  }\\r\\n\\r\\n  interface B {\\r\\n    A getA();\\r\\n  }\\r\\n\\r\\n  static class BImpl implements B {\\r\\n    final A a;\\r\\n    @Inject public BImpl(A a) {\\r\\n      this.a = a;\\r\\n    }\\r\\n    public A getA() {\\r\\n      return a;\\r\\n    }\\r\\n  }\\r\\n```\\r\\n\\r\\n####\\t1.\\t\u5148\u521b\u5efaAImpl\u7684\u6784\u9020\u5668\\r\\n\\r\\nAImpl \u548c BImpl \u76f8\u4e92\u4f9d\u8d56\uff0c\u5e76\u4e14AImpl\u662f\u5355\u4f8b\uff0c \u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c \u6846\u67b6\u662f\u5982\u4f55\u5904\u7406\u5faa\u73af\u4f9d\u8d56\u7684\u5462\u3002\\r\\n\\r\\n![image-20220416155136101](2022-04-16-google-juice-source.assets/image-20220416155136101.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe19\\r\\n\\r\\n![image-20220416155237541](2022-04-16-google-juice-source.assets/image-20220416155237541.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe20\\r\\n\\r\\n####\\t2.\\t\u5f53\u53d1\u73b0\u81ea\u5df1\u7684\u6784\u9020\u5668\u53c2\u6570\u91cc\u9762\u6709\u5176\u5b83\u53c2\u6570\u65f6\uff0c\u5148\u521b\u5efa\u53c2\u6570\u5bf9\u8c61\\r\\n\\r\\n\u5148Inject \u53c2\u6570B\uff0c\u76f8\u5f53\u4e8e\u521b\u5efaB\\r\\n\\r\\n![image-20220416155430941](2022-04-16-google-juice-source.assets/image-20220416155430941.png)\\r\\n\\r\\n![image-20220416155548515](2022-04-16-google-juice-source.assets/image-20220416155548515.png)\\r\\n\\r\\n![image-20220416155616081](2022-04-16-google-juice-source.assets/image-20220416155616081.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe21\\r\\n\\r\\n\u8fdb\u5165B\u7684\u53c2\u6570\u6784\u9020\u5668\uff0c \u8fd9\u4e2a\u65f6\u5019B\u7684\u6784\u9020\u5668\u53c2\u6570\u91cc\u9762\u9700\u8981AImpl\u7684\u5b9e\u4f8b\u5bf9\u8c61\uff0c\\r\\n\\r\\n![image-20220416155723093](2022-04-16-google-juice-source.assets/image-20220416155723093.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe22\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u53c8\u53bb\u521b\u5efaAImpl\u7684\u5355\u4f8b\u5bf9\u8c61\u3002\\r\\n\\r\\n![image-20220416160838526](2022-04-16-google-juice-source.assets/image-20220416160838526.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe23\\r\\n\\r\\n####\\t3. \u53c2\u6570\u5bf9\u8c61\u521b\u5efa\u5b8c\u6210\u540e, \u518d\u521b\u5efaAImpl\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u540c\u65f6\u5c06\u6301\u6709AImpl\u7684\u4ee3\u7406\u5bf9\u8c61\u91cd\u65b0\u8bbe\u7f6e\u4e3a\u65b0\u7684Aimpl\u7684\u5b9e\u4f8b\u5bf9\u8c61\\r\\n\\r\\n\u5224\u65adA\u7684\u6784\u9020\u5668\u5df2\u7ecf\u6784\u9020\u597d\u4e86\uff0c \u5c31\u4f1a\u4e3aB\u5bf9\u8c61\u7684AImpl\u521b\u5efa\u4ee3\u7406\u5bf9\u8c61\u3002 \u5c31\u662f\u4e0b\u9762\u7684\u65b9\u6cd5\u3002 \u8fd9\u4e2a\u65f6\u5019B\u6301\u6709\u7684\u5176\u5b9e\u662fAImpl\u7684\u4ee3\u7406\u5bf9\u8c61\u3002\\r\\n\\r\\n```java\\r\\nif (constructionContext.isConstructing()) {\\r\\n  // TODO (crazybob): if we can\'t proxy this object, can we proxy the\\r\\n  // other object?\\r\\n  return constructionContext.createProxy(expectedType);\\r\\n}\\r\\n\\r\\n```\\r\\n\\r\\n\u56e0\u4e3a\u5728\u7b2c\u4e00\u6b21\u521b\u5efaAimpl\u7684\u65f6\u5019\uff0c\u5df2\u7ecf \u8d4b\u503c\u4e86 this.constructing = true\u3002 \u4e0b\u6b21\u5728\u521b\u5efa\u7684\u65f6\u5019\u5982\u679c\u662f\u5728\u4e00\u4e2a\u4e0a\u4e0b\u6587\u4e2d\u3002\u4e0b\u9762\u7684\u4ee3\u7801\u56fe21\u7684357 \u8c03\u7528\u7684\u3002\\r\\n\\r\\n```\\r\\n  void startConstruction() {\\r\\n    this.constructing = true;\\r\\n  }\\r\\n```\\r\\n\\r\\n\\r\\n\\r\\n\u73b0\u5728B\u7684Aimpl\u7684\u4ee3\u7406\u5bf9\u8c61\u521b\u5efa\u597d\u4e86\uff0cB\u7684\u5bf9\u8c61\u4e5f\u521b\u5efa\u597d\u4e86\u3002\u90a3\u4e48\u5c31\u8981\u7ee7\u7eed\u521b\u5efaAImpl\u7684\u5b9e\u4f8b\u5bf9\u8c61\u3002\\r\\n\\r\\n![image-20220416160217777](2022-04-16-google-juice-source.assets/image-20220416160217777.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u56fe24\\r\\n\\r\\n\u521b\u5efa\u5b8cAImpl\u7684\u5bf9\u8c61\u4e4b\u540e\uff0c \u518d\u5c06AImpl\u7684\u771f\u5b9e\u5bf9\u8c61\uff0c B\u6301\u6709\u7684InvocationHanlder.setDelegate(\u771f\u5b9e\u5bf9\u8c61) \u5373\u53ef\u3002 \u662f\u4e0d\u662f\u5f88\u5999 \uff1f  \u54ce\uff0c \u4e0d\u5f97\u4e0d\u4f69\u670d\u5927\u795e\u57282006 \u5e74\u5c31\u80fd\u5199\u51fa\u8fd9\u79cd\u4ee3\u7801\uff0c \u592a\u5389\u5bb3\u5566\u3002  guice\u6846\u67b6\u91cc\u9762\u89e3\u51b3\u4f9d\u8d56\u5faa\u73af\u7684\u662f ConstructionContext \u8fd9\u4e2a\u7c7b\u3002\u5927\u5bb6\u6709\u65f6\u95f4\u53ef\u4ee5\u770b\u770b\u600e\u4e48\u89e3\u51b3\u7684\u3002 \u65e0\u8bbaAImpl\u91cc\u9762\u6709\u591a\u5c11\u4e2a\u6301\u6709A\u5bf9\u8c61\u5b9e\u4f8b\u7684\u5b57\u6bb5\uff0c \u53ea\u8981AImpl\u5b8c\u6210\u5b9e\u4f8b\u5bf9\u8c61\u521d\u59cb\u5316\u540e\uff0c \u518d\u8bbe\u7f6e\u7ed9\u6301\u6709AImpl\u5bf9\u8c61\u7684\u4ee3\u7406\u5c31\u53ef\u4ee5\u4e86\u3002\\r\\n\\r\\n\u4e0b\u9762\u518d\u770b\u770bConstructionContext \u7684\u90e8\u5206\u4ee3\u7801\\r\\n\\r\\n```java\\r\\nObject createProxy(Class<? super T> expectedType) {\\r\\n    // TODO: if I create a proxy which implements all the interfaces of\\r\\n    // the implementation type, I\'ll be able to get away with one proxy\\r\\n    // instance (as opposed to one per caller).\\r\\n\\r\\n    if (!expectedType.isInterface()) {\\r\\n      throw new DependencyException(\\r\\n          expectedType.getName() + \\" is not an interface.\\");\\r\\n    }\\r\\n\\r\\n    if (invocationHandlers == null) {\\r\\n      invocationHandlers = new ArrayList<DelegatingInvocationHandler<T>>();\\r\\n    }\\r\\n\\r\\n    DelegatingInvocationHandler<T> invocationHandler =\\r\\n        new DelegatingInvocationHandler<T>();\\r\\n    invocationHandlers.add(invocationHandler);\\r\\n\\r\\n    return Proxy.newProxyInstance(\\r\\n      expectedType.getClassLoader(),\\r\\n      new Class[] { expectedType },\\r\\n      invocationHandler\\r\\n    );\\r\\n  }\\r\\n\\r\\n  void setProxyDelegates(T delegate) {\\r\\n    if (invocationHandlers != null) {\\r\\n      for (DelegatingInvocationHandler<T> invocationHandler\\r\\n          : invocationHandlers) {\\r\\n        invocationHandler.setDelegate(delegate);\\r\\n      }\\r\\n    }\\r\\n  }\\r\\n\\r\\n```\\r\\n\\r\\n- createProxy\\r\\n\\r\\n  \u521b\u5efa\u4ee3\u7406\u5bf9\u8c61\uff0c \u5f53\u521b\u5efaB\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u5728\u521b\u5efa\u6784\u9020\u5668\u7684\u65f6\u5019\u4f1a\u5148\u521b\u5efaAImpl\u5bf9\u8c61 \uff0c \u4f46\u662fAImpl\u5b9e\u4f8b\u6784\u9020\u5668\u5df2\u7ecf\u88ab\u6807\u8bb0\uff0c \u90a3\u5c31\u521b\u5efa\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\u3002\\r\\n\\r\\n- setProxyDelegates\\r\\n\\r\\n  \u5f53B\u7684\u5bf9\u8c61\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u53c8\u8fd4\u56de\u5230AImpl\u521b\u5efa\u6784\u9020\u5668\u5bf9\u8c61\u4ee3\u7801\u7684\u5730\u65b9\uff0c\u7ee7\u7eed\u521b\u5efaAImpl\u5bf9\u8c61\u7684\u5b9e\u4f8b\uff0c \u518d\u8c03\u7528setProxyDelegates \u65b9\u6cd5\uff0c\u7ed9B\u6301\u6709\u7684Aimpl\u7684\u4ee3\u7406\u5bf9\u8c61\u4e2d\u7684delegate\u8bbe\u7f6e\u4e3aAImpl\u7684\u5b9e\u4f8b\u3002\\r\\n\\r\\n####\\t4. \u5c0f\u7ed3\\r\\n\\r\\n\u5728\u4e24\u4e2aA\uff0cB \u4e24\u4e2a\u5bf9\u8c61\u76f8\u4e92\u4f9d\u8d56\u7684\u65f6\u5019\uff0c \u9996\u5148\u521b\u5efaA\u7684\u6784\u9020\u5668\uff0c\u6807\u8bb0\u4e00\u4e0bA\u7684\u6784\u9020\u5668\u5df2\u7ecf\u521b\u5efa\uff0c\u5f53\u53d1\u73b0\u81ea\u5df1\u7684\u6784\u9020\u5668\u6709\u53c2\u6570B\u7684\u65f6\u5019\u5148\u53bb\u5e38\u89c1\u6784\u9020\u5668\u53c2\u6570B\uff0c\u5982\u679c\u6784\u9020\u5668\u4e2d\u53c2\u6570B\uff0c \u521b\u5efa\u5b9e\u4f8b\u5bf9\u8c61B\u7684\u65f6\u5019\u53d1\u73b0\u9700\u8981\u521b\u5efaA\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u65f6\u5019A\u7684\u6784\u9020\u5668\u5df2\u7ecf\u6807\u8bb0\u521b\u5efa\u4e86\uff0c \u90a3\u4e48\u5c31\u7ed9B\u8bbe\u7f6e\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\u3002\u5f53B\u521b\u5efa\u5b8c\u6210\u540e\uff0c \u518d\u521b\u5efaA\u7684\u5b9e\u4f8b\u5bf9\u8c61\uff0c \u540c\u65f6\u518d\u5c06A\u7684\u5b9e\u4f8b\u5bf9\u8c61\u8bbe\u7f6e\u7ed9B\u7684\u6301\u6709\u7684A\u7c7b\u578b\u7684\u4ee3\u7406\u5bf9\u8c61\u3002 \u8fd9\u4e2a\u4e3b\u8981\u662f\u901a\u8fc7proxy \u53bb\u5b9e\u73b0\u7684\u3002 \\r\\n\\r\\n## 5. \u9759\u6001\u6ce8\u5165\\r\\n\\r\\n  \u73b0\u5728\u6211\u4eec\u6765\u770b\u770b\u9759\u6001\u6ce8\u5165\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u3002\\r\\n\\r\\n```java\\r\\npublic class StaticInjectionTest extends TestCase {\\r\\n\\r\\n  public void testInjectStatics() {\\r\\n    Container c = new ContainerBuilder()\\r\\n        .constant(\\"s\\", \\"test\\")\\r\\n        .constant(\\"i\\", 5)\\r\\n        .injectStatics(StaticInjectionTest.Static.class)\\r\\n        .create(false);\\r\\n    assertEquals(\\"test\\", StaticInjectionTest.Static.s);\\r\\n    assertEquals(5, StaticInjectionTest.Static.i);\\r\\n  }\\r\\n\\r\\n  static class Static {\\r\\n    @Inject(\\"i\\") static int i;\\r\\n    static String s;\\r\\n    @Inject(\\"s\\") static void setS(String s) {\\r\\n      StaticInjectionTest.Static.s = s;\\r\\n    }\\r\\n  }\\r\\n```\\r\\n\\r\\n1. \u76f4\u63a5\u770b `injectStatics` \u65b9\u6cd5\u8c03\u7528\uff0c\u9996\u5148\u5c06\u9700\u8981\u6ce8\u5165\u7684\u9759\u6001\u7c7b\u8bbe\u7f6e\u52a0\u5165\u96c6\u5408\u3002\\r\\n\\r\\n   injectStatics(StaticInjectionTest.Static.class)\\r\\n\\r\\n   ![image-20220416163728265](2022-04-16-google-juice-source.assets/image-20220416163728265.png)\\r\\n\\r\\n2.   \u5728\u56fe5\u7684\u65f6\u5019\uff0c \u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u5728\u521b\u5efa\u5bb9\u5668\u65f6\u4f1a\u6267\u884c\u9759\u6001\u6ce8\u5165\u3002\u5982\u4e0b\u56fe\u6240\u793a\\r\\n\\r\\n![image-20220416163912290](2022-04-16-google-juice-source.assets/image-20220416163912290.png)\\r\\n\\r\\n\u200b\\t\\t\u6211\u4eec\u7ee7\u7eed\u770b\u6267\u884c\u9759\u6001\u6ce8\u5165\u7684\u5177\u4f53\u6d41\u7a0b\uff0c \u7ee7\u7eeddebug  `container.injectStatics(staticInjections)`\\r\\n\\r\\n![image-20220416164023068](2022-04-16-google-juice-source.assets/image-20220416164023068.png)\\r\\n\\r\\n\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\u4e0b\u9762\u7ee7\u7eed\u770baddInjectorsForMembers \u65b9\u6cd5\u505a\u4e86\u4ec0\u4e48\uff1f\\r\\n\\r\\n![image-20220416164306372](2022-04-16-google-juice-source.assets/image-20220416164306372.png)\\r\\n\\r\\n\u4e3b\u8981\u662f\u8fd9\u4e00\u6bb5\u4ee3\u7801\uff0c`\\t\\t\\t\\t\\t\\tinjectors.add(injectorFactory.create(this, member, inject.value()));`\\r\\n\\r\\n\u8fc7\u6ee4\u9759\u6001\u5b57\u6bb5(inject.value() \u662f\u5b57\u6bb5\u7684\u540d\u5b57\uff0c), injector \u5de5\u5382\u751f\u6210\u4e86injector\u3002\u8fd9\u91cc\u7684\u9759\u6001\u65b9\u6cd5\u540c\u7406\uff0c\u6240\u4ee5\u4e0d\u622a\u56fe\u4e86\u3002\\r\\n\\r\\n\\r\\n\\r\\n![image-20220416165057283](2022-04-16-google-juice-source.assets/image-20220416165057283.png)\\r\\n\\r\\n\u200b\\t\\t\\t\\t\\t\u62ff\u5230\u4e86\u6ce8\u5165\u5668\u540e\uff0c\u5206\u522b\u6267\u884cMethodInject\u548cFieldInject\u7684inject \u65b9\u6cd5\uff0c\u4e0b\u9762\u5c31\u4e0d\u7528\u7ec6\u8bf4\u4e86\uff0c\u80cc\u540e\u7684\u539f\u7406\u5c31\u662f\u4f7f\u7528\u53cd\u5c04\u7684\u65b9\u5f0f\u7ed9\u5b57\u6bb5\u8bbe\u7f6e\u503c\uff0c \u8c03\u7528\u9759\u6001\u65b9\u6cd5\u8bbe\u7f6e\u503c\u3002\\r\\n\\r\\n\\r\\n\\r\\n## 6. guice \u548cspring \u4f7f\u7528DI \u548cIOC \u901f\u5ea6\u5bf9\u6bd4\\r\\n\\r\\n\u5728java \u7684\u751f\u6001\u4e2d\u6709\u4e00\u9053\u6c38\u8fdc\u8fc8\u4e0d\u8fc7\u7684\u5929\u82b1\u677f\uff0c\u90a3\u5c31\u662fspring\u3002 \u6240\u4ee5guice \u60f3\u548cspring \u4e00\u8f83\u9ad8\u4e0b\u3002 guice \u5904\u7406bean\u7684\u901f\u5ea6\u5927\u7ea6\u662fspring\u768440\u500d\u3002\u8fd9\u4e2a\u6d4b\u8bd5\u7c7b\u7684\u540d\u5b57\u662f  `com.google.inject.SpringTest`  \u6240\u6709\u5c0f\u4f19\u4f34\u4eec\u5728\u4f7f\u7528storm \u6216\u8005flink \u4e4b\u7c7b\u7684\u6846\u67b6\u7684\u65f6\u5019\uff0c\u8be5\u9009\u62e9guice \u5c31\u8981\u9009\u62e9juice \u3002 \\r\\n\\r\\n## 7. \u603b\u7ed3\\r\\n\\r\\n\u901a\u8fc7\u672c\u7bc7\u6587\u7ae0\u6211\u4eec\u80fd\u591f\u5b66\u4e60\u5230\\r\\n\\r\\n- bean \u7684\u521b\u5efa\u548c\u7ba1\u7406\uff08IOC)\\r\\n- \u4f9d\u8d56\u6ce8\u5165\uff08DI\uff09\u662f\u5982\u4f55\u5b9e\u73b0\u7684\\r\\n- \u5982\u4f55\u5904\u7406\u4f9d\u8d56\u5faa\u73af\\r\\n- \u9759\u6001\u6ce8\u5165\u5982\u4f55\u5b9e\u73b0\\r\\n\\r\\n\u200b\\t\\t\\t\u672c\u7bc7\u6587\u7ae0\u53ea\u662f\u5206\u6790\u4e86\u90e8\u5206\u529f\u80fd\u7684\u539f\u7406\uff0c\u8fd9\u53ea\u662f\u6211\u4eec\u5b66\u4e60\u7684\u4e00\u5c0f\u6b65\uff0c\u6211\u5c06\u5728\u4e0b\u4e00\u7bc7\u6587\u7ae0\u7ee7\u7eed\u6df1\u5165guice \u6846\u67b6\u7684\u8bbe\u8ba1\u76f8\u5173\u7684\u5185\u5bb9\uff0c \u5b66\u4e60\u5b8c\u6846\u67b6\u7684\u8bbe\u8ba1\u76f8\u5173\u7684\u5185\u5bb9\uff0c \u8fd8\u4f1a\u4e00\u6b65\u4e00\u6b65\u7684\u624b\u5199\u4e00\u4e2a\u5b9e\u73b0\u7b80\u5355\u529f\u80fd\u7684\u6ce8\u5165\u6846\u67b6\u3002"},{"id":"/java \u6e90\u7801\u5206\u6790","metadata":{"permalink":"/java/java \u6e90\u7801\u5206\u6790","source":"@site/java\\\\java \u6e90\u7801\u5206\u6790.md","title":"java \u6e90\u7801\u5206\u6790","description":"Java \u6838\u5fc3\u7bc7","date":"2022-03-28T07:38:53.892Z","formattedDate":"March 28, 2022","tags":[],"readingTime":0.155,"truncated":false,"authors":[],"frontMatter":{},"prevItem":{"title":"google guice \u6846\u67b6\u6e90\u7801\u5b66\u4e60","permalink":"/java/google-guice-source"},"nextItem":{"title":"Elasticsearch \u5728\u7ade\u4ef7\u5e7f\u544a\u4e2d\u7684\u68c0\u7d22\u4f7f\u7528","permalink":"/java/elasticsearch-user-rtb-ad"}},"content":"## Java \u6838\u5fc3\u7bc7\\r\\n\\r\\n###\\t1. \u6ce8\u89e3 annotation\\r\\n\\r\\n###\\t2. \u5de5\u5177instrument \\r\\n\\r\\n###\\t3. \u8c03\u7528invoke\\r\\n\\r\\n###\\t4. \u7ba1\u7406 management\\r\\n\\r\\n### 5. \u5f15\u7528 ref\\r\\n\\r\\n###\\t6."},{"id":"elasticsearch-user-rtb-ad","metadata":{"permalink":"/java/elasticsearch-user-rtb-ad","source":"@site/java/2022-02-05-elasticsearch-user-rtb-ad.md","title":"Elasticsearch \u5728\u7ade\u4ef7\u5e7f\u544a\u4e2d\u7684\u68c0\u7d22\u4f7f\u7528","description":"Elasticsearch \u5728\u7ade\u4ef7\u5e7f\u544a\u4e2d\u7684\u68c0\u7d22\u4f7f\u7528","date":"2022-02-05T00:00:00.000Z","formattedDate":"February 5, 2022","tags":[{"label":"elasticsearch","permalink":"/java/tags/elasticsearch"},{"label":"rtb-ad","permalink":"/java/tags/rtb-ad"}],"readingTime":6.125,"truncated":false,"authors":[{"name":"jeesk","title":"java engineer","url":"https://shanjiancaofu.com","imageURL":"https://shanjiancaofu.com/img/avtor.png","key":"jeesk"}],"frontMatter":{"slug":"elasticsearch-user-rtb-ad","title":"Elasticsearch \u5728\u7ade\u4ef7\u5e7f\u544a\u4e2d\u7684\u68c0\u7d22\u4f7f\u7528","tags":["elasticsearch","rtb-ad"],"authors":["jeesk"]},"prevItem":{"title":"java \u6e90\u7801\u5206\u6790","permalink":"/java/java \u6e90\u7801\u5206\u6790"},"nextItem":{"title":"Java BiO\u548cNIO\u7684\u533a\u522b","permalink":"/java/java-bio-diffrent-from-nio"}},"content":"## Elasticsearch \u5728\u7ade\u4ef7\u5e7f\u544a\u4e2d\u7684\u68c0\u7d22\u4f7f\u7528\\r\\n\\r\\n\\r\\n\\r\\n\\r\\n###\\t \u4e00\u3001\u5e7f\u544a\u5b9a\u5411\u7b80\u8ff0\\r\\n\\r\\n####\\t1.1 \u5728\u7ade\u4ef7\u5e7f\u544a\u4e2d\u7684\u5b9a\u5411\u6761\u4ef6\u5f80\u5f80\u5982\u4e0b\u6240\u793a\\r\\n\\r\\n-    ad1  \u5b9a\u5411\u4e3a\u5730\u57df\u5317\u4eac,\u4e0a\u6d77,\u5e7f\u5dde,\u6df1\u5733,18~28\u5c81\u7684\u65c5\u6e38,\u5065\u8eab\u884c\u4e1a\u7537\u6027,\u5e76\u4e14\u8981\u6c42\u9002\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e3aios,android,\u5e7f\u544a\u51fa\u4ef75\u5757\\r\\n-    ad2  \u5b9a\u5411\u4e3a\u5730\u57df\u6210\u90fd\u572818~28\u5c81\u7684\u5065\u8eab\u884c\u4e1a\u7537\u6027,\u5e76\u4e14\u8981\u6c42\u9002\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e3aios\u548cmac,\u5e7f\u544a\u51fa\u4ef74.8\u5757\\r\\n-    ad3  \u5b9a\u5411\u4e3a\u572828~38\u5c81\u7684\u7537\u6027,\u5e76\u4e14\u8981\u6c42\u9002\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e3aandroid,\u5e7f\u544a\u51fa\u4ef75.7\u5757\\r\\n-    ad4  \u5b9a\u5411\u4e3a\u572828~38\u5c81,\u5e76\u4e14\u8981\u6c42\u9002\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e3aios,\u5e7f\u544a\u51fa\u4ef75.2\u5757\\r\\n\\r\\n####\\t1.2  \u89d2\u8272\u5bf9\u5e94\u5e7f\u544a\u5206\u6790\\r\\n\\r\\n -    \u89d2\u82721:     \u5317\u4eac,\u5973\u6027,\u5065\u8eab\u884c\u4e1a,\u64cd\u4f5c\u7cfb\u7edfios\\r\\n -    \u89d2\u82722:     \u5e7f\u5dde,\u7537\u6027,18~28\u5c81,\u65c5\u6e38\u884c\u4e1a,\u64cd\u4f5c\u7cfb\u7edf\u4e3aios\\r\\n -    \u89d2\u82723:     \u6210\u90fd,\u5973\u6027,28~38\u5c81,\u5065\u8eab\u884c\u4e1a,\u64cd\u4f5c\u7cfb\u7edf\u4e3aios\\r\\n -    \u89d2\u82724:     \u6210\u90fd,\u7537\u6027,28~38\u5c81,\u5065\u8eab\u884c\u4e1a,\u64cd\u4f5c\u7cfb\u7edf\u4e3aios\\r\\n\\r\\n####\\t1.3.  \u8ba4\u771f\u5206\u6790\u540e\u5f97\u51fa\u4e0b\u9762\u6bcf\u4e2a\u89d2\u8272\u53ef\u4ee5\u63a8\u9001\u7684\u5e7f\u544a\u5982\u4e0b\\r\\n\\r\\n- \u89d2\u82721:  ad4\\r\\n- \u89d2\u82722:  ad1,ad4\\r\\n- \u89d2\u82723:  ad4\\r\\n- \u89d2\u82724:  ad2,ad4\\r\\n\\r\\n\u5f80\u5f80\u4f20\u7edf\u6570\u636e\u5e93\u65e0\u6cd5\u6ee1\u8db3\u4e0a\u8ff0\u7684\u67e5\u8be2\u65f6\u5ef6, \u5927\u5382\u5f80\u5f80\u53c8\u5f00\u53d1\u81ea\u5df1\u7684\u5012\u6392\u7d22\u5f15\u7cfb\u7edf, \u4e3a\u4e86\u51cf\u5c11\u6210\u672c, \u53ef\u4ee5\u4f7f\u7528elasticsearch\u7684\u5e03\u5c14\u67e5\u8be2.\\r\\n\\r\\n### \u4e8c\u3001\u4f7f\u7528elasticsearch \u67e5\u8be2\u5b9e\u65f6\u67e5\u8be2\u5e7f\u544a\\r\\n\\r\\n#### 2.1.   mysql\u4e2d, \u5982\u679c\u8981\u67e5\u8be2\u67d0\u4e2a\u7528\u6237\u6ee1\u8db3\u7684\u5e7f\u544a\u6761\u4ef6\u5982\u4e0b\u53ef\u6574\u7406\u4e3a\u8868\u8fbe\u5f0f\\r\\n\\r\\n[\uff08\u4e0d\u5b58\u5728\u6027\u522b\u5b9a\u5411\uff09|| \uff08\u5b58\u5728\u6027\u522b\u5b9a\u5411\u4e14\u6ee1\u8db3\u6761\u4ef6\uff09]  \\r\\n&&  [\uff08\u4e0d\u5b58\u5728\u5e74\u9f84\u5b9a\u5411\uff09|| \uff08\u5b58\u5728\u5e74\u9f84\u5b9a\u5411\u4e14\u6ee1\u8db3\u6761\u4ef6\uff09]\\r\\n&&  [\uff08\u4e0d\u5b58\u5728\u6807\u7b7e\u5b9a\u5411\uff09|| \uff08\u5b58\u5728\u6807\u7b7e\u5b9a\u5411\u4e14\u6ee1\u8db3\u6761\u4ef6\uff09]\\r\\n&&  [\uff08\u4e0d\u5b58\u5728\u5730\u57df\u5b9a\u5411\uff09|| \uff08\u5b58\u5728\u5730\u57df\u5b9a\u5411\u4e14\u6ee1\u8db3\u6761\u4ef6\uff09]\\r\\n&&  [\uff08\u4e0d\u5b58\u5728\u64cd\u4f5c\u7cfb\u7edf\u5b9a\u5411\uff09|| \uff08\u5b58\u5728\u64cd\u4f5c\u7cfb\u7edf\u5b9a\u5411\u4e14\u6ee1\u8db3\u6761\u4ef6\uff09]\\r\\n\\r\\n####\\t2.2  \u51c6\u5907\u5de5\u5177:  postman \u6216\u8005\u652f\u6301curl\u547d\u4ee4\u884c, \u4e00\u53f0\u5b89\u88c5\u4e86docker\u7684\u673a\u5668\\r\\n\\r\\n#####\\t2.2.1\\t\u62c9\u53d6es\u955c\u50cf,\u5e76\u4e14\u8fd0\u884c\u8d77\u6765\\r\\n\\r\\n```shell\\r\\ndocker pull docker.io/elasticsearch:7.1.1\\r\\ndocker run -d --name es1  -e ES_JAVA_OPTS=\\"-Xms512m -Xmx512m\\" -p 9200:9200 -p 9300:9300 -e \\"discovery.type=single-node\\" b0e9f9f047e6\\r\\n```\\r\\n\\r\\n#####\\t2.2.2    \u6267\u884c\u547d\u4ee4\\r\\n\\r\\npostman\u6216\u8005\u547d\u4ee4\u884c\u4e2d\u6267\u884c `curl --location --request GET \'http://192.168.17.77:9200\'`\\r\\n\\r\\n\u5982\u679c\u8fd4\u56de\u4e0b\u9762\u7684\u6587\u6863\u8bf4\u660e\u4f60\u5b89\u88c5\u5355\u673a\u7248\u672c\u7684elasticsearch\u5df2\u7ecf\u5b89\u88c5\u5b8c\u6210\\r\\n\\r\\n```json\\r\\n{\\r\\n    \\"name\\": \\"cc51cc2a79ce\\",\\r\\n    \\"cluster_name\\": \\"docker-cluster\\",\\r\\n    \\"cluster_uuid\\": \\"BveCHkuVTtWwr-rcWDmTpg\\",\\r\\n    \\"version\\": {\\r\\n        \\"number\\": \\"7.1.1\\",\\r\\n        \\"build_flavor\\": \\"default\\",\\r\\n        \\"build_type\\": \\"docker\\",\\r\\n        \\"build_hash\\": \\"7a013de\\",\\r\\n        \\"build_date\\": \\"2019-05-23T14:04:00.380842Z\\",\\r\\n        \\"build_snapshot\\": false,\\r\\n        \\"lucene_version\\": \\"8.0.0\\",\\r\\n        \\"minimum_wire_compatibility_version\\": \\"6.8.0\\",\\r\\n        \\"minimum_index_compatibility_version\\": \\"6.0.0-beta1\\"\\r\\n    },\\r\\n    \\"tagline\\": \\"You Know, for Search\\"\\r\\n}\\r\\n```\\r\\n\\r\\n####\\t2.3.  \u5efa\u7acb\u5e7f\u544a\u7d22\u5f15,\u67e5\u8be2\u5e7f\u544a\u4f4d\u5bf9\u5e94\u5e7f\u544a\\r\\n\\r\\n\u901a\u5e38\u7528\u6237\u8bbf\u95eeapp\u62c9\u53d6\u5e7f\u544a\u662f\u4ee5\u5e7f\u544a\u4f4d\u4e3a\u57fa\u51c6, \u8be5\u5e7f\u544a\u4f4d\u4e0b\u9762\u6709n\u4e2a\u5e26\u6709\u5b9a\u5411\u6761\u4ef6\u7684\u5e7f\u544a.\u90a3\u4e48 \u67e5\u8be2\u6761\u4ef6\u5c31\u662f\u5e7f\u544a\u4f4did,\u5e95\u4ef7+\u4ee5\u53ca\u7528\u6237\u81ea\u8eab\u7684\u5c5e\u6027\\r\\n\\r\\n\u521b\u5efa\u5e7f\u544a\u4f4did\u4e3a100\u7684\u7d22\u5f15\\r\\n\\r\\n`curl --location --request PUT \'http://192.168.17.77:9200/posfor100\'`\\r\\n\\r\\n1. \u589e\u52a0\u8be5\u7d22\u5f15\u5bf9\u5e94\u7684\u6570\u636e(\u7c7b\u578b\u4e8emysql\u7684\u884c\u6570\u636e)\\r\\n\\r\\n```\\r\\n\u5317\u4e0a\u5e7f\u6df1,\u6210\u90fd\u5206\u522b\u6620\u5c04\u4e3a 1,2,3,4,5\\r\\n\u7537\u5973\u6620\u5c04\u4e3a1,2\\r\\n\u64cd\u4f5c\u7cfb\u7edfios, android,mac \u6620\u5c04\u4e3a1,2,3  \\r\\n\u884c\u4e1a\u65c5\u6e38,\u5065\u8eab\u5206\u522b\u6620\u5c04\u4e3a 1,2 \\r\\n\u5e74\u9f8418~28 \u6620\u5c04\u4e3a2\\r\\n```\\r\\n\\r\\n\\r\\n\\r\\n\u63d2\u5165\u5bf9\u5e94\u76844\u6761\u6570\u636e,\u5047\u8bbe\u4e0a\u97624\u4e2a\u5e7f\u544a\u5bf9\u5e94\u7684id\u4e3a 101,102,103,104\\r\\n\\r\\n```json\\r\\ncurl --location --request POST \'http://192.168.17.77:9200/posfor100/_doc/101\' \\\\\\r\\n--header \'Content-Type: application/json\' \\\\\\r\\n--data-raw \'{\\"city\\":[1,2,3,4],\\"ageRange\\":[2],\\"gender\\":[1],\\"os\\":[1,2],\\"industry\\":[1,2],\\"price\\":5}\'\\r\\n```\\r\\n\\r\\n```json\\r\\ncurl --location --request POST \'http://192.168.17.77:9200/posfor100/_doc/102\' \\\\\\r\\n--header \'Content-Type: application/json\' \\\\\\r\\n--data-raw \'{\\"city\\":[5],\\"ageRange\\":[2],\\"gender\\":[1],\\"os\\":[1,3],\\"industry\\":[2],\\"price\\":4.8}\'\\r\\n```\\r\\n\\r\\n```json\\r\\ncurl --location --request POST \'http://192.168.17.77:9200/posfor100/_doc/103\' \\\\\\r\\n--header \'Content-Type: application/json\' \\\\\\r\\n--data-raw \'{\\"ageRange\\":[2],\\"gender\\":[1],\\"os\\":[2],\\"price\\":5.7}\'\\r\\n```\\r\\n\\r\\n```json\\r\\ncurl --location --request POST \'http://192.168.17.77:9200/posfor100/_doc/104\' \\\\\\r\\n--header \'Content-Type: application/json\' \\\\\\r\\n--data-raw \'{\\"ageRange\\":[2],\\"os\\":[1],\\"price\\":5.2}\'\\r\\n```\\r\\n\\r\\n1. \u5047\u8bbe\u8be5\u5e7f\u544a\u4f4d100\u7684\u5e95\u4ef7\u4e3a3\u5757\u94b1,\u4f7f\u7528\u5e03\u5c14\u67e5\u8be2\\r\\n\\r\\n\u89d2\u82721 \u5bf9\u5e94\u7684\u67e5\u8be2\\r\\n\\r\\n```shell\\r\\ncurl --location --request GET \'http://192.168.17.77:9200/posfor100/_search\' \\\\\\r\\n--header \'Content-Type: application/json\' \\\\\\r\\n--data-raw \'{\\"query\\":{\\"bool\\":{\\"filter\\":[{\\"bool\\":{\\"should\\":[{\\"term\\":{\\"gender\\":{\\"value\\":2,\\"boost\\":1.0}}},{\\"bool\\":{\\"must_not\\":[{\\"exists\\":{\\"field\\":\\"gender\\",\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"minimum_should_match\\":\\"1\\",\\"boost\\":1.0}},{\\"bool\\":{\\"should\\":[{\\"term\\":{\\"os\\":{\\"value\\":1,\\"boost\\":1.0}}},{\\"bool\\":{\\"must_not\\":[{\\"exists\\":{\\"field\\":\\"os\\",\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"minimum_should_match\\":\\"1\\",\\"boost\\":1.0}},{\\"bool\\":{\\"should\\":[{\\"term\\":{\\"city\\":{\\"value\\":1,\\"boost\\":1.0}}},{\\"bool\\":{\\"must_not\\":[{\\"exists\\":{\\"field\\":\\"city\\",\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"minimum_should_match\\":\\"1\\",\\"boost\\":1.0}},{\\"bool\\":{\\"should\\":[{\\"term\\":{\\"industry\\":{\\"value\\":2,\\"boost\\":1.0}}},{\\"bool\\":{\\"must_not\\":[{\\"exists\\":{\\"field\\":\\"industry\\",\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"minimum_should_match\\":\\"1\\",\\"boost\\":1.0}},{\\"bool\\":{\\"should\\":[{\\"term\\":{\\"ageRange\\":{\\"value\\":2,\\"boost\\":1.0}}},{\\"bool\\":{\\"must_not\\":[{\\"exists\\":{\\"field\\":\\"ageRange\\",\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"minimum_should_match\\":\\"1\\",\\"boost\\":1.0}},{\\"bool\\":{\\"filter\\":[{\\"range\\":{\\"price\\":{\\"from\\":3.0,\\"to\\":null,\\"include_lower\\":true,\\"include_upper\\":true,\\"boost\\":1.0}}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}}\'\\r\\n```\\r\\n\\r\\n\u5f97\u5230\u67e5\u8be2\u6761\u4ef6\u5982\u4e0b, \u83b7\u5f97\u4e86id 104\u7684\u5e7f\u544a,\u5373\u662f\u5e7f\u544a4\\r\\n\\r\\n```json\\r\\n{\\r\\n    \\"took\\": 403,\\r\\n    \\"timed_out\\": false,\\r\\n    \\"_shards\\": {\\r\\n        \\"total\\": 1,\\r\\n        \\"successful\\": 1,\\r\\n        \\"skipped\\": 0,\\r\\n        \\"failed\\": 0\\r\\n    },\\r\\n    \\"hits\\": {\\r\\n        \\"total\\": {\\r\\n            \\"value\\": 1,\\r\\n            \\"relation\\": \\"eq\\"\\r\\n        },\\r\\n        \\"max_score\\": 0.0,\\r\\n        \\"hits\\": [\\r\\n            {\\r\\n                \\"_index\\": \\"posfor100\\",\\r\\n                \\"_type\\": \\"_doc\\",\\r\\n                \\"_id\\": \\"104\\",\\r\\n                \\"_score\\": 0.0,\\r\\n                \\"_source\\": {\\r\\n                    \\"ageRange\\": [\\r\\n                        2\\r\\n                    ],\\r\\n                    \\"os\\": [\\r\\n                        1\\r\\n                    ],\\r\\n                    \\"price\\": 5.2\\r\\n                }\\r\\n            }\\r\\n        ]\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n\u89d2\u82722\u5bf9\u5e94\u7684\u67e5\u8be2\\r\\n\\r\\n```shell\\r\\ncurl --location --request GET \'http://192.168.17.77:9200/posfor100/_search\' \\\\\\r\\n--header \'Content-Type: application/json\' \\\\\\r\\n--data-raw \'{\\"query\\":{\\"bool\\":{\\"filter\\":[{\\"bool\\":{\\"should\\":[{\\"term\\":{\\"gender\\":{\\"value\\":1,\\"boost\\":1.0}}},{\\"bool\\":{\\"must_not\\":[{\\"exists\\":{\\"field\\":\\"gender\\",\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"minimum_should_match\\":\\"1\\",\\"boost\\":1.0}},{\\"bool\\":{\\"should\\":[{\\"term\\":{\\"os\\":{\\"value\\":1,\\"boost\\":1.0}}},{\\"bool\\":{\\"must_not\\":[{\\"exists\\":{\\"field\\":\\"os\\",\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"minimum_should_match\\":\\"1\\",\\"boost\\":1.0}},{\\"bool\\":{\\"should\\":[{\\"term\\":{\\"city\\":{\\"value\\":4,\\"boost\\":1.0}}},{\\"bool\\":{\\"must_not\\":[{\\"exists\\":{\\"field\\":\\"city\\",\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"minimum_should_match\\":\\"1\\",\\"boost\\":1.0}},{\\"bool\\":{\\"should\\":[{\\"term\\":{\\"industry\\":{\\"value\\":1,\\"boost\\":1.0}}},{\\"bool\\":{\\"must_not\\":[{\\"exists\\":{\\"field\\":\\"industry\\",\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"minimum_should_match\\":\\"1\\",\\"boost\\":1.0}},{\\"bool\\":{\\"should\\":[{\\"term\\":{\\"ageRange\\":{\\"value\\":2,\\"boost\\":1.0}}},{\\"bool\\":{\\"must_not\\":[{\\"exists\\":{\\"field\\":\\"ageRange\\",\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"minimum_should_match\\":\\"1\\",\\"boost\\":1.0}},{\\"bool\\":{\\"filter\\":[{\\"range\\":{\\"price\\":{\\"from\\":3.0,\\"to\\":null,\\"include_lower\\":true,\\"include_upper\\":true,\\"boost\\":1.0}}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}],\\"adjust_pure_negative\\":true,\\"boost\\":1.0}}}\'\\r\\n```\\r\\n\\r\\n\u5f97\u5230\u7684\u7ed3\u679c\\r\\n\\r\\n```json\\r\\n{\\r\\n    \\"took\\": 3,\\r\\n    \\"timed_out\\": false,\\r\\n    \\"_shards\\": {\\r\\n        \\"total\\": 1,\\r\\n        \\"successful\\": 1,\\r\\n        \\"skipped\\": 0,\\r\\n        \\"failed\\": 0\\r\\n    },\\r\\n    \\"hits\\": {\\r\\n        \\"total\\": {\\r\\n            \\"value\\": 2,\\r\\n            \\"relation\\": \\"eq\\"\\r\\n        },\\r\\n        \\"max_score\\": 0.0,\\r\\n        \\"hits\\": [\\r\\n            {\\r\\n                \\"_index\\": \\"posfor100\\",\\r\\n                \\"_type\\": \\"_doc\\",\\r\\n                \\"_id\\": \\"101\\",\\r\\n                \\"_score\\": 0.0,\\r\\n                \\"_source\\": {\\r\\n                    \\"city\\": [\\r\\n                        1,\\r\\n                        2,\\r\\n                        3,\\r\\n                        4\\r\\n                    ],\\r\\n                    \\"ageRange\\": [\\r\\n                        2\\r\\n                    ],\\r\\n                    \\"gender\\": [\\r\\n                        1\\r\\n                    ],\\r\\n                    \\"os\\": [\\r\\n                        1,\\r\\n                        2\\r\\n                    ],\\r\\n                    \\"industry\\": [\\r\\n                        1,\\r\\n                        2\\r\\n                    ],\\r\\n                    \\"price\\": 5\\r\\n                }\\r\\n            },\\r\\n            {\\r\\n                \\"_index\\": \\"posfor100\\",\\r\\n                \\"_type\\": \\"_doc\\",\\r\\n                \\"_id\\": \\"104\\",\\r\\n                \\"_score\\": 0.0,\\r\\n                \\"_source\\": {\\r\\n                    \\"ageRange\\": [\\r\\n                        2\\r\\n                    ],\\r\\n                    \\"os\\": [\\r\\n                        1\\r\\n                    ],\\r\\n                    \\"price\\": 5.2\\r\\n                }\\r\\n            }\\r\\n        ]\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n\u7531\u4e0a\u53ef\u5f97\u89d2\u82721\u83b7\u53d6\u5230ad4,\u89d2\u82722\u83b7\u53d6\u5230ad1,ad4, \u548c\u6211\u4eec\u6700\u521d\u5f97\u5230\u7684\u7ed3\u8bba\u662f\u4e00\u6837\u76842,  \u5269\u4f59\u89d2\u82723,\u89d2\u82724\u5bf9\u5e94\u7684\u5e7f\u544a,\u8bf7\u5404\u4f4d\u4eb2\u81ea\u5df1\u52a8\u624b\u9a8c\u8bc1.  \\r\\n\\r\\n###\\t\u4e09\u3001\u5c0f\u7ed3\\r\\n\\r\\n1. \u5b66\u4e60\u5230\u5b9a\u5411\u6761\u4ef6\u53ef\u4ee5\u901a\u8fc7es\u7684\u5e03\u5c14\u8868\u8fbe\u5f0f\u6765\u68c0\u7d22\\r\\n\\r\\n   \\r\\n\\r\\n\u53c2\u8003\u5982\u4e0b\\r\\n\\r\\n1. [\u57fa\u4e8e\u5e03\u5c14\u8868\u8fbe\u5f0f\u7684\u5e7f\u544a\u7d22\u5f15\u8bbe\u8ba1](https://zhuanlan.zhihu.com/p/59658727)\\r\\n2. [Elasticsearch\uff08Es\uff09\u805a\u5408\u67e5\u8be2\uff08\u6307\u6807\u805a\u5408\u3001\u6876\u805a\u5408\uff09](https://www.knowledgedict.com/tutorial/elasticsearch-aggregations.html)"},{"id":"java-bio-diffrent-from-nio","metadata":{"permalink":"/java/java-bio-diffrent-from-nio","source":"@site/java/2022-01-23-java-bio-diffrent-from-nio.md","title":"Java BiO\u548cNIO\u7684\u533a\u522b","description":"NIO\u548cBIO\u7684\u533a\u522b\u603b\u7ed3","date":"2022-01-23T00:00:00.000Z","formattedDate":"January 23, 2022","tags":[{"label":"java","permalink":"/java/tags/java"},{"label":"io","permalink":"/java/tags/io"}],"readingTime":5.345,"truncated":false,"authors":[{"name":"jeesk","title":"java engineer","url":"https://shanjiancaofu.com","imageURL":"https://shanjiancaofu.com/img/avtor.png","key":"jeesk"}],"frontMatter":{"slug":"java-bio-diffrent-from-nio","title":"Java BiO\u548cNIO\u7684\u533a\u522b","authors":["jeesk"],"tags":["java","io"]},"prevItem":{"title":"Elasticsearch \u5728\u7ade\u4ef7\u5e7f\u544a\u4e2d\u7684\u68c0\u7d22\u4f7f\u7528","permalink":"/java/elasticsearch-user-rtb-ad"}},"content":"##\\t\\tNIO\u548cBIO\u7684\u533a\u522b\u603b\u7ed3\\n\\n###\\t1. \u8868\u683c\u8bf4\u660e\u4e24\u8005\u7684\u533a\u522b\\n\\n| IO\u7c7b\u578b | \u662f\u5426\u963b\u585e | \u540c\u6b65IO | \u7ebf\u7a0b\u6a21\u578b                 |\\n| ------ | -------- | ------ | ------------------------ |\\n| BIO    | \u963b\u585e     | \u662f     | \u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u5e94\u4e00\u4e2a\u8bf7\u6c42     |\\n| NIO    | \u975e\u963b\u585e   | \u662f     | \u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u5904\u7406\u591a\u4e2a\u8bf7\u6c42 |\\n\\n###\\t2. \u793a\u610f\u56fe\u8bf4\u660e\u533a\u522b\\n\\n![](./2022-01-23-java-bio-diffrent-from-nio.assets\\\\image-20220124015657528.png)\\n\\n![image-20220124015747188](./2022-01-23-java-bio-diffrent-from-nio.assets/image-20220124015747188.png)\\n\\n\\n\\n##\\t\u4ee3\u7801\u5b9e\u6218\\n\\n\\n\\n###\\t1. BIO\u5b9e\u6218\\n\\n####\\t1.1 \u7f16\u5199BIO\u4ee3\u7801\\n\\n> \u200b\\t\u76ee\u7684:  \u5b9e\u73b0\u4e00\u4e2aserver, \u63a5\u53d7\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u6d88\u606f, \u5e76\u5c06\u6d88\u606f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\\n>\\n> \u200b    \u601d\u8def:\\n>\\n>  1.\\t\u9996\u5148\u521b\u5efa\u4e00\u4e2aServerSocket , \u5e76\u4e14\u7ed1\u5b9a\u4e00\u4e2a\u672c\u5730\u7aef\u53e39999,\\n>  2.\\t \u7b49\u5f85\u5ba2\u6237\u7aef\u8fde\u63a5, \u7136\u540e\u5c06\u8fde\u63a5\u4ea4\u7ed9\u7ebf\u7a0b\u6c60\u5904\u7406\\n>  3.\\t \u4eceinputStream \u91cc\u9762\u8bfb\u53d6\u5185\u5bb9, \u5e76\u4e14\u5c06\u5185\u5bb9\u4f7f\u7528outPutStream\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\\n\\n```java\\nimport java.io.IOException;\\nimport java.io.InputStream;\\nimport java.io.OutputStream;\\nimport java.net.InetSocketAddress;\\nimport java.net.ServerSocket;\\nimport java.net.Socket;\\nimport java.util.concurrent.ExecutorService;\\nimport java.util.concurrent.Executors;\\n\\npublic class BioServerTest {\\n    public static void main(String[] args) throws IOException {\\n\\n        // \u56fa\u5b9a10\u4e2a\u7ebf\u7a0b,\u5e76\u4e14\u521b\u5efa\u7ed9\u4e00\u4e2aserverSocket,\u5e76\u4e14\u7ed1\u5b9a\u7aef\u53e3\\n        ExecutorService executorService = Executors.newFixedThreadPool(10);\\n        ServerSocket serverSocket = new ServerSocket();\\n        serverSocket.bind(new InetSocketAddress(9999));\\n\\n        // \u63a5\u53d7\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42, \u5e76\u5c06\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u6587\u5b57, \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\\n        while (true) {\\n            // \u7b49\u5f85\u5176\u5b83\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42, \u8bb0\u4f4f\u8fd9\u91cc\u963b\u585e\u7684,  \u5f53\u6211\u4eec\u542f\u52a8\u8be5\u7a0b\u5e8f, \u8fd9\u91cc\u7684accept \u4f1a\u963b\u585e\u4e0d\u52a8, \u76f4\u5230\u6210\u529f\u63a5\u6536\u4e00\u4e2a\u8bf7\u6c42\\n            Socket accept = serverSocket.accept();\\n            System.out.println(\\"\u63a5\u53d7\u5230\u8bf7\u6c42\\");\\n            // \u5c06\u8bf7\u6c42\u4ea4\u7ed9\u7ebf\u7a0b\u6c60\u5904\u7406\\n            executorService.submit(new Runnable() {\\n                @Override\\n                public void run() {\\n                    InputStream inputStream = null;\\n                    OutputStream outputStream = null;\\n                    // \u4e0d\u540c\u8fde\u63a5\u7684hashcode , \u8bf4\u660e\u662f\u6765\u81ea\u4e0d\u540c\u7684\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\\n                    int clientHashCode = accept.hashCode();\\n                    try {\\n                        inputStream = accept.getInputStream();\\n                        outputStream = accept.getOutputStream();\\n                        byte[] bytes = new byte[1024];\\n                        int index = inputStream.read(bytes);\\n                        String s = new String(bytes, 0, index);\\n                        System.out.println(\\"\u5ba2\u6237\u7aef:\\" + clientHashCode + \\",\u53d1\u9001\u6765\u7684\u6d88\u606f\u662f:\\" + s);\\n                        outputStream.write((\\"server\u56de\u590d: \\" + s).getBytes());\\n                    } catch (IOException e) {\\n                        e.printStackTrace();\\n                    } finally {\\n                        try {\\n                            accept.close();\\n                        } catch (IOException e) {\\n                            e.printStackTrace();\\n                        }\\n                    }\\n                }\\n            });\\n        }\\n\\n    }\\n}\\n\\n```\\n\\n####\\t1.2 \u542f\u52a8\u7a0b\u5e8f\\n\\n![image-20220124023401519](./2022-01-23-java-bio-diffrent-from-nio.assets/image-20220124023401519.png)\\n\\n####\\t1.3\\t\u5728\u547d\u4ee4\u884c\u4e2d\u8fde\u63a5\u5ba2\u6237\u7aef, \u89c2\u5bdf\u7ed3\u679c\\n\\n![image-20220124023544496](./2022-01-23-java-bio-diffrent-from-nio.assets/image-20220124023544496.png)\\n\\n\u8f93\u5165hello world ,\u671f\u5f85\u7ed3\u679c\u8fd4\u56dehello world\\n\\n![image-20220124023633274](./2022-01-23-java-bio-diffrent-from-nio.assets/image-20220124023633274.png)\\n\\nidea \u670d\u52a1\u7aef\u7684console \u5982\u4e0b\\n\\n![image-20220124023653403](./2022-01-23-java-bio-diffrent-from-nio.assets/image-20220124023653403.png)\\n\\n###\\t2. NIO\u5b9e\u6218\\n\\n####\\t\\n\\n> \u200b\\t\u76ee\u7684:  \u901a\u8fc7NIO \u5b9e\u73b0client\u548cserver\u7684\u4ea4\u4e92\\n>\\n> \u200b    \u601d\u8def:\\n>\\n> \u200b    Server \u7aef\u601d\u8def\\n>\\n> 1.  \u9996\u5148\u521b\u5efasocketServerChannel,\u548cSelctor, \u5c06channel \u6ce8\u518cselector \u4e0a\u9762\u53bb\\n>\\n> 2.  \u7b49\u5f85\u5ba2\u6237\u7aef\u8fde\u63a5, \u5c06\u5ba2\u6237\u7aef\u8fde\u63a5\u7684channel\u6ce8\u518c\u5230selctor\u4e0a\u9762\u53bb, \u6ce8\u610f\u4e0d\u540c\u7684channel\u6709\u4e0d\u540c\u7684\u4e8b\u4ef6\\n>\\n> 3.  \u83b7\u53d6\u83b7\u53d6\u5ba2\u6237\u7aefchannel\u62ff\u5230\u6570\u636e\\n>\\n>\\n>\\n> \u200b    Client \u7aef\u601d\u8def\\n>\\n> 1.\\t\u521b\u5efaSocketChannel, \u7136\u540e\u8fde\u63a5Server\u7aef\\n> 2.\\t\u5f53\u8fde\u63a5\u5b8c\u6210\u540e, \u5411Server\u7aef\u53d1\u9001\u6d88\u606f\\n\\n####\\t2.1 \u7f16\u5199NIO\u4ee3\u7801\\n\\n#####\\t\\t2.2.1 Server\u7aef\u4ee3\u7801\\n\\n```java\\nimport java.io.IOException;\\nimport java.net.InetSocketAddress;\\nimport java.nio.ByteBuffer;\\nimport java.nio.channels.SelectionKey;\\nimport java.nio.channels.Selector;\\nimport java.nio.channels.ServerSocketChannel;\\nimport java.nio.channels.SocketChannel;\\nimport java.util.Iterator;\\n\\npublic class NIOServerDemo {\\n    public static void main(String[] args) throws IOException {\\n        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();\\n        serverSocketChannel.configureBlocking(false);\\n        Selector selector = Selector.open();\\n        serverSocketChannel.bind(new InetSocketAddress(9999));\\n        // \u5c06serverSocketChannel\u7684\u53ef\u63a5\u53d7\u4e8b\u4ef6\u6ce8\u518c\u5230selector\u4e0a\u9762,\\n        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);\\n        while (true) {\\n            int resultCode = selector.select(1000);\\n            if (resultCode == 0) {\\n                System.out.println(\\"\u670d\u52a1\u5668\u7b49\u5f85\u54271s, \u65e0\u8fde\u63a5\\");\\n                continue;\\n            }\\n            Iterator<SelectionKey> iterator = selector.selectedKeys().iterator();\\n            while (iterator.hasNext()) {\\n                try {\\n                    SelectionKey selectionKey = iterator.next();\\n                    // \u5f53\u524d\u4e8b\u4ef6\u662f\u5426\u53ef\u63a5\u53d7\\n                    if (selectionKey.isAcceptable()) {\\n                        System.out.println(\\"client \u8fde\u63a5\u6210\u529f\\" + serverSocketChannel.hashCode());\\n                        // \u62ff\u5230\u63a5\u53d7\u7684socketChannel,\u5c06\u5ba2\u6237\u7aefchannel\u7684read\u4e8b\u4ef6\u6ce8\u518c\u5230selector\u4e0a\u9762\u53bb\\n                        SocketChannel socketChannel = serverSocketChannel.accept();\\n                        socketChannel.configureBlocking(false);\\n                        socketChannel.register(selector, SelectionKey.OP_READ, ByteBuffer.allocate(1024));\\n                    }\\n                    // \u5f53\u524d\u4e8b\u4ef6\u662f\u5426\u662f\u53ef\u8bfb\u4e8b\u4ef6\\n                    if (selectionKey.isReadable()) {\\n                        // \u4ecechannel\u62ff\u5230\u6d88\u606f, \u5e76\u4e14\u8bfb\u53d6\u51fa\u6765\\n                        SocketChannel channel = (SocketChannel) selectionKey.channel();\\n                        ByteBuffer attachment = (ByteBuffer) selectionKey.attachment();\\n                        channel.read(attachment);\\n                        System.out.println(\\"\u53d7\u5230\u5ba2\u6237\u7aef\u4fe1\u606f:\\" + new String(attachment.array()));\\n                    }\\n                } catch (Exception e) {\\n                    System.out.println(e);\\n                } finally {\\n                    // \u6700\u597d\u522b\u5fd8\u4e86\u79fb\u51fakey\\n                    iterator.remove();\\n                }\\n            }\\n        }\\n    }\\n}\\n\\n```\\n\\n#####\\t2.2.2 Client\u7aef\u4ee3\u7801\\n\\n```java\\nimport java.net.InetSocketAddress;\\nimport java.nio.ByteBuffer;\\nimport java.nio.channels.SocketChannel;\\nimport java.nio.charset.StandardCharsets;\\n\\n/**\\n * socket clilent \u8fde\u63a5server\\n */\\npublic class NIOClientDemo {\\n    public static void main(String[] args) throws Exception {\\n\\n        // \u521b\u5efaSocketChannel, \u5e76\u4e14\u8fde\u63a5\u672c\u57309999 \u7aef\u53e3\\n        SocketChannel socketChannel = SocketChannel.open();\\n        InetSocketAddress inetSocketAddress = new InetSocketAddress(\\"192.168.31.31\\", 9999);\\n        socketChannel.configureBlocking(false);\\n        if (!socketChannel.connect(inetSocketAddress)) {\\n            while (!socketChannel.finishConnect()) {\\n                System.out.println(\\"\u8fde\u63a5\u9700\u8981\u65f6\u95f4\\");\\n            }\\n        }\\n        System.out.println(\\"\u8fde\u63a5server\u6210\u529f\\");\\n        // \u53d1server\u7aef\u53d1\u9001\u6d88\u606f\\n        String str = \\"hello world\\";\\n        ByteBuffer wrap = ByteBuffer.wrap(str.getBytes(StandardCharsets.UTF_8));\\n        int write = socketChannel.write(wrap);\\n        // \u6302\u8d77\u7a0b\u5e8f\\n        System.in.read();\\n    }\\n}\\n\\n```\\n\\n\\n\\n####\\t2.2\\t\u542f\u52a8\u7a0b\u5e8f\\n\\n\u542f\u52a8Server\\n\\n![image-20220124071414769](./2022-01-23-java-bio-diffrent-from-nio.assets/image-20220124071414769.png)\\n\\n\u542f\u52a8Client\\n\\n![image-20220124071513381](./2022-01-23-java-bio-diffrent-from-nio.assets/image-20220124071513381.png)\\n\\n##### 2.3\\t\u63a7\u5236\u53f0\u89c2\u5bdf\u7ed3\u679c\\n\\n\u671f\u671bServer\u7aef\u6536\u5230 Client \u7aef\u7684\u6d88\u606f\\n\\n![image-20220124071559323](./2022-01-23-java-bio-diffrent-from-nio.assets/image-20220124071559323.png)\\n\\n##\\t\u603b\u7ed3\\n\\n1.  \u901a\u8fc7\u7f16\u5199BIO \u548cNIO\u7684\u4ee3\u7801\u53ef\u4ee5\u5f97\u51fa, BIO\u662f\u6bcf\u4e2a\u7ebf\u7a0b\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42, \u4f46\u662fNIO\u53ef\u4ee5\u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406\u591a\u4e2a\u8bf7\u6c42.\\n2. NIO\u662f\u901a\u8fc7\u5c06channel\u7684\u4e8b\u4ef6\u6ce8\u518c\u5230selector\u4e0a\u9762, \u7136\u540e\u8f6e\u8be2\u4e8b\u4ef6,\u5904\u7406\u4e0d\u540c\u7684\u4e8b\u4ef6.\\n\\n."}]}')}}]);