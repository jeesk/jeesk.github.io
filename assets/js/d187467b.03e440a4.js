"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9171],{3905:function(n,e,t){t.d(e,{Zo:function(){return s},kt:function(){return d}});var r=t(7294);function o(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function i(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function a(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?i(Object(t),!0).forEach((function(e){o(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function l(n,e){if(null==n)return{};var t,r,o=function(n,e){if(null==n)return{};var t,r,o={},i=Object.keys(n);for(r=0;r<i.length;r++)t=i[r],e.indexOf(t)>=0||(o[t]=n[t]);return o}(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)t=i[r],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}var p=r.createContext({}),c=function(n){var e=r.useContext(p),t=e;return n&&(t="function"==typeof n?n(e):a(a({},e),n)),t},s=function(n){var e=c(n.components);return r.createElement(p.Provider,{value:e},n.children)},g={inlineCode:"code",wrapper:function(n){var e=n.children;return r.createElement(r.Fragment,{},e)}},u=r.forwardRef((function(n,e){var t=n.components,o=n.mdxType,i=n.originalType,p=n.parentName,s=l(n,["components","mdxType","originalType","parentName"]),u=c(t),d=o,m=u["".concat(p,".").concat(d)]||u[d]||g[d]||i;return t?r.createElement(m,a(a({ref:e},s),{},{components:t})):r.createElement(m,a({ref:e},s))}));function d(n,e){var t=arguments,o=e&&e.mdxType;if("string"==typeof n||o){var i=t.length,a=new Array(i);a[0]=u;var l={};for(var p in e)hasOwnProperty.call(e,p)&&(l[p]=e[p]);l.originalType=n,l.mdxType="string"==typeof n?n:o,a[1]=l;for(var c=2;c<i;c++)a[c]=t[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},4771:function(n,e,t){t.r(e),t.d(e,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return c},assets:function(){return s},toc:function(){return g},default:function(){return d}});var r=t(7462),o=t(3366),i=(t(7294),t(3905)),a=["components"],l={slug:"spring-boot-mercy-flink",title:"Spring-boot \u6574\u5408flink \u6559\u7a0b",authors:["jeesk"],tags:["java","spring-boot","flink"]},p=void 0,c={permalink:"/java/spring-boot-mercy-flink",source:"@site/java/2021-01-12-spring-boot-mercy-flink.md",title:"Spring-boot \u6574\u5408flink \u6559\u7a0b",description:"Flink\u6846\u67b6\uff1aFlink\u6574\u5408springboot",date:"2021-01-12T00:00:00.000Z",formattedDate:"January 12, 2021",tags:[{label:"java",permalink:"/java/tags/java"},{label:"spring-boot",permalink:"/java/tags/spring-boot"},{label:"flink",permalink:"/java/tags/flink"}],readingTime:3.125,truncated:!1,authors:[{name:"jeesk",title:"java engineer",url:"https://shanjiancaofu.com",imageURL:"https://shanjiancaofu.com/img/avtor.png",key:"jeesk"}],frontMatter:{slug:"spring-boot-mercy-flink",title:"Spring-boot \u6574\u5408flink \u6559\u7a0b",authors:["jeesk"],tags:["java","spring-boot","flink"]},prevItem:{title:"Java BiO\u548cNIO\u7684\u533a\u522b",permalink:"/java/java-bio-diffrent-from-nio"},nextItem:{title:"JAVA \u5e38\u89c1\u65e5\u5fd7\u4f9d\u8d56\u5904\u7406\u7ec6\u8282",permalink:"/java/java-log-adapter-study"}},s={authorsImageUrls:[void 0]},g=[{value:"Flink\u6846\u67b6\uff1aFlink\u6574\u5408springboot",id:"flink\u6846\u67b6flink\u6574\u5408springboot",children:[{value:"1. \u5b9e\u73b0\u539f\u7406",id:"1-\u5b9e\u73b0\u539f\u7406",children:[],level:4},{value:"2. \u4ee3\u7801\u5b9e\u6218",id:"2-\u4ee3\u7801\u5b9e\u6218",children:[{value:"1.\tspring boot \u542f\u52a8\u5de5\u5177\u7c7b",id:"1spring-boot-\u542f\u52a8\u5de5\u5177\u7c7b",children:[],level:5},{value:"2.\tflink job",id:"2flink-job",children:[],level:5},{value:"3. flink \u4f7f\u7528logback \u8fd8\u662flog4j,  \u672cdemo \u4f7f\u7528\u7684\u662fLogback , \u9700\u8981\u505a\u4ee5\u4e0b\u7684\u5904\u7406",id:"3-flink-\u4f7f\u7528logback-\u8fd8\u662flog4j--\u672cdemo-\u4f7f\u7528\u7684\u662flogback--\u9700\u8981\u505a\u4ee5\u4e0b\u7684\u5904\u7406",children:[],level:5}],level:4},{value:"3.\u53c2\u8003\u5185\u5bb9",id:"3\u53c2\u8003\u5185\u5bb9",children:[],level:4}],level:2}],u={toc:g};function d(n){var e=n.components,t=(0,o.Z)(n,a);return(0,i.kt)("wrapper",(0,r.Z)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"flink\u6846\u67b6flink\u6574\u5408springboot"},"Flink\u6846\u67b6\uff1aFlink\u6574\u5408springboot"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u9996\u5148\u8bf4\u4e00\u4e0b\uff0c \u4e3a\u4ec0\u4e48flink \u9700\u8981\u96c6\u6210flink\uff0c spring boot\u7ed9\u6211\u4eec\u5e26\u6765\u4e86\u66f4\u597d\u7684\u6846\u67b6\u6574\u5408\uff0c \u540c\u65f6\u4f7f\u7528spring\u7684DI\u548cIOC\uff0c\u80fd\u66f4\u597d\u7684\u4f7f\u7528bean\uff0c\u5f53\u7136\u76f4\u63a5\u4f7f\u7528spring \u6574\u5408\u4e5f\u662f\u4e00\u6837\u3002\u540e\u6765\u6211\u4eec\u4f7f\u7528\u4e86google guice \u6765\u6574\u5408\u3002")),(0,i.kt)("h4",{id:"1-\u5b9e\u73b0\u539f\u7406"},"1. \u5b9e\u73b0\u539f\u7406"),(0,i.kt)("p",null,"\u5b9e\u73b0\u539f\u7406\uff0c spring \u7684\u542f\u52a8 \u4e00\u822c\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"AnnotationConfigApplicationContext ac =  new AnnotationConfigApplicationContext(AppConfig.class);"),"   \u5373\u53ef\u542f\u52a8spring \u5bb9\u5668\uff0c \u5bf9\u4e48spring boot \u5462\uff0c \u770b\u8fc7\u6e90\u7801\u7684\u4eba\u6216\u8bb8\u77e5\u9053"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"SpringApplication.run(arge);"),"  \u53ea\u9700\u8981\u5728\u542f\u52a8flink\u4e4b\u524d\u542f\u52a8sping boot \u5373\u53ef\u3002"),(0,i.kt)("h4",{id:"2-\u4ee3\u7801\u5b9e\u6218"},"2. \u4ee3\u7801\u5b9e\u6218"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"flink \u6574\u5408spring boot \u4ee5\u53caredission, \u5e76\u5c06\u4e8b\u4ef6\u7684id\u653e\u5165redis \u4e2d\uff0c \u4ee3\u7801\u5e93  ",(0,i.kt)("a",{parentName:"p",href:"https://gitee.com/imomoda/flink-sprint-boot"},"https://gitee.com/imomoda/flink-sprint-boot"))),(0,i.kt)("h5",{id:"1spring-boot-\u542f\u52a8\u5de5\u5177\u7c7b"},"1.\tspring boot \u542f\u52a8\u5de5\u5177\u7c7b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@SpringBootApplication(scanBasePackages = {"io.github.jeesk.flink"})\n@Import(SpringUtil.class)\n@Slf4j\n@EnableConfigurationProperties({RedissonProperties.class, RedisProperties.class})\npublic class SpringBootApplicationUtil {\n\n\n    static SpringApplication springBootApplication = null;\n    static SpringApplicationBuilder springApplicationBuilder = null;\n\n    public static synchronized void run(String[] arge) {\n        if (springBootApplication == null) {\n            StandardEnvironment standardEnvironment = new StandardEnvironment();\n            MutablePropertySources propertySources = standardEnvironment.getPropertySources();\n            propertySources.addFirst(new SimpleCommandLinePropertySource(arge));\n            String startJarPath = SpringBootApplicationUtil.class.getResource("/").getPath().split("!")[0];\n            String[] activeProfiles = standardEnvironment.getActiveProfiles();\n            propertySources.addLast(new MapPropertySource("systemProperties", standardEnvironment.getSystemProperties()));\n            propertySources.addLast(new SystemEnvironmentPropertySource("systemEnvironment", standardEnvironment.getSystemEnvironment()));\n            if (springBootApplication == null) {\n                springApplicationBuilder = new SpringApplicationBuilder(SpringBootApplicationUtil.class);\n                // \u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u4f20\u5165\n                springApplicationBuilder.profiles("dev");\n                springApplicationBuilder.sources(SpringBootApplicationUtil.class).web(WebApplicationType.NONE);\n            }\n            springBootApplication = springApplicationBuilder.build();\n            springBootApplication.run(arge);\n        }\n    }\n\n\n}\n')),(0,i.kt)("h5",{id:"2flink-job"},"2.\tflink job"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'package io.github.jeesk.flink;\n\nimport cn.hutool.extra.spring.SpringUtil;\nimport io.github.jeesk.flink.config.SpringBootApplicationUtil;\nimport org.apache.flink.configuration.Configuration;\nimport org.apache.flink.streaming.api.datastream.DataStream;\nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\nimport org.apache.flink.streaming.api.functions.KeyedProcessFunction;\nimport org.apache.flink.util.Collector;\nimport org.apache.flink.walkthrough.common.entity.Alert;\nimport org.apache.flink.walkthrough.common.entity.Transaction;\nimport org.apache.flink.walkthrough.common.sink.AlertSink;\nimport org.apache.flink.walkthrough.common.source.TransactionSource;\nimport org.springframework.data.redis.core.StringRedisTemplate;\n\npublic class FraudDetectionJob {\n    public static void main(String[] args) throws Exception {\n\n        Configuration configuration = new Configuration();\n        if (args != null) {\n            configuration.setString("args", String.join(" ", args));\n        }\n        SpringBootApplicationUtil.run(args);\n\n        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\n        DataStream<Transaction> transactions = env\n                .addSource(new TransactionSource())\n                .name("transactions");\n\n        DataStream<Alert> alerts = transactions\n                .keyBy(Transaction::getAccountId)\n                .process(new FraudDetector())\n                .name("fraud-detector");\n\n        alerts\n                .addSink(new AlertSink())\n                .name("send-alerts");\n\n        env.execute("Fraud Detection");\n    }\n\n    static public class FraudDetector extends KeyedProcessFunction<Long, Transaction, Alert> {\n\n        private StringRedisTemplate redisTemplate = null;\n\n        @Override\n        public void open(Configuration parameters) throws Exception {\n            // \u521d\u59cb\u5316bean\n            super.open(parameters);\n            SpringBootApplicationUtil.run(parameters.getString("arge", "").split(" "));\n            redisTemplate = SpringUtil.getBean(StringRedisTemplate.class);\n\n        }\n\n        @Override\n        public void processElement(\n                Transaction transaction,\n                Context context,\n                Collector<Alert> collector) throws Exception {\n\n            Alert alert = new Alert();\n            alert.setId(transaction.getAccountId());\n            // \u5c06id \u653e\u5165redis \u4e2d\n            redisTemplate.opsForSet().add("tmpKey", String.valueOf(alert.getId()));\n            collector.collect(alert);\n        }\n    }\n}\n\n')),(0,i.kt)("h5",{id:"3-flink-\u4f7f\u7528logback-\u8fd8\u662flog4j--\u672cdemo-\u4f7f\u7528\u7684\u662flogback--\u9700\u8981\u505a\u4ee5\u4e0b\u7684\u5904\u7406"},"3. flink \u4f7f\u7528logback \u8fd8\u662flog4j,  \u672cdemo \u4f7f\u7528\u7684\u662fLogback , \u9700\u8981\u505a\u4ee5\u4e0b\u7684\u5904\u7406"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u670d\u52a1\u5668\u7aef\u5904\u7406:    flink \u7684\u5b89\u88c5\u76ee\u5f55\u4e0b\u9762\u653e\u5165logback \u7684\u5305\uff0c",(0,i.kt)("inlineCode",{parentName:"li"},"log4j-over-slf4j-1.7.15.jar,logback-classic-1.2.3.jar,logback-core-1.2.3.jar ")," ,"),(0,i.kt)("li",{parentName:"ol"},"\u7136\u540e\u5220\u9664lib\u4e0b\u9762\u5173\u4e8elog4j\u7684\u5305 ",(0,i.kt)("inlineCode",{parentName:"li"},"log4j-1.2.17.jar\u53caslf4j-log4j12-1.7.15.jar"),"), \u5982\u679c\u4e0d\u61c2\u8fd9\u4e9b\u5305\u7684\u4f5c\u7528\u53ef\u4ee5\u4ed4\u7ec6\u9605\u8bfb: ",(0,i.kt)("a",{parentName:"li",href:"https://www.jianshu.com/p/7d12a8c25a38"},"JAVA \u5e38\u89c1\u65e5\u5fd7\u4f9d\u8d56\u5904\u7406\u7ec6\u8282"),"  \uff0c"),(0,i.kt)("li",{parentName:"ol"},"\u5728\u4ee3\u7801\u7684pom\u6587\u4ef6\u91cc\u9762\u6392\u9664log4j\u7684\u5305")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"```\n    <dependency>\n        <groupId>org.apache.flink</groupId>\n        <artifactId>flink-java</artifactId>\n        <version>1.13.1</version>\n        \x3c!--\u6392\u9664log4j--\x3e\n        <exclusions>\n            <exclusion>\n                <groupId>log4j</groupId>\n                <artifactId>*</artifactId>\n            </exclusion>\n            <exclusion>\n                <groupId>org.slf4j</groupId>\n                <artifactId>slf4j-log4j12</artifactId>\n            </exclusion>\n        </exclusions>\n        <scope>provided</scope>\n        </dependency>\n<dependency>\n            <groupId>org.apache.flink</groupId>\n            <artifactId>flink-streaming-java_2.12</artifactId>\n            <version>1.13.1</version>\n            \x3c!--\u6392\u9664log4j--\x3e\n            <exclusions>\n                <exclusion>\n                    <groupId>log4j</groupId>\n                    <artifactId>*</artifactId>\n                </exclusion>\n                <exclusion>\n                    <groupId>org.slf4j</groupId>\n                    <artifactId>slf4j-log4j12</artifactId>\n                </exclusion>\n            </exclusions>\n           <scope>provided</scope>\n </dependency>\n")),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c\u60f3\u4fee\u6539flink \u7684logback\u7684\u65e5\u5fd7\u6587\u4ef6 \uff0c \u53ef\u4ee5\u5728flink\u7684conf\u76ee\u5f55\u4e0b\u9762\u4fee\u6539\u4e0b\u9762\u7684\u4e09\u4e2a\u6587\u4ef6")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"logback-console.xml\nlogback-session.xml\nlogback.xml\n")),(0,i.kt)("h4",{id:"3\u53c2\u8003\u5185\u5bb9"},"3.\u53c2\u8003\u5185\u5bb9"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/gouyg/p/storm-springboot.html"},"Storm\u6846\u67b6\uff1aStorm\u6574\u5408springboot"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://blog.csdn.net/qq_36643786/article/details/90401822"},"Flink\u4f7f\u7528logback\u987b\u77e5")))))}d.isMDXComponent=!0}}]);