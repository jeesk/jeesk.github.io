<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/java/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/java/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/database/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/database/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/microservice/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/microservice/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/data-structure-and-algorithm/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/data-structure-and-algorithm/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/devops/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/devops/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed"><title data-react-helmet="true">Blog | å±±é—´è‰å¤«çš„å°ç«™</title><meta data-react-helmet="true" property="og:title" content="Blog | å±±é—´è‰å¤«çš„å°ç«™"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://shanjiancaofu.com/java"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://shanjiancaofu.com/java"><link data-react-helmet="true" rel="alternate" href="https://shanjiancaofu.com/java" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://shanjiancaofu.com/java" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7ec3e632.css">
<link rel="preload" href="/assets/js/runtime~main.d6c809c7.js" as="script">
<link rel="preload" href="/assets/js/main.0c9f8076.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/avtor.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/avtor.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">å±±é—´è‰å¤«</b></a><a class="navbar__item navbar__link" href="/docs/intro">æºç åˆ†æ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/java">Java</a><a class="navbar__item navbar__link" href="/devops">Devops</a><a class="navbar__item navbar__link" href="/data-structure-and-algorithm">æ•°æ®ç»“æ„ä¸ç®—æ³•</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jeesk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ğŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ğŸŒ</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">All Blog Posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/elasticsearch-user-rtb-ad">Elasticsearch åœ¨ç«ä»·å¹¿å‘Šä¸­çš„æ£€ç´¢ä½¿ç”¨</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/java-bio-diffrent-from-nio">Java BiOå’ŒNIOçš„åŒºåˆ«</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/spring-boot-mercy-flink">Spring-boot æ•´åˆflink æ•™ç¨‹</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/java-log-adapter-study">JAVA å¸¸è§æ—¥å¿—ä¾èµ–å¤„ç†ç»†èŠ‚</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/kafka-msg-keep-ordered">kafkaæ¶ˆæ¯é¡ºåºä¿æŒä¸€è‡´æ€§çš„å¤„ç†æ–¹å¼</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/webflux-vs-servlet3.0-pressure-test">webflux,kakfa,redis,protostuff ååé‡ä¼˜åŒ–è¿‘4000QPS</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/java-opt-note">java æ€§èƒ½ä¼˜åŒ–ç¬”è®°</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/java-threadpool-config-opt-adivse">ThreadPoolExecutorå‚æ•°è¯¦è§£å’Œä¼˜åŒ–å»ºè®®</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/log4j-print-log">log4jæ‰“å°æ—¥å¿—çš„åŸç†</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/java/elasticsearch-user-rtb-ad">Elasticsearch åœ¨ç«ä»·å¹¿å‘Šä¸­çš„æ£€ç´¢ä½¿ç”¨</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-02-05T00:00:00.000Z" itemprop="datePublished">February 5, 2022</time> Â· <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://shanjiancaofu.com/img/avtor.png" alt="jeesk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">jeesk</span></a></div><small class="avatar__subtitle" itemprop="description">java engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="elasticsearch-åœ¨ç«ä»·å¹¿å‘Šä¸­çš„æ£€ç´¢ä½¿ç”¨">Elasticsearch åœ¨ç«ä»·å¹¿å‘Šä¸­çš„æ£€ç´¢ä½¿ç”¨<a class="hash-link" href="#elasticsearch-åœ¨ç«ä»·å¹¿å‘Šä¸­çš„æ£€ç´¢ä½¿ç”¨" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¸€å¹¿å‘Šå®šå‘ç®€è¿°">ä¸€ã€å¹¿å‘Šå®šå‘ç®€è¿°<a class="hash-link" href="#ä¸€å¹¿å‘Šå®šå‘ç®€è¿°" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="11-åœ¨ç«ä»·å¹¿å‘Šä¸­çš„å®šå‘æ¡ä»¶å¾€å¾€å¦‚ä¸‹æ‰€ç¤º">1.1 åœ¨ç«ä»·å¹¿å‘Šä¸­çš„å®šå‘æ¡ä»¶å¾€å¾€å¦‚ä¸‹æ‰€ç¤º<a class="hash-link" href="#11-åœ¨ç«ä»·å¹¿å‘Šä¸­çš„å®šå‘æ¡ä»¶å¾€å¾€å¦‚ä¸‹æ‰€ç¤º" title="Direct link to heading">â€‹</a></h4><ul><li>ad1  å®šå‘ä¸ºåœ°åŸŸåŒ—äº¬,ä¸Šæµ·,å¹¿å·,æ·±åœ³,18~28å²çš„æ—…æ¸¸,å¥èº«è¡Œä¸šç”·æ€§,å¹¶ä¸”è¦æ±‚é€‚ç”¨çš„æ“ä½œç³»ç»Ÿä¸ºios,android,å¹¿å‘Šå‡ºä»·5å—</li><li>ad2  å®šå‘ä¸ºåœ°åŸŸæˆéƒ½åœ¨18~28å²çš„å¥èº«è¡Œä¸šç”·æ€§,å¹¶ä¸”è¦æ±‚é€‚ç”¨çš„æ“ä½œç³»ç»Ÿä¸ºioså’Œmac,å¹¿å‘Šå‡ºä»·4.8å—</li><li>ad3  å®šå‘ä¸ºåœ¨28~38å²çš„ç”·æ€§,å¹¶ä¸”è¦æ±‚é€‚ç”¨çš„æ“ä½œç³»ç»Ÿä¸ºandroid,å¹¿å‘Šå‡ºä»·5.7å—</li><li>ad4  å®šå‘ä¸ºåœ¨28~38å²,å¹¶ä¸”è¦æ±‚é€‚ç”¨çš„æ“ä½œç³»ç»Ÿä¸ºios,å¹¿å‘Šå‡ºä»·5.2å—</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="12--è§’è‰²å¯¹åº”å¹¿å‘Šåˆ†æ">1.2  è§’è‰²å¯¹åº”å¹¿å‘Šåˆ†æ<a class="hash-link" href="#12--è§’è‰²å¯¹åº”å¹¿å‘Šåˆ†æ" title="Direct link to heading">â€‹</a></h4><ul><li>è§’è‰²1:     åŒ—äº¬,å¥³æ€§,å¥èº«è¡Œä¸š,æ“ä½œç³»ç»Ÿios</li><li>è§’è‰²2:     å¹¿å·,ç”·æ€§,18~28å²,æ—…æ¸¸è¡Œä¸š,æ“ä½œç³»ç»Ÿä¸ºios</li><li>è§’è‰²3:     æˆéƒ½,å¥³æ€§,28~38å²,å¥èº«è¡Œä¸š,æ“ä½œç³»ç»Ÿä¸ºios</li><li>è§’è‰²4:     æˆéƒ½,ç”·æ€§,28~38å²,å¥èº«è¡Œä¸š,æ“ä½œç³»ç»Ÿä¸ºios</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="13--è®¤çœŸåˆ†æåå¾—å‡ºä¸‹é¢æ¯ä¸ªè§’è‰²å¯ä»¥æ¨é€çš„å¹¿å‘Šå¦‚ä¸‹">1.3.  è®¤çœŸåˆ†æåå¾—å‡ºä¸‹é¢æ¯ä¸ªè§’è‰²å¯ä»¥æ¨é€çš„å¹¿å‘Šå¦‚ä¸‹<a class="hash-link" href="#13--è®¤çœŸåˆ†æåå¾—å‡ºä¸‹é¢æ¯ä¸ªè§’è‰²å¯ä»¥æ¨é€çš„å¹¿å‘Šå¦‚ä¸‹" title="Direct link to heading">â€‹</a></h4><ul><li>è§’è‰²1:  ad4</li><li>è§’è‰²2:  ad1,ad4</li><li>è§’è‰²3:  ad4</li><li>è§’è‰²4:  ad2,ad4</li></ul><p>å¾€å¾€ä¼ ç»Ÿæ•°æ®åº“æ— æ³•æ»¡è¶³ä¸Šè¿°çš„æŸ¥è¯¢æ—¶å»¶, å¤§å‚å¾€å¾€åˆå¼€å‘è‡ªå·±çš„å€’æ’ç´¢å¼•ç³»ç»Ÿ, ä¸ºäº†å‡å°‘æˆæœ¬, å¯ä»¥ä½¿ç”¨elasticsearchçš„å¸ƒå°”æŸ¥è¯¢.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="äºŒä½¿ç”¨elasticsearch-æŸ¥è¯¢å®æ—¶æŸ¥è¯¢å¹¿å‘Š">äºŒã€ä½¿ç”¨elasticsearch æŸ¥è¯¢å®æ—¶æŸ¥è¯¢å¹¿å‘Š<a class="hash-link" href="#äºŒä½¿ç”¨elasticsearch-æŸ¥è¯¢å®æ—¶æŸ¥è¯¢å¹¿å‘Š" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="21---mysqlä¸­-å¦‚æœè¦æŸ¥è¯¢æŸä¸ªç”¨æˆ·æ»¡è¶³çš„å¹¿å‘Šæ¡ä»¶å¦‚ä¸‹å¯æ•´ç†ä¸ºè¡¨è¾¾å¼">2.1.   mysqlä¸­, å¦‚æœè¦æŸ¥è¯¢æŸä¸ªç”¨æˆ·æ»¡è¶³çš„å¹¿å‘Šæ¡ä»¶å¦‚ä¸‹å¯æ•´ç†ä¸ºè¡¨è¾¾å¼<a class="hash-link" href="#21---mysqlä¸­-å¦‚æœè¦æŸ¥è¯¢æŸä¸ªç”¨æˆ·æ»¡è¶³çš„å¹¿å‘Šæ¡ä»¶å¦‚ä¸‹å¯æ•´ç†ä¸ºè¡¨è¾¾å¼" title="Direct link to heading">â€‹</a></h4><p>[ï¼ˆä¸å­˜åœ¨æ€§åˆ«å®šå‘ï¼‰|| ï¼ˆå­˜åœ¨æ€§åˆ«å®šå‘ä¸”æ»¡è¶³æ¡ä»¶ï¼‰]<br>
<!-- -->&amp;&amp;  <!-- -->[ï¼ˆä¸å­˜åœ¨å¹´é¾„å®šå‘ï¼‰|| ï¼ˆå­˜åœ¨å¹´é¾„å®šå‘ä¸”æ»¡è¶³æ¡ä»¶ï¼‰]<!-- -->
&amp;&amp;  <!-- -->[ï¼ˆä¸å­˜åœ¨æ ‡ç­¾å®šå‘ï¼‰|| ï¼ˆå­˜åœ¨æ ‡ç­¾å®šå‘ä¸”æ»¡è¶³æ¡ä»¶ï¼‰]<!-- -->
&amp;&amp;  <!-- -->[ï¼ˆä¸å­˜åœ¨åœ°åŸŸå®šå‘ï¼‰|| ï¼ˆå­˜åœ¨åœ°åŸŸå®šå‘ä¸”æ»¡è¶³æ¡ä»¶ï¼‰]<!-- -->
&amp;&amp;  <!-- -->[ï¼ˆä¸å­˜åœ¨æ“ä½œç³»ç»Ÿå®šå‘ï¼‰|| ï¼ˆå­˜åœ¨æ“ä½œç³»ç»Ÿå®šå‘ä¸”æ»¡è¶³æ¡ä»¶ï¼‰]</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="22--å‡†å¤‡å·¥å…·--postman-æˆ–è€…æ”¯æŒcurlå‘½ä»¤è¡Œ-ä¸€å°å®‰è£…äº†dockerçš„æœºå™¨">2.2  å‡†å¤‡å·¥å…·:  postman æˆ–è€…æ”¯æŒcurlå‘½ä»¤è¡Œ, ä¸€å°å®‰è£…äº†dockerçš„æœºå™¨<a class="hash-link" href="#22--å‡†å¤‡å·¥å…·--postman-æˆ–è€…æ”¯æŒcurlå‘½ä»¤è¡Œ-ä¸€å°å®‰è£…äº†dockerçš„æœºå™¨" title="Direct link to heading">â€‹</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="221æ‹‰å–esé•œåƒå¹¶ä¸”è¿è¡Œèµ·æ¥">2.2.1	æ‹‰å–esé•œåƒ,å¹¶ä¸”è¿è¡Œèµ·æ¥<a class="hash-link" href="#221æ‹‰å–esé•œåƒå¹¶ä¸”è¿è¡Œèµ·æ¥" title="Direct link to heading">â€‹</a></h5><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull docker.io/elasticsearch:7.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d --name es1  -e </span><span class="token assign-left variable" style="color:#36acaa">ES_JAVA_OPTS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;-Xms512m -Xmx512m&quot;</span><span class="token plain"> -p </span><span class="token number" style="color:#36acaa">9200</span><span class="token plain">:9200 -p </span><span class="token number" style="color:#36acaa">9300</span><span class="token plain">:9300 -e </span><span class="token string" style="color:#e3116c">&quot;discovery.type=single-node&quot;</span><span class="token plain"> b0e9f9f047e6</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="222----æ‰§è¡Œå‘½ä»¤">2.2.2    æ‰§è¡Œå‘½ä»¤<a class="hash-link" href="#222----æ‰§è¡Œå‘½ä»¤" title="Direct link to heading">â€‹</a></h5><p>postmanæˆ–è€…å‘½ä»¤è¡Œä¸­æ‰§è¡Œ <code>curl --location --request GET &#x27;http://192.168.17.77:9200&#x27;</code></p><p>å¦‚æœè¿”å›ä¸‹é¢çš„æ–‡æ¡£è¯´æ˜ä½ å®‰è£…å•æœºç‰ˆæœ¬çš„elasticsearchå·²ç»å®‰è£…å®Œæˆ</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx json"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cc51cc2a79ce&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;cluster_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;docker-cluster&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;cluster_uuid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;BveCHkuVTtWwr-rcWDmTpg&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;7.1.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;build_flavor&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;default&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;build_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;docker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;build_hash&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;7a013de&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;build_date&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2019-05-23T14:04:00.380842Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;build_snapshot&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;lucene_version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;8.0.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;minimum_wire_compatibility_version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;6.8.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;minimum_index_compatibility_version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;6.0.0-beta1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;tagline&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;You Know, for Search&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="23--å»ºç«‹å¹¿å‘Šç´¢å¼•æŸ¥è¯¢å¹¿å‘Šä½å¯¹åº”å¹¿å‘Š">2.3.  å»ºç«‹å¹¿å‘Šç´¢å¼•,æŸ¥è¯¢å¹¿å‘Šä½å¯¹åº”å¹¿å‘Š<a class="hash-link" href="#23--å»ºç«‹å¹¿å‘Šç´¢å¼•æŸ¥è¯¢å¹¿å‘Šä½å¯¹åº”å¹¿å‘Š" title="Direct link to heading">â€‹</a></h4><p>é€šå¸¸ç”¨æˆ·è®¿é—®appæ‹‰å–å¹¿å‘Šæ˜¯ä»¥å¹¿å‘Šä½ä¸ºåŸºå‡†, è¯¥å¹¿å‘Šä½ä¸‹é¢æœ‰nä¸ªå¸¦æœ‰å®šå‘æ¡ä»¶çš„å¹¿å‘Š.é‚£ä¹ˆ æŸ¥è¯¢æ¡ä»¶å°±æ˜¯å¹¿å‘Šä½id,åº•ä»·+ä»¥åŠç”¨æˆ·è‡ªèº«çš„å±æ€§</p><p>åˆ›å»ºå¹¿å‘Šä½idä¸º100çš„ç´¢å¼•</p><p><code>curl --location --request PUT &#x27;http://192.168.17.77:9200/posfor100&#x27;</code></p><ol><li>å¢åŠ è¯¥ç´¢å¼•å¯¹åº”çš„æ•°æ®(ç±»å‹äºmysqlçš„è¡Œæ•°æ®)</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">åŒ—ä¸Šå¹¿æ·±,æˆéƒ½åˆ†åˆ«æ˜ å°„ä¸º 1,2,3,4,5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ç”·å¥³æ˜ å°„ä¸º1,2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">æ“ä½œç³»ç»Ÿios, android,mac æ˜ å°„ä¸º1,2,3  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">è¡Œä¸šæ—…æ¸¸,å¥èº«åˆ†åˆ«æ˜ å°„ä¸º 1,2 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">å¹´é¾„18~28 æ˜ å°„ä¸º2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>æ’å…¥å¯¹åº”çš„4æ¡æ•°æ®,å‡è®¾ä¸Šé¢4ä¸ªå¹¿å‘Šå¯¹åº”çš„idä¸º 101,102,103,104</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx json"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location --request POST &#x27;http</span><span class="token operator" style="color:#393A34">:</span><span class="token comment" style="color:#999988;font-style:italic">//192.168.17.77:9200/posfor100/_doc/101&#x27; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;Content-Type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data-raw &#x27;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;city&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;ageRange&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;gender&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;os&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;industry&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx json"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location --request POST &#x27;http</span><span class="token operator" style="color:#393A34">:</span><span class="token comment" style="color:#999988;font-style:italic">//192.168.17.77:9200/posfor100/_doc/102&#x27; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;Content-Type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data-raw &#x27;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;city&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;ageRange&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;gender&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;os&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;industry&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4.8</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx json"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location --request POST &#x27;http</span><span class="token operator" style="color:#393A34">:</span><span class="token comment" style="color:#999988;font-style:italic">//192.168.17.77:9200/posfor100/_doc/103&#x27; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;Content-Type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data-raw &#x27;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;ageRange&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;gender&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;os&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">5.7</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx json"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location --request POST &#x27;http</span><span class="token operator" style="color:#393A34">:</span><span class="token comment" style="color:#999988;font-style:italic">//192.168.17.77:9200/posfor100/_doc/104&#x27; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;Content-Type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data-raw &#x27;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;ageRange&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;os&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">5.2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol><li>å‡è®¾è¯¥å¹¿å‘Šä½100çš„åº•ä»·ä¸º3å—é’±,ä½¿ç”¨å¸ƒå°”æŸ¥è¯¢</li></ol><p>è§’è‰²1 å¯¹åº”çš„æŸ¥è¯¢</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> --location --request GET </span><span class="token string" style="color:#e3116c">&#x27;http://192.168.17.77:9200/posfor100/_search&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header </span><span class="token string" style="color:#e3116c">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data-raw </span><span class="token string" style="color:#e3116c">&#x27;{&quot;query&quot;:{&quot;bool&quot;:{&quot;filter&quot;:[{&quot;bool&quot;:{&quot;should&quot;:[{&quot;term&quot;:{&quot;gender&quot;:{&quot;value&quot;:2,&quot;boost&quot;:1.0}}},{&quot;bool&quot;:{&quot;must_not&quot;:[{&quot;exists&quot;:{&quot;field&quot;:&quot;gender&quot;,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;boost&quot;:1.0}},{&quot;bool&quot;:{&quot;should&quot;:[{&quot;term&quot;:{&quot;os&quot;:{&quot;value&quot;:1,&quot;boost&quot;:1.0}}},{&quot;bool&quot;:{&quot;must_not&quot;:[{&quot;exists&quot;:{&quot;field&quot;:&quot;os&quot;,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;boost&quot;:1.0}},{&quot;bool&quot;:{&quot;should&quot;:[{&quot;term&quot;:{&quot;city&quot;:{&quot;value&quot;:1,&quot;boost&quot;:1.0}}},{&quot;bool&quot;:{&quot;must_not&quot;:[{&quot;exists&quot;:{&quot;field&quot;:&quot;city&quot;,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;boost&quot;:1.0}},{&quot;bool&quot;:{&quot;should&quot;:[{&quot;term&quot;:{&quot;industry&quot;:{&quot;value&quot;:2,&quot;boost&quot;:1.0}}},{&quot;bool&quot;:{&quot;must_not&quot;:[{&quot;exists&quot;:{&quot;field&quot;:&quot;industry&quot;,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;boost&quot;:1.0}},{&quot;bool&quot;:{&quot;should&quot;:[{&quot;term&quot;:{&quot;ageRange&quot;:{&quot;value&quot;:2,&quot;boost&quot;:1.0}}},{&quot;bool&quot;:{&quot;must_not&quot;:[{&quot;exists&quot;:{&quot;field&quot;:&quot;ageRange&quot;,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;boost&quot;:1.0}},{&quot;bool&quot;:{&quot;filter&quot;:[{&quot;range&quot;:{&quot;price&quot;:{&quot;from&quot;:3.0,&quot;to&quot;:null,&quot;include_lower&quot;:true,&quot;include_upper&quot;:true,&quot;boost&quot;:1.0}}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>å¾—åˆ°æŸ¥è¯¢æ¡ä»¶å¦‚ä¸‹, è·å¾—äº†id 104çš„å¹¿å‘Š,å³æ˜¯å¹¿å‘Š4</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx json"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;took&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">403</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;timed_out&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;_shards&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;total&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;successful&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;skipped&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;failed&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;hits&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;total&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;relation&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eq&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;max_score&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;hits&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;posfor100&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_doc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;104&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_score&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_source&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;ageRange&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;os&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>è§’è‰²2å¯¹åº”çš„æŸ¥è¯¢</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> --location --request GET </span><span class="token string" style="color:#e3116c">&#x27;http://192.168.17.77:9200/posfor100/_search&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header </span><span class="token string" style="color:#e3116c">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data-raw </span><span class="token string" style="color:#e3116c">&#x27;{&quot;query&quot;:{&quot;bool&quot;:{&quot;filter&quot;:[{&quot;bool&quot;:{&quot;should&quot;:[{&quot;term&quot;:{&quot;gender&quot;:{&quot;value&quot;:1,&quot;boost&quot;:1.0}}},{&quot;bool&quot;:{&quot;must_not&quot;:[{&quot;exists&quot;:{&quot;field&quot;:&quot;gender&quot;,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;boost&quot;:1.0}},{&quot;bool&quot;:{&quot;should&quot;:[{&quot;term&quot;:{&quot;os&quot;:{&quot;value&quot;:1,&quot;boost&quot;:1.0}}},{&quot;bool&quot;:{&quot;must_not&quot;:[{&quot;exists&quot;:{&quot;field&quot;:&quot;os&quot;,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;boost&quot;:1.0}},{&quot;bool&quot;:{&quot;should&quot;:[{&quot;term&quot;:{&quot;city&quot;:{&quot;value&quot;:4,&quot;boost&quot;:1.0}}},{&quot;bool&quot;:{&quot;must_not&quot;:[{&quot;exists&quot;:{&quot;field&quot;:&quot;city&quot;,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;boost&quot;:1.0}},{&quot;bool&quot;:{&quot;should&quot;:[{&quot;term&quot;:{&quot;industry&quot;:{&quot;value&quot;:1,&quot;boost&quot;:1.0}}},{&quot;bool&quot;:{&quot;must_not&quot;:[{&quot;exists&quot;:{&quot;field&quot;:&quot;industry&quot;,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;boost&quot;:1.0}},{&quot;bool&quot;:{&quot;should&quot;:[{&quot;term&quot;:{&quot;ageRange&quot;:{&quot;value&quot;:2,&quot;boost&quot;:1.0}}},{&quot;bool&quot;:{&quot;must_not&quot;:[{&quot;exists&quot;:{&quot;field&quot;:&quot;ageRange&quot;,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;minimum_should_match&quot;:&quot;1&quot;,&quot;boost&quot;:1.0}},{&quot;bool&quot;:{&quot;filter&quot;:[{&quot;range&quot;:{&quot;price&quot;:{&quot;from&quot;:3.0,&quot;to&quot;:null,&quot;include_lower&quot;:true,&quot;include_upper&quot;:true,&quot;boost&quot;:1.0}}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}],&quot;adjust_pure_negative&quot;:true,&quot;boost&quot;:1.0}}}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>å¾—åˆ°çš„ç»“æœ</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx json"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;took&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;timed_out&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;_shards&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;total&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;successful&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;skipped&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;failed&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;hits&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;total&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;relation&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eq&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;max_score&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;hits&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;posfor100&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_doc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;101&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_score&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_source&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;city&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;ageRange&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;gender&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;os&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;industry&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;posfor100&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_doc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;104&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_score&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;_source&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;ageRange&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;os&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ç”±ä¸Šå¯å¾—è§’è‰²1è·å–åˆ°ad4,è§’è‰²2è·å–åˆ°ad1,ad4, å’Œæˆ‘ä»¬æœ€åˆå¾—åˆ°çš„ç»“è®ºæ˜¯ä¸€æ ·çš„2,  å‰©ä½™è§’è‰²3,è§’è‰²4å¯¹åº”çš„å¹¿å‘Š,è¯·å„ä½äº²è‡ªå·±åŠ¨æ‰‹éªŒè¯.  </p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¸‰å°ç»“">ä¸‰ã€å°ç»“<a class="hash-link" href="#ä¸‰å°ç»“" title="Direct link to heading">â€‹</a></h3><ol><li>åˆç†ä½¿ç”¨termå’Œprefixæœç´¢å¯ä»¥ç²¾å‡†çš„æ‰¾å‡ºå¤åˆå®šå‘æ¡ä»¶çš„æ•°æ®ï¼Œ è¿™å¯¹äºå¤§æ•°æ®åŒ¹é…æ¥è¯´ç›¸å½“å¥½ç”¨ã€‚ </li></ol><p>å‚è€ƒå¦‚ä¸‹</p><ol><li><a href="https://zhuanlan.zhihu.com/p/59658727" target="_blank" rel="noopener noreferrer">åŸºäºå¸ƒå°”è¡¨è¾¾å¼çš„å¹¿å‘Šç´¢å¼•è®¾è®¡</a></li><li><a href="https://www.knowledgedict.com/tutorial/elasticsearch-aggregations.html" target="_blank" rel="noopener noreferrer">Elasticsearchï¼ˆEsï¼‰èšåˆæŸ¥è¯¢ï¼ˆæŒ‡æ ‡èšåˆã€æ¡¶èšåˆï¼‰</a></li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/elasticsearch">elasticsearch</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/rtb-ad">rtb-ad</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/java/java-bio-diffrent-from-nio">Java BiOå’ŒNIOçš„åŒºåˆ«</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-01-23T00:00:00.000Z" itemprop="datePublished">January 23, 2022</time> Â· <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://shanjiancaofu.com/img/avtor.png" alt="jeesk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">jeesk</span></a></div><small class="avatar__subtitle" itemprop="description">java engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="nioå’Œbioçš„åŒºåˆ«æ€»ç»“">NIOå’ŒBIOçš„åŒºåˆ«æ€»ç»“<a class="hash-link" href="#nioå’Œbioçš„åŒºåˆ«æ€»ç»“" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="1-è¡¨æ ¼è¯´æ˜ä¸¤è€…çš„åŒºåˆ«">1. è¡¨æ ¼è¯´æ˜ä¸¤è€…çš„åŒºåˆ«<a class="hash-link" href="#1-è¡¨æ ¼è¯´æ˜ä¸¤è€…çš„åŒºåˆ«" title="Direct link to heading">â€‹</a></h3><table><thead><tr><th>IOç±»å‹</th><th>æ˜¯å¦é˜»å¡</th><th>åŒæ­¥IO</th><th>çº¿ç¨‹æ¨¡å‹</th></tr></thead><tbody><tr><td>BIO</td><td>é˜»å¡</td><td>æ˜¯</td><td>ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªè¯·æ±‚</td></tr><tr><td>NIO</td><td>éé˜»å¡</td><td>æ˜¯</td><td>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¯·æ±‚</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="2-ç¤ºæ„å›¾è¯´æ˜åŒºåˆ«">2. ç¤ºæ„å›¾è¯´æ˜åŒºåˆ«<a class="hash-link" href="#2-ç¤ºæ„å›¾è¯´æ˜åŒºåˆ«" title="Direct link to heading">â€‹</a></h3><p><img src="/assets/images/image-20220124015657528-f47cdaaea50619bdc7ebb14063281585.png" width="769" height="511"></p><p><img alt="image-20220124015747188" src="/assets/images/image-20220124015747188-b8b97155e2470da02db7f9305dec70f1.png" width="962" height="819"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ä»£ç å®æˆ˜">ä»£ç å®æˆ˜<a class="hash-link" href="#ä»£ç å®æˆ˜" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="1-bioå®æˆ˜">1. BIOå®æˆ˜<a class="hash-link" href="#1-bioå®æˆ˜" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="11-ç¼–å†™bioä»£ç ">1.1 ç¼–å†™BIOä»£ç <a class="hash-link" href="#11-ç¼–å†™bioä»£ç " title="Direct link to heading">â€‹</a></h4><blockquote><p>â€‹	ç›®çš„:  å®ç°ä¸€ä¸ªserver, æ¥å—å®¢æˆ·ç«¯å‘é€æ¥çš„æ¶ˆæ¯, å¹¶å°†æ¶ˆæ¯è¿”å›ç»™å®¢æˆ·ç«¯</p><p>â€‹    æ€è·¯:</p><ol><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ªServerSocket , å¹¶ä¸”ç»‘å®šä¸€ä¸ªæœ¬åœ°ç«¯å£9999,</li><li> ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥, ç„¶åå°†è¿æ¥äº¤ç»™çº¿ç¨‹æ± å¤„ç†</li><li> ä»inputStream é‡Œé¢è¯»å–å†…å®¹, å¹¶ä¸”å°†å†…å®¹ä½¿ç”¨outPutStreamè¿”å›ç»™å®¢æˆ·ç«¯</li></ol></blockquote><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.InputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.OutputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.InetSocketAddress;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.ServerSocket;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.Socket;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.concurrent.ExecutorService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.concurrent.Executors;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BioServerTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // å›ºå®š10ä¸ªçº¿ç¨‹,å¹¶ä¸”åˆ›å»ºç»™ä¸€ä¸ªserverSocket,å¹¶ä¸”ç»‘å®šç«¯å£</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExecutorService executorService = Executors.newFixedThreadPool(14);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ServerSocket serverSocket = new ServerSocket();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        serverSocket.bind(new InetSocketAddress(9999));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚, å¹¶å°†å®¢æˆ·ç«¯å‘é€æ¥çš„æ–‡å­—, è¿”å›ç»™å®¢æˆ·ç«¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (true) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ç­‰å¾…å…¶å®ƒå®¢æˆ·ç«¯çš„è¯·æ±‚, è®°ä½è¿™é‡Œé˜»å¡çš„,  å½“æˆ‘ä»¬å¯åŠ¨è¯¥ç¨‹åº, è¿™é‡Œçš„accept ä¼šé˜»å¡ä¸åŠ¨, ç›´åˆ°æˆåŠŸæ¥æ”¶ä¸€ä¸ªè¯·æ±‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Socket accept = serverSocket.accept();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;æ¥å—åˆ°è¯·æ±‚&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // å°†è¯·æ±‚äº¤ç»™çº¿ç¨‹æ± å¤„ç†</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            executorService.submit(new Runnable() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                public void run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    InputStream inputStream = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    OutputStream outputStream = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // ä¸åŒè¿æ¥çš„hashcode , è¯´æ˜æ˜¯æ¥è‡ªä¸åŒçš„å®¢æˆ·ç«¯çš„è¯·æ±‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    int clientHashCode = accept.hashCode();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        inputStream = accept.getInputStream();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        outputStream = accept.getOutputStream();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        byte[] bytes = new byte[1024];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        int index = inputStream.read(bytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        String s = new String(bytes, 0, index);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        System.out.println(&quot;å®¢æˆ·ç«¯:&quot; + clientHashCode + &quot;,å‘é€æ¥çš„æ¶ˆæ¯æ˜¯:&quot; + s);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        outputStream.write((&quot;serverå›å¤: &quot; + s).getBytes());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    } catch (IOException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            accept.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        } catch (IOException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="12-å¯åŠ¨ç¨‹åº">1.2 å¯åŠ¨ç¨‹åº<a class="hash-link" href="#12-å¯åŠ¨ç¨‹åº" title="Direct link to heading">â€‹</a></h4><p><img alt="image-20220124023401519" src="/assets/images/image-20220124023401519-5ff04acacb038b22dbf18519b32c9ef0.png" width="983" height="675"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="13åœ¨å‘½ä»¤è¡Œä¸­è¿æ¥å®¢æˆ·ç«¯-è§‚å¯Ÿç»“æœ">1.3	åœ¨å‘½ä»¤è¡Œä¸­è¿æ¥å®¢æˆ·ç«¯, è§‚å¯Ÿç»“æœ<a class="hash-link" href="#13åœ¨å‘½ä»¤è¡Œä¸­è¿æ¥å®¢æˆ·ç«¯-è§‚å¯Ÿç»“æœ" title="Direct link to heading">â€‹</a></h4><p><img alt="image-20220124023544496" src="/assets/images/image-20220124023544496-5c1849770a9f7daabea7ce5317eb885c.png" width="1123" height="158"></p><p>è¾“å…¥hello world ,æœŸå¾…ç»“æœè¿”å›hello world</p><p><img alt="image-20220124023633274" src="/assets/images/image-20220124023633274-889331361f9f4993d239fc87de272902.png" width="1015" height="241"></p><p>idea æœåŠ¡ç«¯çš„console å¦‚ä¸‹</p><p><img alt="image-20220124023653403" src="/assets/images/image-20220124023653403-c8ba7d7154bd76f5c5b416bde6440c6c.png" width="1127" height="227"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="2-nioå®æˆ˜">2. NIOå®æˆ˜<a class="hash-link" href="#2-nioå®æˆ˜" title="Direct link to heading">â€‹</a></h3><h4></h4><blockquote><p>â€‹	ç›®çš„:  é€šè¿‡NIO å®ç°clientå’Œserverçš„äº¤äº’</p><p>â€‹    æ€è·¯:</p><p>â€‹    Server ç«¯æ€è·¯</p><ol><li><p>é¦–å…ˆåˆ›å»ºsocketServerChannel,å’ŒSelctor, å°†channel æ³¨å†Œselector ä¸Šé¢å»</p></li><li><p>ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥, å°†å®¢æˆ·ç«¯è¿æ¥çš„channelæ³¨å†Œåˆ°selctorä¸Šé¢å», æ³¨æ„ä¸åŒçš„channelæœ‰ä¸åŒçš„äº‹ä»¶</p></li><li><p>è·å–è·å–å®¢æˆ·ç«¯channelæ‹¿åˆ°æ•°æ®</p></li></ol><p>â€‹    Client ç«¯æ€è·¯</p><ol><li>åˆ›å»ºSocketChannel, ç„¶åè¿æ¥Serverç«¯</li><li>å½“è¿æ¥å®Œæˆå, å‘Serverç«¯å‘é€æ¶ˆæ¯</li></ol></blockquote><h4 class="anchor anchorWithStickyNavbar_mojV" id="21-ç¼–å†™nioä»£ç ">2.1 ç¼–å†™NIOä»£ç <a class="hash-link" href="#21-ç¼–å†™nioä»£ç " title="Direct link to heading">â€‹</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="221-serverç«¯ä»£ç ">2.2.1 Serverç«¯ä»£ç <a class="hash-link" href="#221-serverç«¯ä»£ç " title="Direct link to heading">â€‹</a></h5><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.InetSocketAddress;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.ByteBuffer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.channels.SelectionKey;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.channels.Selector;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.channels.ServerSocketChannel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.channels.SocketChannel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Iterator;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class NIOServerDemo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        serverSocketChannel.configureBlocking(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Selector selector = Selector.open();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        serverSocketChannel.bind(new InetSocketAddress(9999));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // å°†serverSocketChannelçš„å¯æ¥å—äº‹ä»¶æ³¨å†Œåˆ°selectorä¸Šé¢,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (true) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int resultCode = selector.select(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (resultCode == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(&quot;æœåŠ¡å™¨ç­‰å¾…å§1s, æ— è¿æ¥&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            while (iterator.hasNext()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    SelectionKey selectionKey = iterator.next();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // å½“å‰äº‹ä»¶æ˜¯å¦å¯æ¥å—</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (selectionKey.isAcceptable()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        System.out.println(&quot;client è¿æ¥æˆåŠŸ&quot; + serverSocketChannel.hashCode());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // æ‹¿åˆ°æ¥å—çš„socketChannel,å°†å®¢æˆ·ç«¯channelçš„readäº‹ä»¶æ³¨å†Œåˆ°selectorä¸Šé¢å»</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        SocketChannel socketChannel = serverSocketChannel.accept();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        socketChannel.configureBlocking(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        socketChannel.register(selector, SelectionKey.OP_READ, ByteBuffer.allocate(1024));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // å½“å‰äº‹ä»¶æ˜¯å¦æ˜¯å¯è¯»äº‹ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (selectionKey.isReadable()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // ä»channelæ‹¿åˆ°æ¶ˆæ¯, å¹¶ä¸”è¯»å–å‡ºæ¥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        SocketChannel channel = (SocketChannel) selectionKey.channel();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ByteBuffer attachment = (ByteBuffer) selectionKey.attachment();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        channel.read(attachment);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        System.out.println(&quot;å—åˆ°å®¢æˆ·ç«¯ä¿¡æ¯:&quot; + new String(attachment.array()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    System.out.println(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // æœ€å¥½åˆ«å¿˜äº†ç§»å‡ºkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    iterator.remove();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="222-clientç«¯ä»£ç ">2.2.2 Clientç«¯ä»£ç <a class="hash-link" href="#222-clientç«¯ä»£ç " title="Direct link to heading">â€‹</a></h5><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.InetSocketAddress;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.ByteBuffer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.channels.SocketChannel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.charset.StandardCharsets;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * socket clilent è¿æ¥server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class NIOClientDemo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // åˆ›å»ºSocketChannel, å¹¶ä¸”è¿æ¥æœ¬åœ°9999 ç«¯å£</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SocketChannel socketChannel = SocketChannel.open();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        InetSocketAddress inetSocketAddress = new InetSocketAddress(&quot;192.168.31.31&quot;, 9999);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        socketChannel.configureBlocking(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!socketChannel.connect(inetSocketAddress)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            while (!socketChannel.finishConnect()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(&quot;è¿æ¥éœ€è¦æ—¶é—´&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;è¿æ¥serveræˆåŠŸ&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // å‘serverç«¯å‘é€æ¶ˆæ¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String str = &quot;hello world&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ByteBuffer wrap = ByteBuffer.wrap(str.getBytes(StandardCharsets.UTF_8));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int write = socketChannel.write(wrap);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // æŒ‚èµ·ç¨‹åº</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.in.read();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="22å¯åŠ¨ç¨‹åº">2.2	å¯åŠ¨ç¨‹åº<a class="hash-link" href="#22å¯åŠ¨ç¨‹åº" title="Direct link to heading">â€‹</a></h4><p>å¯åŠ¨Server</p><p><img alt="image-20220124071414769" src="/assets/images/image-20220124071414769-baf69d9866831e710fc9e38bbcd4ff98.png" width="991" height="437"></p><p>å¯åŠ¨Client</p><p><img alt="image-20220124071513381" src="/assets/images/image-20220124071513381-7f817ef5d2d6d622cd480a3fe834cd27.png" width="969" height="281"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="23æ§åˆ¶å°è§‚å¯Ÿç»“æœ">2.3	æ§åˆ¶å°è§‚å¯Ÿç»“æœ<a class="hash-link" href="#23æ§åˆ¶å°è§‚å¯Ÿç»“æœ" title="Direct link to heading">â€‹</a></h5><p>æœŸæœ›Serverç«¯æ”¶åˆ° Client ç«¯çš„æ¶ˆæ¯</p><p><img alt="image-20220124071559323" src="/assets/images/image-20220124071559323-b81850f464e2293a8d00302727fe0705.png" width="2019" height="451"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><ol><li>é€šè¿‡ç¼–å†™BIO å’ŒNIOçš„ä»£ç å¯ä»¥å¾—å‡º, BIOæ˜¯æ¯ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¯·æ±‚, ä½†æ˜¯NIOå¯ä»¥ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚NIOæ˜¯é€šè¿‡å°†selectorçš„äº‹ä»¶æ³¨å†Œåˆ°channelä¸Šé¢, ç„¶åè½®è¯¢å¯¹åº”çš„key,å¤„ç†ä¸åŒçš„äº‹ä»¶. ä¸€ä¸ªè¿æ¥ä½¿ç”¨ä¸€ä¸ªselectçº¿ç¨‹å°±è§£å†³äº†ã€‚</li><li>åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹é¢ï¼Œ1000ä¸ªè¿æ¥éœ€è¦1000ä¸ªçº¿ç¨‹æ‰èƒ½è¿æ¥ã€‚è€ŒBIO ä¸€èˆ¬æƒ…å†µä¸‹é¢ä½¿ç”¨ ï¼ˆ2* cpuæ ¸ï¼‰+2å³å¯ï¼Œè¿™æ˜¯å› ä¸ºNIO æ˜¯éé˜»å¡çš„ï¼Œä¸å¿…ç­‰å¾…
ioé˜»å¡ï¼Œåªæœ‰å½“å†™äº‹ä»¶æ¥çš„æ—¶å€™æ‰ä¼šå¤„ç†ã€‚æ˜¾ç„¶NIOåœ¨ä½¿ç”¨å°‘æ•°çº¿ç¨‹çš„æƒ…å†µä¸‹å¯¹CPUæ—¶é—´ç‰‡ç«äº‰è¾ƒå°ï¼ŒåŒæ—¶å†…å­˜çš„å ç”¨ä¹Ÿè¾ƒå°ï¼Œéšç€ç¤¾åŒºçš„Wubfluxçš„æ¨è¿›ï¼Œåœ¨å…¨å¼‚æ­¥çš„æƒ…å†µä¸‹é¢
Webfluxèƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šæ ¸CPUå¤„ç†äº‹ä»¶ï¼Œæå‡å¹¶å‘é‡å’Œååé‡ã€‚åœ¨æ¥å£è€—æ—¶å›ºå®šIOæ—¶é—´å›ºå®šçš„æƒ…å†µä¸‹ï¼ŒNIOè™½ç„¶ä¸èƒ½æå‡æ¥å£å“åº”é€Ÿåº¦ï¼Œä½†BIOçš„ç«äº‰ç›¸å¯¹æ¥è¯´æ›´åŠ æ¿€çƒˆï¼Œæ¥å£è€—æ—¶æ³¢åŠ¨å¹…åº¦å¾ˆå¤§ï¼Œ
NIOçš„å¤„ç†æ—¶é—´ç›¸å¯¹æ¥è¯´æ›´åŠ å¹³ç¨³ï¼Œå¹¶ä¸”ååé‡æ˜¯è¿œè¿œä¼˜äºBIOã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç¤¾åŒºè¶Šæ¥è¶Šæ¨èWebfluxçš„åŸå› ã€‚ä¹Ÿå¯ä»¥å‚è€ƒæˆ‘å…ˆå‰åšè¿‡çš„ä¸€æ¬¡å‹åŠ›æµ‹è¯•ã€‚</li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/java">java</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/io">io</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/java/spring-boot-mercy-flink">Spring-boot æ•´åˆflink æ•™ç¨‹</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2021-01-12T00:00:00.000Z" itemprop="datePublished">January 12, 2021</time> Â· <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://shanjiancaofu.com/img/avtor.png" alt="jeesk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">jeesk</span></a></div><small class="avatar__subtitle" itemprop="description">java engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="flinkæ¡†æ¶flinkæ•´åˆspringboot">Flinkæ¡†æ¶ï¼šFlinkæ•´åˆspringboot<a class="hash-link" href="#flinkæ¡†æ¶flinkæ•´åˆspringboot" title="Direct link to heading">â€‹</a></h2><blockquote><p>é¦–å…ˆè¯´ä¸€ä¸‹ï¼Œ ä¸ºä»€ä¹ˆflink éœ€è¦é›†æˆflinkï¼Œ spring bootç»™æˆ‘ä»¬å¸¦æ¥äº†æ›´å¥½çš„æ¡†æ¶æ•´åˆï¼Œ åŒæ—¶ä½¿ç”¨springçš„DIå’ŒIOCï¼Œèƒ½æ›´å¥½çš„ä½¿ç”¨beanï¼Œå½“ç„¶ç›´æ¥ä½¿ç”¨spring æ•´åˆä¹Ÿæ˜¯ä¸€æ ·ã€‚åæ¥æˆ‘ä»¬ä½¿ç”¨äº†google guice æ¥æ•´åˆã€‚</p></blockquote><h4 class="anchor anchorWithStickyNavbar_mojV" id="1-å®ç°åŸç†">1. å®ç°åŸç†<a class="hash-link" href="#1-å®ç°åŸç†" title="Direct link to heading">â€‹</a></h4><p>å®ç°åŸç†ï¼Œ spring çš„å¯åŠ¨ ä¸€èˆ¬ä½¿ç”¨ <code>AnnotationConfigApplicationContext ac =  new AnnotationConfigApplicationContext(AppConfig.class);</code>   å³å¯å¯åŠ¨spring å®¹å™¨ï¼Œ å¯¹ä¹ˆspring boot å‘¢ï¼Œ çœ‹è¿‡æºç çš„äººæˆ–è®¸çŸ¥é“</p><p><code>SpringApplication.run(arge);</code>  åªéœ€è¦åœ¨å¯åŠ¨flinkä¹‹å‰å¯åŠ¨sping boot å³å¯ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="2-ä»£ç å®æˆ˜">2. ä»£ç å®æˆ˜<a class="hash-link" href="#2-ä»£ç å®æˆ˜" title="Direct link to heading">â€‹</a></h4><blockquote><p>flink æ•´åˆspring boot ä»¥åŠredission, å¹¶å°†äº‹ä»¶çš„idæ”¾å…¥redis ä¸­ï¼Œ ä»£ç åº“  <a href="https://gitee.com/imomoda/flink-sprint-boot" target="_blank" rel="noopener noreferrer">https://gitee.com/imomoda/flink-sprint-boot</a></p></blockquote><h5 class="anchor anchorWithStickyNavbar_mojV" id="1spring-boot-å¯åŠ¨å·¥å…·ç±»">1.	spring boot å¯åŠ¨å·¥å…·ç±»<a class="hash-link" href="#1spring-boot-å¯åŠ¨å·¥å…·ç±»" title="Direct link to heading">â€‹</a></h5><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication(scanBasePackages = {&quot;io.github.jeesk.flink&quot;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Import(SpringUtil.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableConfigurationProperties({RedissonProperties.class, RedisProperties.class})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SpringBootApplicationUtil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static SpringApplication springBootApplication = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static SpringApplicationBuilder springApplicationBuilder = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static synchronized void run(String[] arge) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (springBootApplication == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            StandardEnvironment standardEnvironment = new StandardEnvironment();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MutablePropertySources propertySources = standardEnvironment.getPropertySources();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            propertySources.addFirst(new SimpleCommandLinePropertySource(arge));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String startJarPath = SpringBootApplicationUtil.class.getResource(&quot;/&quot;).getPath().split(&quot;!&quot;)[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String[] activeProfiles = standardEnvironment.getActiveProfiles();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            propertySources.addLast(new MapPropertySource(&quot;systemProperties&quot;, standardEnvironment.getSystemProperties()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            propertySources.addLast(new SystemEnvironmentPropertySource(&quot;systemEnvironment&quot;, standardEnvironment.getSystemEnvironment()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (springBootApplication == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                springApplicationBuilder = new SpringApplicationBuilder(SpringBootApplicationUtil.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // è¿™é‡Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œä¼ å…¥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                springApplicationBuilder.profiles(&quot;dev&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                springApplicationBuilder.sources(SpringBootApplicationUtil.class).web(WebApplicationType.NONE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            springBootApplication = springApplicationBuilder.build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            springBootApplication.run(arge);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="2flink-job">2.	flink job<a class="hash-link" href="#2flink-job" title="Direct link to heading">â€‹</a></h5><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">package io.github.jeesk.flink;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cn.hutool.extra.spring.SpringUtil;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.github.jeesk.flink.config.SpringBootApplicationUtil;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.flink.configuration.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.flink.streaming.api.datastream.DataStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.flink.util.Collector;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.flink.walkthrough.common.entity.Alert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.flink.walkthrough.common.entity.Transaction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.flink.walkthrough.common.sink.AlertSink;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.flink.walkthrough.common.source.TransactionSource;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.data.redis.core.StringRedisTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FraudDetectionJob {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Configuration configuration = new Configuration();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (args != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            configuration.setString(&quot;args&quot;, String.join(&quot; &quot;, args));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringBootApplicationUtil.run(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DataStream&lt;Transaction&gt; transactions = env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addSource(new TransactionSource())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(&quot;transactions&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DataStream&lt;Alert&gt; alerts = transactions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .keyBy(Transaction::getAccountId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .process(new FraudDetector())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(&quot;fraud-detector&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alerts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addSink(new AlertSink())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(&quot;send-alerts&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env.execute(&quot;Fraud Detection&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static public class FraudDetector extends KeyedProcessFunction&lt;Long, Transaction, Alert&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private StringRedisTemplate redisTemplate = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void open(Configuration parameters) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // åˆå§‹åŒ–bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            super.open(parameters);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SpringBootApplicationUtil.run(parameters.getString(&quot;arge&quot;, &quot;&quot;).split(&quot; &quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            redisTemplate = SpringUtil.getBean(StringRedisTemplate.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void processElement(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Transaction transaction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Context context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Collector&lt;Alert&gt; collector) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Alert alert = new Alert();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            alert.setId(transaction.getAccountId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // å°†id æ”¾å…¥redis ä¸­</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            redisTemplate.opsForSet().add(&quot;tmpKey&quot;, String.valueOf(alert.getId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            collector.collect(alert);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="3-flink-ä½¿ç”¨logback-è¿˜æ˜¯log4j--æœ¬demo-ä½¿ç”¨çš„æ˜¯logback--éœ€è¦åšä»¥ä¸‹çš„å¤„ç†">3. flink ä½¿ç”¨logback è¿˜æ˜¯log4j,  æœ¬demo ä½¿ç”¨çš„æ˜¯Logback , éœ€è¦åšä»¥ä¸‹çš„å¤„ç†<a class="hash-link" href="#3-flink-ä½¿ç”¨logback-è¿˜æ˜¯log4j--æœ¬demo-ä½¿ç”¨çš„æ˜¯logback--éœ€è¦åšä»¥ä¸‹çš„å¤„ç†" title="Direct link to heading">â€‹</a></h5><ol><li>æœåŠ¡å™¨ç«¯å¤„ç†:    flink çš„å®‰è£…ç›®å½•ä¸‹é¢æ”¾å…¥logback çš„åŒ…ï¼Œ<code>log4j-over-slf4j-1.7.15.jar,logback-classic-1.2.3.jar,logback-core-1.2.3.jar </code> ,</li><li>ç„¶ååˆ é™¤libä¸‹é¢å…³äºlog4jçš„åŒ… <code>log4j-1.2.17.jaråŠslf4j-log4j12-1.7.15.jar</code>), å¦‚æœä¸æ‡‚è¿™äº›åŒ…çš„ä½œç”¨å¯ä»¥ä»”ç»†é˜…è¯»: <a href="https://www.jianshu.com/p/7d12a8c25a38" target="_blank" rel="noopener noreferrer">JAVA å¸¸è§æ—¥å¿—ä¾èµ–å¤„ç†ç»†èŠ‚</a>  ï¼Œ</li><li>åœ¨ä»£ç çš„pomæ–‡ä»¶é‡Œé¢æ’é™¤log4jçš„åŒ…</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;artifactId&gt;flink-java&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;version&gt;1.13.1&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;!--æ’é™¤log4j--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;exclusions&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;exclusion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;artifactId&gt;*&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/exclusion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;exclusion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/exclusion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/exclusions&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;scope&gt;provided&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;flink-streaming-java_2.12&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;version&gt;1.13.1&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;!--æ’é™¤log4j--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;exclusions&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;exclusion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;artifactId&gt;*&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;/exclusion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;exclusion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;/exclusion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/exclusions&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           &lt;scope&gt;provided&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;/dependency&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="4"><li>å¦‚æœæƒ³ä¿®æ”¹flink çš„logbackçš„æ—¥å¿—æ–‡ä»¶ ï¼Œ å¯ä»¥åœ¨flinkçš„confç›®å½•ä¸‹é¢ä¿®æ”¹ä¸‹é¢çš„ä¸‰ä¸ªæ–‡ä»¶</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">logback-console.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logback-session.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logback.xml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="3å‚è€ƒå†…å®¹">3.å‚è€ƒå†…å®¹<a class="hash-link" href="#3å‚è€ƒå†…å®¹" title="Direct link to heading">â€‹</a></h4><ul><li><p><a href="https://www.cnblogs.com/gouyg/p/storm-springboot.html" target="_blank" rel="noopener noreferrer">Stormæ¡†æ¶ï¼šStormæ•´åˆspringboot</a></p></li><li><p><a href="https://blog.csdn.net/qq_36643786/article/details/90401822" target="_blank" rel="noopener noreferrer">Flinkä½¿ç”¨logbacké¡»çŸ¥</a></p></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/java">java</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/spring-boot">spring-boot</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/flink">flink</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/java/java-log-adapter-study">JAVA å¸¸è§æ—¥å¿—ä¾èµ–å¤„ç†ç»†èŠ‚</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2020-11-01T00:00:00.000Z" itemprop="datePublished">November 1, 2020</time> Â· <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://shanjiancaofu.com/img/avtor.png" alt="jeesk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">jeesk</span></a></div><small class="avatar__subtitle" itemprop="description">java engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h4 class="anchor anchorWithStickyNavbar_mojV" id="æœ¬æ–‡å¹¶ä¸è®¾ç½®æŸä¸ªæ—¥å¿—æ¡†æ¶çš„é…ç½®åªæ˜¯ä»‹ç»å…¶ä»–æ—¥å¿—æ¡†æ¶å’Œslf4j-çš„åˆ‡æ¢ä¸æ¡¥æ¥é…åˆä½¿ç”¨">æœ¬æ–‡å¹¶ä¸è®¾ç½®æŸä¸ªæ—¥å¿—æ¡†æ¶çš„é…ç½®,åªæ˜¯ä»‹ç»å…¶ä»–æ—¥å¿—æ¡†æ¶å’Œslf4j çš„åˆ‡æ¢ä¸æ¡¥æ¥é…åˆä½¿ç”¨<a class="hash-link" href="#æœ¬æ–‡å¹¶ä¸è®¾ç½®æŸä¸ªæ—¥å¿—æ¡†æ¶çš„é…ç½®åªæ˜¯ä»‹ç»å…¶ä»–æ—¥å¿—æ¡†æ¶å’Œslf4j-çš„åˆ‡æ¢ä¸æ¡¥æ¥é…åˆä½¿ç”¨" title="Direct link to heading">â€‹</a></h4><blockquote><p> å½“ä½ çš„é¡¹ç›®ä¸­æœ‰spring ,kafka, hbase , hadoop ç­‰æ¡†æ¶çš„æ—¶å€™, æ—¥å¿—ä¾èµ–æ··ä¹±,å„ç§pomçœ¼èŠ±ç¼­ä¹±, çœ‹äº†ä¸‹é¢çš„æ–‡å­—, è®©ä½ è½»æ¾æŒæ¡å„ç§æ—¥å¿—æ¡†æ¶çš„æ··åˆä½¿ç”¨å’Œå«æ¥.</p></blockquote><h5 class="anchor anchorWithStickyNavbar_mojV" id="å„ç§åŒ…ä»‹ç»">å„ç§åŒ…ä»‹ç»<a class="hash-link" href="#å„ç§åŒ…ä»‹ç»" title="Direct link to heading">â€‹</a></h5><ol><li><p>log4j</p><ul><li><code>log4j</code> : å®ç°å’Œæ¥å£éƒ½åœ¨è¿™ä¸ªåŒ…</li></ul></li><li><p>log4j2</p><ul><li><p><code>log4j-core</code> : æ ¸å¿ƒåŒ…,æ—¥å¿—å®ç°</p></li><li><p><code>log4j-api</code> : æ—¥å¿—api</p></li></ul></li><li><p>logback</p><ul><li><p><code>logback-core</code> : logback æ ¸å¿ƒåŒ…</p></li><li><p><code>logback-classic</code> : å®ç°åŒ…,å®ç°äº†slf4j-api</p></li></ul></li><li><p>commons-logging</p><ul><li><p><code>commons-logging</code> : jclçš„åŸç”Ÿå…¨éƒ¨å†…å®¹</p></li><li><p><code>log4j-jcl</code> : jclåˆ°log4j2çš„æ¡¥æ¢ , ä½¿ç”¨jclçš„å®ç°, ä½†æ˜¯ä½¿ç”¨log4j2çš„æ¥å£</p></li><li><p><code>jcl-over-slf4j</code> ï¼šjclåˆ°slf4jçš„æ¡¥æ¢,ä½¿ç”¨slf4j çš„api, æ—¥å¿—æ‰“å° å®ç°ä½¿ç”¨jcl</p></li></ul></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ—¥å¿—æ¡†æ¶åŒ…çš„åˆ†ç±»">æ—¥å¿—æ¡†æ¶åŒ…çš„åˆ†ç±»<a class="hash-link" href="#æ—¥å¿—æ¡†æ¶åŒ…çš„åˆ†ç±»" title="Direct link to heading">â€‹</a></h2><ol><li><p>api åŒ…, è¿™ç§åŒ…åªæœ‰æ¥å£, æ¯”å¦‚slf4j-api, log4j-api ,æ¯ä¸ªæ—¥å¿—æ¡†æ¶éƒ½è¦è‡ªå·±api.</p></li><li><p>å®ç°åŒ…, æ¯”å¦‚slf4j-api çš„å®ç°æœ‰logback-classic, log4j-apiçš„å®ç°æœ‰log4j.</p></li><li><p>æ¡¥æ¥å™¨ æ—¥å¿—ç»Ÿä¸€ç®¡ç†ä½¿ç”¨slf4j, ä½†æ˜¯å®ç°ç”¨çš„jcl, æˆ–è€…jul,æˆ–è€…log4j , ä½†æ˜¯è¿™äº›å®ç°éƒ½ä¸æ˜¯slf4jçš„apiçš„å®ç°,åªèƒ½æä¾›æ¡¥æ¥å™¨,å°†slf4j æ‰“å°çš„æ—¥å¿—, äº¤ç»™å…·ä½“çš„å®ç°å»æ“ä½œ, è¿™é‡Œçš„æ¡¥æ¥å™¨ä¹Ÿå¯ä»¥å«åšé©±åŠ¨.</p></li><li><p>åˆ‡æ¢å™¨, æˆ‘éœ€è¦å°†log4j åˆ‡æ¢åˆ°Logback , è¿™ä¸ªæ—¶å€™, æˆ‘å¯ä»¥ä½¿ç”¨slf4jæä¾›çš„å‡åŒ…, æ›¿æ¢åŸæœ‰çš„å®ç°ç±», ç„¶åå°†æ—¥å¿—é‡æ–°äº¤ç»™slf4jç®¡ç†. æ¯”å¦‚, é¡¹ç›®ä½¿ç”¨çš„æ˜¯Log4j, é‚£ä¹ˆç›´æ¥ä½¿ç”¨ <code>log4j-over-slf4j</code> æ›¿æ¢log4j å³å¯. (å…¶å®åœ¨å¾ˆå¤šçš„æ–‡ç« ä¸­å¹¶æ²¡æœ‰åˆ‡æ¢å™¨è¿™ä¸ªæ¦‚å¿µ, åŒ…æ‹¬mavençš„åˆ†ç±»ä¸­, ä½†æ˜¯ä¸ºäº†åŒºåˆ†åŠŸèƒ½, è¿™é‡Œæˆ‘è¿˜æ˜¯åŒºåˆ†å‡ºæ¥äº†)</p></li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="æ¡¥æ¥å™¨åŒ…">æ¡¥æ¥å™¨åŒ…<a class="hash-link" href="#æ¡¥æ¥å™¨åŒ…" title="Direct link to heading">â€‹</a></h5><blockquote><p>ä»€ä¹ˆæ˜¯æ¡¥æ¥å™¨, å°±æ˜¯æŸä¸ªæ—¥å¿—çš„å…·ä½“å®ç°, è¦æƒ³é…åˆslf4jçš„apiä½¿ç”¨, ä½†æ˜¯åœ¨ä½¿ç”¨slf4j çš„apiçš„æ‰“å°, æ— æ³•æ‰¾åˆ°å¯¹åº”çš„å®ç°ç±»,  è¿™ä¸ªæ—¶å€™éœ€è¦ç¬¬ä¸‰æ–¹åŒ…æ¡¥æ¥ä¸€ä¸‹, å½“slf4j æ‰“å°æ—¥å¿—çš„æ—¶å€™,äº¤ç»™å…·ä½“çš„æ—¥å¿—å®ç°ç±».</p></blockquote><ol><li><p><code>slf4j-jdk14</code> ï¼šslf4jåˆ°jdk-loggingçš„æ¡¥æ¢</p></li><li><p><code>slf4j-log4j12</code> ï¼šslf4jåˆ°log4j1çš„æ¡¥æ¢</p></li><li><p><code>log4j-slf4j-impl</code> ï¼šslf4jåˆ°log4j2çš„æ¡¥æ¢</p></li><li><p><code>logback-classic</code> ï¼šslf4jåˆ°logbackçš„æ¡¥æ¢</p></li><li><p><code>slf4j-jcl</code> ï¼šslf4jåˆ°commons-loggingçš„æ¡¥æ¢</p></li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="åˆ‡æ¢å™¨åŒ…-å·å¤©æ¢æ—¥-slf4j-æä¾›äº†å…¶ä»–æ—¥å¿—çš„åŒ…-æ›¿æ¢äº†åŸæ¥çš„ç¨‹åº-ç›´æ¥å°†æ—¥å¿—äº¤ç»™äº†slf4jç®¡ç†-å¹¶ä¸”ä¸éœ€è¦æ›´æ”¹ä»£ç -ä½†æ˜¯jul-é™¤å¤–">åˆ‡æ¢å™¨åŒ…( å·å¤©æ¢æ—¥, slf4j æä¾›äº†å…¶ä»–æ—¥å¿—çš„åŒ…, æ›¿æ¢äº†åŸæ¥çš„ç¨‹åº, ç›´æ¥å°†æ—¥å¿—äº¤ç»™äº†slf4jç®¡ç†, å¹¶ä¸”ä¸éœ€è¦æ›´æ”¹ä»£ç . ä½†æ˜¯jul é™¤å¤–)<a class="hash-link" href="#åˆ‡æ¢å™¨åŒ…-å·å¤©æ¢æ—¥-slf4j-æä¾›äº†å…¶ä»–æ—¥å¿—çš„åŒ…-æ›¿æ¢äº†åŸæ¥çš„ç¨‹åº-ç›´æ¥å°†æ—¥å¿—äº¤ç»™äº†slf4jç®¡ç†-å¹¶ä¸”ä¸éœ€è¦æ›´æ”¹ä»£ç -ä½†æ˜¯jul-é™¤å¤–" title="Direct link to heading">â€‹</a></h5><blockquote><p>ä»€ä¹ˆæ˜¯åˆ‡æ¢å™¨, å°±æ˜¯å½“ä¸€ä¸ªæ¨¡å—ä½¿ç”¨äº†ä»–è‡ªå·±çš„æ—¥å¿—å®ç°å’Œapi , ä½†æ˜¯æƒ³å°†æ—¥å¿—çš„è¾“å‡ºäº¤ç»™slf4j ç®¡ç†. è¿™ä¸ªæ—¶å€™éœ€è¦ä¸€ä¸ªåˆ‡æ¢å™¨å°†ç¬¬ä¸‰æ–¹æ¨¡å—çš„æ—¥å¿—åˆ‡æ¢åˆ°slf4j.</p></blockquote><ol><li><p><code>jul-to-slf4j</code> ï¼šjdk-loggingåˆ°slf4jçš„æ¡¥æ¢, å°†jul æ—¥å¿—äº¤ç»™slf4jç®¡ç†, è¿™ä¸ªåŒ…ä¸èƒ½å’Œslf4j-jdk14 å…±å­˜, å¦åˆ™ä¼šå¯¼è‡´æ— é™å¾ªç¯.</p></li><li><p><code>jcl-over-slf4j</code> ï¼šcommons-loggingåˆ°slf4jçš„æ¡¥æ¢,commons-logging.jaræ›¿æ¢ ä¸º jcl-over-slf4j.jar, å°†jclçš„æ—¥å¿—äº¤ç»™slf4jç®¡ç†.</p></li><li><p><code>slf4j-jcl.jar</code> : æˆ‘ä»¬çš„ä¸€äº›ç”¨æˆ·åœ¨åˆ‡æ¢åˆ° SLF4J API åæ„è¯†åˆ°ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒJCL çš„ä½¿ç”¨æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä»–ä»¬ä½¿ç”¨ SLF4J å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å¯¹äºè¿™ç§ä¸å¸¸è§ä½†å¾ˆé‡è¦çš„æƒ…å†µï¼ŒSLF4J æä¾›äº† JCL ç»‘å®šï¼Œå¯åœ¨æ–‡ä»¶slf4j-jcl.jar ä¸­æ‰¾åˆ°ã€‚JCL ç»‘å®šä¼šå°†é€šè¿‡ SLF4J API è¿›è¡Œçš„æ‰€æœ‰æ—¥å¿—è®°å½•è°ƒç”¨å§”æ‰˜ç»™ JCLã€‚å› æ­¤ï¼Œå¦‚æœç”±äºæŸç§åŸå› ç°æœ‰åº”ç”¨ç¨‹åºå¿…é¡» ä½¿ç”¨ JCLï¼Œé‚£ä¹ˆæ‚¨çš„åº”ç”¨ç¨‹åºéƒ¨åˆ†ä»ç„¶å¯ä»¥ä»¥å¯¹æ›´å¤§çš„åº”ç”¨ç¨‹åºç¯å¢ƒé€æ˜çš„æ–¹å¼é’ˆå¯¹ SLF4J API è¿›è¡Œç¼–ç ã€‚æ‚¨é€‰æ‹©çš„ SLF4J API å¯¹å¯ä»¥ç»§ç»­ä½¿ç”¨ JCL çš„åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†æ˜¯ä¸å¯è§çš„ã€‚ è¿™ç§æƒ…å†µä¸‹. jcl-overslf4j.jar-ä¸å¯ä¸slf4j-jcl.jar åŒæ—¶ä½¿ç”¨.</p></li><li><p><code>log4j-over-slf4j</code> ï¼šlog4j1åˆ°slf4jçš„æ¡¥æ¢, è€Œåªéœ€å°†log4j.jaræ–‡ä»¶æ›¿æ¢ä¸º log4j-over-slf4j.jar.</p></li><li><p><code>log4j-to-slf4j</code> log4j2 åˆ°slf4jçš„æ¡¥æ¢, å°†log4j2çš„æ—¥å¿—ç§»äº¤ç»™slf4j, åŸæ–‡ <a href="https://logging.apache.org/log4j/2.x/log4j-to-slf4j/index.html" target="_blank" rel="noopener noreferrer">åŸæ–‡</a>.</p></li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="æ—¥å¿—æ–¹æ¡ˆ">æ—¥å¿—æ–¹æ¡ˆ:<a class="hash-link" href="#æ—¥å¿—æ–¹æ¡ˆ" title="Direct link to heading">â€‹</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="ç›´æ¥ä½¿ç”¨apiå’Œå®ç°">ç›´æ¥ä½¿ç”¨apiå’Œå®ç°<a class="hash-link" href="#ç›´æ¥ä½¿ç”¨apiå’Œå®ç°" title="Direct link to heading">â€‹</a></h5><ol><li><p>ç›´æ¥ä½¿ç”¨java common log æ¨¡å—: <code>use-jcl-log</code></p></li><li><p>ç›´æ¥ä½¿ç”¨log4j çš„apiå’Œå®ç° æ¨¡å—: <code>use-log4j</code></p></li><li><p>ç›´æ¥ä½¿ç”¨log4j2 çš„apiå’Œå®ç° æ¨¡å—: <code>use-log4j2-impl-and-log4j2-api</code></p></li><li><p>ç›´æ¥ä½¿ç”¨jdk-logging å®ç°å’Œapi æ¨¡å—: <code>use-jdk-logging</code></p></li><li><p>ç›´æ¥ä½¿ç”¨slf4j-apiå’Œslf4j-simpleç®€å•çš„æ—¥å¿—å®ç° æ¨¡å—: <code>slf4j-sample-impl</code></p></li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="ä½¿ç”¨slf4jè‡ªå¸¦">ä½¿ç”¨slf4jè‡ªå¸¦<a class="hash-link" href="#ä½¿ç”¨slf4jè‡ªå¸¦" title="Direct link to heading">â€‹</a></h5><ol><li><p>ä½¿ç”¨slf4jçš„api,æ²¡æœ‰ä»»ä½•å®ç° æ¨¡å—: <code>nologImpl</code></p></li><li><p>ä½¿ç”¨slf4jçš„api, å¹¶ä¸”åŒæ—¶ä½¿ç”¨slf4f-nop,å’Œslf4j-sample å®ç° æ¨¡å—: <code>multilogImpl</code></p></li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="ä½¿ç”¨ç¬¬ä¸‰æ–¹å®ç°-å’Œslf4j-çš„api">ä½¿ç”¨ç¬¬ä¸‰æ–¹å®ç° å’Œslf4j çš„api<a class="hash-link" href="#ä½¿ç”¨ç¬¬ä¸‰æ–¹å®ç°-å’Œslf4j-çš„api" title="Direct link to heading">â€‹</a></h5><ol><li><p>ä½¿ç”¨log4j çš„å®ç°,ç»“åˆslf4j çš„api æ¨¡å—: <code>user-log4jImpl-and-slf4japi</code></p></li><li><p>ä½¿ç”¨jdkçš„å®ç°,ç»“åˆslf4j çš„api æ¨¡å—: <code>use-jdk-logging-imple-and-sl4j-api</code></p></li><li><p>ä½¿ç”¨ jcl æ—¥å¿—å®ç°,ç»“åˆslf4jçš„api æ¨¡å—: <code>use-jcl-imple-and-slf4j-api</code></p></li><li><p>ä½¿ç”¨logbackçš„æ—¥å¿—å®ç°,ç»“åˆslf4jçš„api æ¨¡å—: <code>use-logback-imple-and-slf4j-api</code></p></li><li><p>ä½¿ç”¨log4j2 çš„æ—¥å¿—å®ç°,ç»“åˆslf4j çš„api æ¨¡å—: <code>use-log4j2-imple-and-slf4j-api</code></p></li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="æ—¥å¿—åˆ‡æ¢å™¨å¼•ç”¨çš„æ¨¡å—ä½¿ç”¨äº†è‡ªå·±çš„æ—¥å¿—å®ç°å’Œapi-å°†æ—¥å¿—è¾“å‡ºåˆ‡æ¢åˆ°slf4j-ä¸Šé¢-é¡¹ç›®ä¸­å¸¸ç”¨å¸¸è§ä¾èµ–å¤„ç†">æ—¥å¿—åˆ‡æ¢å™¨,å¼•ç”¨çš„æ¨¡å—ä½¿ç”¨äº†è‡ªå·±çš„æ—¥å¿—å®ç°å’Œapi, å°†æ—¥å¿—è¾“å‡ºåˆ‡æ¢åˆ°slf4j ä¸Šé¢ (é¡¹ç›®ä¸­å¸¸ç”¨,å¸¸è§ä¾èµ–å¤„ç†)<a class="hash-link" href="#æ—¥å¿—åˆ‡æ¢å™¨å¼•ç”¨çš„æ¨¡å—ä½¿ç”¨äº†è‡ªå·±çš„æ—¥å¿—å®ç°å’Œapi-å°†æ—¥å¿—è¾“å‡ºåˆ‡æ¢åˆ°slf4j-ä¸Šé¢-é¡¹ç›®ä¸­å¸¸ç”¨å¸¸è§ä¾èµ–å¤„ç†" title="Direct link to heading">â€‹</a></h5><ol><li><p>jcl åˆ‡æ¢åˆ° slf4j , æœ€ç»ˆç”±logback æ‰“å° æ¨¡å—: <code>remove-common-logging-use-slf4j</code></p></li><li><p>log4j åˆ‡æ¢åˆ° slf4j ,æœ€ç»ˆç”±logback æ‰“å° æ¨¡å—: <code>remove-log4j-use-slf4j-and-use-logback-impl</code></p></li><li><p>jdk logging åˆ‡æ¢åˆ° slf4j,æœ€ç»ˆç”±logback æ‰“å° æ¨¡å—: <code>remove-jdk-loggin-use-slf4j-and-logback-impl</code></p></li></ol><blockquote><p>ç”±äºä½œè€…æ°´å¹³æœ‰é™, å‡ºç°çš„é”™è¯¯è¯·å¤šå¤šåŒ…å«. çƒ¦è¯·æŒ‡ç‚¹ä¸€äºŒ.</p></blockquote><p>æœ¬æ–‡ç®€ä¹¦åœ°å€: <a href="https://www.jianshu.com/p/7d12a8c25a38" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/7d12a8c25a38</a>
å…¨æ–‡ä¾‹å­å¦‚ä¸‹: <a href="https://gitee.com/imomoda/log4-study" target="_blank" rel="noopener noreferrer">https://gitee.com/imomoda/log4-study</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/java">java</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/log">log</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/java/kafka-msg-keep-ordered">kafkaæ¶ˆæ¯é¡ºåºä¿æŒä¸€è‡´æ€§çš„å¤„ç†æ–¹å¼</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-05-01T00:00:00.000Z" itemprop="datePublished">May 1, 2019</time> Â· <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://shanjiancaofu.com/img/avtor.png" alt="jeesk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">jeesk</span></a></div><small class="avatar__subtitle" itemprop="description">java engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote><p>ç”±äºkafka çš„åˆ†åŒºæ˜¯ç‰©ç†éš”ç¦»ï¼Œæ‰€æœ‰åªæœ‰è®©åˆ†åŒºä¿æŒé¡ºåºæ¶ˆè´¹ã€‚åœ¨æˆ‘ä»¬çš„å¹¿å‘Šä¸šåŠ¡ä¸­ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯è®©æŸä¸ªå¹¿å‘Šä½ä¸‹é¢çš„æ•°æ®ä¿æŒåˆ†åŒºä¸€è‡´æ€§å³å¯ã€‚</p></blockquote><ol><li>æŒ‡å®špartitionKey , å¹¶ä¸”ä¸€ä¸ªpartitionä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kafkaProducer.send(new ProducerRecord&lt;&gt;(&quot;fad-service-show&quot;, 1,id + &quot;&quot;, id + &quot;&quot;));</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯topic, ç¬¬äºŒä¸ªå‚æ•°æ˜¯partion.
ä¸Šé¢çš„æ¶ˆæ¯å°†ä¼šåˆ†å‘åˆ°  fad-service-show-1 çš„partitionä¸­å»,
åœ¨kafka consumer çš„</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; 8; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                listTP.add(new TopicPartition(&quot;fad-service-show&quot;, i));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        consumer.assign(listTP);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ä¸Šé¢çš„consumer å¯ä»¥æŒ‡å®šè®¢é˜…consumerçš„partition.
2. broker å®•æœºå, partitionçš„æ•°é‡ä¸ä¼šå‡å°‘, ä¹Ÿä¸ä¼šå½±å“partitionKeyçš„sharding. æ‰€ä»¥è¯´, å¦‚æœè¯´å¦‚æœä¸€ä¸ªtopic , nä¸ªpartition, ä½¿ç”¨é¡ºåºæ¶ˆè´¹ç›´æ¥æŒ‡å®špartitionå³å¯.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/java">java</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/di">DI</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/ioc">IOC</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/java/webflux-vs-servlet3.0-pressure-test">webflux,kakfa,redis,protostuff ååé‡ä¼˜åŒ–è¿‘4000QPS</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-03-04T00:00:00.000Z" itemprop="datePublished">March 4, 2019</time> Â· <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://shanjiancaofu.com/img/avtor.png" alt="jeesk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">jeesk</span></a></div><small class="avatar__subtitle" itemprop="description">java engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>__</p><ol><li>åœ¨è™šæ‹Ÿæœº 8c32g  ,ä¸€ä¸ªtomcat å®ç°400~500 çš„å¹¶å‘, 3000QPS å·²ç»å¿«æ˜¯æé™, ç”±äºæ˜¯é˜»å¡å¼ç¼–ç¨‹, å¯¼è‡´å“åº”æ—¶é•¿çš„çš„å‡å€¼å’Œæœ€å€¼å·®è·ç›¸å½“çš„å¤§.  é€šè¿‡webflux å¯ä»¥å¢åŠ å¹¶å‘é‡, åŒæ—¶ååé‡æœ‰æ‰€æ”¹å–„.</li></ol><p>ä¸‹é¢æ˜¯é€šè¿‡jvm è°ƒä¼˜å, ä¸åŒçš„webæ¶æ„çš„å‹åŠ›æµ‹è¯•å›¾.
æœºå™¨:  å†…ç½‘ä¸‹ 8c32gè™šæ‹Ÿæœº , 1å°å‹æµ‹æœºå™¨, 1å°æœåŠ¡.  å±äºç›´è¿å‹æµ‹, æœªç»è¿‡ç½‘å…³.
ä¸‹é¢æ˜¯å‹æµ‹ç»“æœ.
<img alt="img.png" src="/assets/images/img-9a42c4e1ae2b1142949c1ce32753ed07.png" width="1200" height="437"></p><ol><li>webflux çš„ååé‡ é«˜äºä¼ ç»Ÿservlet çš„åŒæ­¥io,å¤§çº¦åœ¨ %10~15çš„æ•ˆæœ</li><li>webflux  çš„è€—æ—¶ç›¸å¯¹äºä¼ ç»Ÿservletæ›´åŠ å‡åŒ€</li><li>è€—æ—¶æ”¹å–„ä¸å°‘.</li></ol><p>æ€»ä½“æ¥è¯´, å…¨å¼‚æ­¥çš„webflux ç¡®å®æ¯”ä¼ ç»Ÿçš„servlet  è¦ä¼˜ç§€ä¸å°‘.</p><p>jvm è°ƒä¼˜å‚æ•°ç›¸å…³  ä½¿ç”¨g1åƒåœ¾åƒåœ¾å›æ”¶,æ¯”è¾ƒæ¿€è¿›. å¯¹äºwebflux æ¥è¯´æ•ˆæœä¼˜åŒ–ç‰¹åˆ«å¥½.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">--server.port=8081 -Xms8g -Xmx8g -Xmn4g -XX:+UseG1GC -XX:G1HeapRegionSize=16m -XX:G1ReservePercent=25 -XX:InitiatingHeapOccupancyPercent=30 -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=30m -Xloggc:/dev/shm/mq_gc_%mxs.log</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/java">java</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/webflux">webflux</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/servlet">servlet</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/java/java-opt-note">java æ€§èƒ½ä¼˜åŒ–ç¬”è®°</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-02-24T00:00:00.000Z" itemprop="datePublished">February 24, 2019</time> Â· <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://shanjiancaofu.com/img/avtor.png" alt="jeesk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">jeesk</span></a></div><small class="avatar__subtitle" itemprop="description">java engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>æŒ‡æ ‡:</p><ol><li>æ€§èƒ½æŒ‡æ ‡: ååé‡,å“åº”é€Ÿåº¦</li><li>å“åº”æ—¶é—´: å¹³å‡å“åº”æ—¶é—´, ç™¾åˆ†æ•°</li><li>å¹¶å‘é‡</li><li>ç§’å¼€ç‡</li><li>æ­£ç¡®æ€§</li></ol><p>linux ç³»ç»Ÿ
top - 1:
us: ç”¨æˆ·çš„æ€æ‰€å ç™¾åˆ†æ¯”
sy: ç³»ç»Ÿæ€æ‰€å ç™¾åˆ†æ¯”
ni: é«˜ä¼˜å…ˆçº§åº”ç”¨æ‰€å ç™¾åˆ†æ¯”
id: cpu ç©ºé—²ç™¾åˆ†æ¯”
hi: ç¡¬ä¸­æ–­ç™¾åˆ†æ¯”
si: è½¯ä¸­æ–­ç™¾åˆ†æ¯”
st: å®¿ä¸»æœºé˜Ÿè™šæ‹Ÿæœºçš„å½±å“
wa: io ç­‰å¾…ç£ç›˜,å†™å…¥å†™å‡º</p><p>load average:  è¡¨ç¤º1 åˆ†é’Ÿ, 5 åˆ†é’Ÿ 15 åˆ†é’Ÿçš„è´Ÿè½½</p><p>vmstat :
vmstat  3  60 , è¡¨ç¤º3ç§’åˆ·æ–°ä¸€æ¬¡, æŒç»­60ç§’
b åˆ—è¯»å†™ç£ç›˜
si/so:  äº¤æ¢åˆ†åŒºå¯¹æ€§èƒ½çš„å½±å“
cs:  ä¸Šä¸‹æ–‡åˆ‡æ¢</p><p>æŸ¥çœ‹å†…å­˜ä¿¡æ¯: /proc/meminfo
æŸ¥çœ‹CPUä¿¡æ¯: /proc/cpuinfo
jvm é¢„å…ˆåˆ†é…å†…å­˜: -XX:+AlwaysPreTouch
ä½¿ç”¨nmon å·¥å…·:  måŠ å…¥å†…å­˜,cåŠ å…¥cpu,n åŠ å…¥ç½‘ç»œ,dåŠ å…¥ç£ç›˜</p><p>-Dcom.sun.management.jmxremote.port=14000
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false</p><p>æ€§èƒ½çš„å‡ ä¸ªæµ‹è¯•å·¥å…·:
nmon : ç³»ç»Ÿæ€§èƒ½
jconsole / visualVm : java çº¿ç¨‹
jcmd : java åº”ç”¨è¯¦ç»†æ•°æ®
arthas: å•ä¸ªè¯·æ±‚é“¾çš„è¯¦æƒ…
wrk: å‹åŠ›æµ‹è¯•
2 ä¸ªçº¿ç¨‹. 100 ä¸ªè¿æ¥   æŒç»­10 s
wrk -t2 -c10 -d10s <a href="http://qf.csmxwl.com/fund/index/dj" target="_blank" rel="noopener noreferrer">http://qf.csmxwl.com/fund/index/dj</a></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[root@ggpt06 wrk]# ./wrk -t2 -c20 -d3s http://qf.csmxwl.com/fund/index/dj   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Running 3s test @ http://qf.csmxwl.com/fund/index/dj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2 threads and 20 connections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Thread Stats   Avg      Stdev     Max   +/- Stdev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Latency     1.32s   639.51ms   1.83s    75.00%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Req/Sec     1.00      0.82     2.00     42.86%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  7 requests in 3.00s, 415.46KB read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Socket errors: connect 0, read 0, write 0, timeout 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Requests/sec:      2.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Transfer/sec:    138.37KB</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>12 threads and 100 connections:
æ€»å…±æ˜¯12ä¸ªçº¿ç¨‹,100ä¸ªè¿æ¥(ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªè¿æ¥)
latencyå’ŒReq/Sec:
ä»£è¡¨å•ä¸ªçº¿ç¨‹çš„ç»Ÿè®¡æ•°æ®,latencyä»£è¡¨å»¶è¿Ÿæ—¶é—´,Req/Secä»£è¡¨å•ä¸ªçº¿ç¨‹æ¯ç§’å®Œæˆçš„è¯·æ±‚æ•°ï¼Œä»–ä»¬éƒ½å…·æœ‰å¹³å‡å€¼, æ ‡å‡†åå·®, æœ€å¤§å€¼, æ­£è´Ÿä¸€ä¸ªæ ‡å‡†å·®å æ¯”ã€‚ä¸€èˆ¬æˆ‘ä»¬æ¥è¯´æˆ‘ä»¬ä¸»è¦å…³æ³¨å¹³å‡å€¼å’Œæœ€å¤§å€¼. æ ‡å‡†å·®å¦‚æœå¤ªå¤§è¯´æ˜æ ·æœ¬æœ¬èº«ç¦»æ•£ç¨‹åº¦æ¯”è¾ƒé«˜. æœ‰å¯èƒ½ç³»ç»Ÿæ€§èƒ½æ³¢åŠ¨å¾ˆå¤§.
23725 requests in 30.05s, 347.47MB read
åœ¨30ç§’ä¹‹å†…æ€»å…±æœ‰23725ä¸ªè¯·æ±‚,æ€»å…±è¯»å–347.47MBçš„æ•°æ®
Socket errors: connect 0, read 48, write 0, timeout 50
æ€»å…±æœ‰48ä¸ªè¯»é”™è¯¯,50ä¸ªè¶…æ—¶.
Requests/secå’ŒTransfer/sec
æ‰€æœ‰çº¿ç¨‹å¹³å‡æ¯ç§’é’Ÿå®Œæˆäº†789.57ä¸ªè¯·æ±‚,æ¯ç§’é’Ÿè¯»å–11.56MBæ•°æ®é‡</p><p>Guava :
weakValue,weakKey
å½“æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨ï¼Œä¸ key æˆ–è€… value æœ‰å…³ç³»æ—¶ï¼Œå°±åˆ æ‰æ•´ä¸ªç¼“å­˜é¡¹ã€‚è¿™ä¸¤ä¸ªå‡½æ•°ç»å¸¸è¢«è¯¯è§£ã€‚</p><ol><li>maxumumSize</li><li>initalCapacity</li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/java">java</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/opt">opt</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/java/java-threadpool-config-opt-adivse">ThreadPoolExecutorå‚æ•°è¯¦è§£å’Œä¼˜åŒ–å»ºè®®</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-02-03T00:00:00.000Z" itemprop="datePublished">February 3, 2019</time> Â· <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://shanjiancaofu.com/img/avtor.png" alt="jeesk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">jeesk</span></a></div><small class="avatar__subtitle" itemprop="description">java engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            20,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TimeUnit.MINUTES,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new SynchronousQueue&lt;Runnable&gt;(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new ThreadFactory() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                public Thread newThread(Runnable r) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return new Thread();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new RejectedExecutionHandler() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>æŒ‰ç…§ä¸Šé¢å‚æ•°é¡ºåºè®²è§£</p><ol><li>$\color{#FF0000}{corePoolSize æ ¸å¿ƒçº¿ç¨‹æ± æ•°é‡ }$</li></ol><ul><li>åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™æ²¡æœ‰çº¿ç¨‹, å½“æäº¤ä»»åŠ¡çš„æ—¶å€™ä¼šé™†ç»­åˆ›å»ºçº¿ç¨‹, å½“corePoolSize æ»¡çš„æ—¶å€™, ä¼šå°†ä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ä¸­å», é˜Ÿåˆ—æ»¡äº†, é‚£ä¹ˆä¼šç»§ç»­åˆ›å»º corePoolIsze åˆ°maxPoolSizeä¹‹é—´çš„çº¿ç¨‹ .</li><li>è®¾ç½®allowCoreThreadTimeout=trueï¼ˆé»˜è®¤falseï¼‰æ—¶ï¼Œæ ¸å¿ƒçº¿ç¨‹ä¼šè¶…æ—¶å…³é—­</li><li>prestartAllCoreThread  æˆ–è€…prestartAllCoreThread åˆå§‹åŒ–æ ¸å¿ƒçº¿ç¨‹</li></ul><ol start="2"><li>$\color{#FF0000}{maxPoolSizeæœ€å¤§çº¿ç¨‹æ± æ•°é‡}$</li></ol><ul><li>å½“çº¿ç¨‹æ•°é‡ = maxPoolSize , ä¸”ä»»åŠ¡é˜Ÿåˆ—å·²ç»æ»¡äº†,  çº¿ç¨‹æ± ä¼šæ‹’ç»ä»»åŠ¡æŠ›å‡ºä¸€åœº</li><li>æˆ‘ä»¬çš„é¡¹ç›® è¿™ä¸ªå‚æ•°æ˜¯ Runtime.getRuntime().availableProcessors() * 4 +1 , æ ¹æ®å‹åŠ›æµ‹è¯•è·å¾—æœ€å¥½çš„æœ€å¤§æ ¸å¿ƒæ•°é‡</li></ul><ol start="3"><li>$\color{#FF0000}{keepAliveTime  çº¿ç¨‹ç©ºé—²æ—¶é—´}$</li></ol><ul><li>ç©ºé—²çš„çº¿ç¨‹èƒ½å¤Ÿä¿æŒç©ºé—²çš„æ—¶é—´, è¶…è¿‡è¿™ä¸ªæ—¶é—´, è¿™ä¸€éƒ¨åˆ†çº¿ç¨‹å°†è¢«å›æ”¶.</li><li>æ ¸å¿ƒçº¿ç¨‹åˆ°æœ€å¤§çº¿ç¨‹æ•°é‡çš„å·®å¼‚, å¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰, é‚£ä¹ˆè¿™ä¸ªå‚æ•°æ¯«æ— æ„ä¹‰.</li></ul><ol start="4"><li>$\color{#FF0000}{BlockingQueue é˜»å¡é˜Ÿåˆ—}$</li></ol><ul><li>å½“æ ¸å¿ƒçº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§æ—¶ï¼Œæ–°ä»»åŠ¡ä¼šæ”¾åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œ</li><li>å¸¸è§çš„é˜Ÿåˆ—<ol><li>ArrayBlockingQueueï¼š æœ‰ç•Œé˜Ÿåˆ—ï¼ŒåŸºäºæ•°ç»„ç»“æ„ï¼ŒæŒ‰ç…§é˜Ÿåˆ—FIFOåŸåˆ™å¯¹å…ƒç´ æ’åºï¼›</li><li>LinkedBlockingQueueï¼šæ— ç•Œé˜Ÿåˆ—ï¼ŒåŸºäºé“¾è¡¨ç»“æ„ï¼ŒæŒ‰ç…§é˜Ÿåˆ—FIFOåŸåˆ™å¯¹å…ƒç´ æ’åºï¼ŒExecutors.newFixedThreadPool()ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—</li><li>SynchronousQueue åŒæ­¥é˜Ÿåˆ—, è¯¥é˜Ÿåˆ—ä¸å­˜å‚¨å…ƒç´ ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¼šä¸€ç›´è¢«é˜»å¡ï¼ŒExecutors.newCachedThreadPool()ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ï¼›</li><li>PriorityBlockingQueueï¼šä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå…·æœ‰ä¼˜å…ˆçº§çš„æ— é™é˜»å¡é˜Ÿåˆ—ã€‚</li></ol></li></ul><p>6  .   $\color{#FF0000}{ThreadFactory çº¿ç¨‹å·¥å‚}$</p><ul><li>è‡ªå®šä¹‰çº¿ç¨‹çš„åå­—,daemon,ä¼˜å…ˆçº§ç­‰</li></ul><ol start="7"><li>$\color{#FF0000}{rejectedExecutionHandler æ‹’ç»ç­–ç•¥}$</li></ol><ul><li>è¿™é‡Œçš„æ‹’ç»å¯ä»¥é‡‡å–ä½ è‡ªå®šä¹‰çš„åŠæ³•, æ¯”å¦‚ä½¿ç”¨second çº¿ç¨‹æ± å¤„ç† r , æˆ–è€…ä¸¢å¼ƒr, æˆ–è€…æ‰“å°å‡ºæ—¥å¿—, å–å†³äºä½ çš„ä¸šåŠ¡.</li><li>çº¿ç¨‹æ± æ‰§è¡Œæ‹’ç»çš„ä¸¤ç§æƒ…å†µ<ol><li>å½“çº¿ç¨‹æ•°é‡è¾¾åˆ°maxPoolSize , é˜Ÿåˆ—å·²ç»æ»¡äº†, ä¼šæ‹’ç»æ–°ä»»åŠ¡</li><li>å½“çº¿ç¨‹æ± è°ƒç”¨shutdown çš„æ—¶å€™, ä¼šç­‰å¾…çº¿ç¨‹æ± çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•, å†shutdown, è¿™æ˜¯ä¸€ç§ä¼˜é›…çš„æ–¹å¼.  è°ƒç”¨shutdownå’Œshutdownå…³é—­ä¹‹å‰, è¿™æ®µæ—¶é—´ä¼šæ‹’ç»æ–°ä»»åŠ¡. shutdownNow, ä¼šç«‹åˆ»å…³é—­, å¹¶ä¸”åœæ­¢æ‰§è¡Œä»»åŠ¡. å’Œshutdown æœ‰å¾ˆå¤§åŒºåˆ«.</li></ol></li><li>å‡ ç§æ‹’ç»ç­–ç•¥<ol><li>AbortPolicy ä¸¢å¼ƒä»»åŠ¡, æŠ›è¿è¡Œå¼‚å¸¸(å¦‚æœä¸è®¾ç½®, é»˜è®¤å°±æ˜¯è¿™ä¸€ä¸ªç­–ç•¥)</li><li>CallerRunsPolicy æ‰§è¡Œä»»åŠ¡</li><li>DiscardPolicy å¿½è§†ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿ</li><li>DiscardOldestPolicy ä»é˜Ÿåˆ—ä¸­è¸¢å‡ºæœ€å…ˆè¿›å…¥é˜Ÿåˆ—ï¼ˆæœ€åä¸€ä¸ªæ‰§è¡Œï¼‰çš„ä»»åŠ¡</li></ol></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="çº¿ç¨‹æ‰§è¡Œçš„ä¸€äº›æµç¨‹">çº¿ç¨‹æ‰§è¡Œçš„ä¸€äº›æµç¨‹<a class="hash-link" href="#çº¿ç¨‹æ‰§è¡Œçš„ä¸€äº›æµç¨‹" title="Direct link to heading">â€‹</a></h4><ol><li>å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›® å°äº  &lt; corePoolSize ã€‚åˆ™å¯¹äºæ¯ä¸ªæ–°ä»»åŠ¡ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡(å³ä½¿coreçº¿ç¨‹ä¸­ä¹Ÿæœ‰ç©ºé—²çº¿ç¨‹, ä¹Ÿä¼šæ–°åˆ›å»ºçº¿ç¨‹ä¼šæ‰§è¡Œ)ã€‚</li><li>å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›® å¤§äºç­‰äº &gt;= corePoolSize ã€‚
å¯¹äºæ¯ä¸ªæ–°ä»»åŠ¡ï¼Œä¼šå°†å…¶æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚è‹¥æ·»åŠ æˆåŠŸï¼Œåˆ™ä»»åŠ¡ç”±ç©ºé—²çš„çº¿ç¨‹ä¸»åŠ¨å°†å…¶ä»é˜Ÿåˆ—ä¸­ç§»é™¤åæ‰§è¡Œã€‚è‹¥æ·»åŠ å¤±è´¥ï¼ˆä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™å°è¯•åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œã€‚</li><li>è‹¥å½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®åˆ°è¾¾ maximumPoolSize ï¼Œåˆ™å¯¹äºæ–°ä»»åŠ¡é‡‡å–æ‹’ç»ç­–ç•¥ã€‚</li><li>å¦‚æœçº¿ç¨‹æ± ä¸­çš„æ•°é‡å¤§äº corePoolSize æ—¶ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTime ï¼Œçº¿ç¨‹ä¼šè¢«ç»ˆæ­¢ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®ä¸è¶…è¿‡ corePoolSize ã€‚</li><li>å¦‚æœä¸ºæ ¸å¿ƒçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è®¾ç½®å­˜æ´»æ—¶é—´ï¼Œåˆ™å½“æ ¸å¿ƒçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTime ï¼Œåˆ™è¯¥çº¿ç¨‹ä¹Ÿä¼šè¢«ç»ˆæ­¢</li><li>å¦‚æœæ ¸å¿ƒçº¿ç¨‹æ•°å·²ç»è¾¾åˆ°, å¦‚æœæ²¡æœ‰é˜Ÿåˆ—æ²¡æœ‰æ»¡çš„è¯, æ˜¯ä¸ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹. æœ‰æ—¶å€™å–å†³ä½ ä½¿ç”¨ä»€ä¹ˆé˜Ÿåˆ—. æ¯”å¦‚ä½¿ç”¨ ArrayBlockingQueue(10), å½“æ ¸å¿ƒçº¿ç¨‹å·²ç»åˆ›å»ºå®Œæˆ, åªæœ‰å½“é˜Ÿåˆ—æ»¡äº†ä¹‹åæ‰ä¼šç»§ç»­åˆ›å»ºæ–°çš„çº¿ç¨‹. å¦‚æœä½ ä½¿ç”¨çš„æ˜¯SynchronousQueue, å†…éƒ¨åªèƒ½ä¸€ä¸ªçš„é˜Ÿåˆ—,é‚£ä¹ˆåªæœ‰é˜Ÿåˆ—ç›´æ¥åˆ›å»ºcoreçº¿ç¨‹åˆ°maxpoolSize ä¹‹é—´çš„çº¿ç¨‹</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="çº¿ç¨‹æ± æ€§èƒ½ä¼˜åŒ–å»ºè®®">çº¿ç¨‹æ± æ€§èƒ½ä¼˜åŒ–å»ºè®®<a class="hash-link" href="#çº¿ç¨‹æ± æ€§èƒ½ä¼˜åŒ–å»ºè®®" title="Direct link to heading">â€‹</a></h4><ol><li>å»ºè®®ä½¿ç”¨ prestartAllCoreThread  æˆ–è€…prestartAllCoreThread åˆå§‹åŒ–æ ¸å¿ƒçº¿ç¨‹</li><li>è€ƒè™‘ allowCoreThreadTimeOut  å…è®¸æ ¸å¿ƒçº¿ç¨‹èƒ½å¤Ÿå›æ”¶èŠ‚çº¦æœºå™¨çš„ä½¿ç”¨.</li><li>æ‹’ç»ç­–ç•¥å¯ä»¥å°†ä»»åŠ¡, æäº¤ç»™ second çº¿ç¨‹æ± å¤„ç†.</li><li>è‡ªå®šä¹‰ThreadFactory ,æ ‡è¯†çº¿ç¨‹, æ–¹ä¾¿æ’æŸ¥çº¿ç¨‹çš„ä½¿ç”¨æƒ…å†µ</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="å…³äºçº¿ç¨‹å¼‚å¸¸æ˜¯å¦å¤„ç†çš„é—®é¢˜">å…³äºçº¿ç¨‹å¼‚å¸¸æ˜¯å¦å¤„ç†çš„é—®é¢˜:<a class="hash-link" href="#å…³äºçº¿ç¨‹å¼‚å¸¸æ˜¯å¦å¤„ç†çš„é—®é¢˜" title="Direct link to heading">â€‹</a></h4><ol><li>execute : å¦‚æœä¸æ‰‹åŠ¨æ•è·ä¸€åœº, çº¿ç¨‹æ± åªèƒ½é‡æ–°åˆ›å»ºæ–°çš„å¼‚å¸¸æ¥å¡«è¡¥ç©ºç™½ï¼Œé‡æ–°åˆ›å»ºçº¿ç¨‹è¿™æ˜¯æœ‰ä»£ä»·çš„</li><li>submit:   å› ä¸ºèƒ½å¤Ÿè°ƒç”¨ future.get(). æ‰€ä»¥æœ‰å¼‚å¸¸ä¹Ÿä¼šæ•è·, ä¸ä¼šé€ æˆçº¿ç¨‹ç»ˆæ­¢.</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// è¯æ˜execute çš„å¼‚å¸¸</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void test1() throws InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread.setDefaultUncaughtExceptionHandler((Thread t, Throwable e) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.warn(&quot;Exception in thread {}&quot;, t, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String prefix = &quot;test&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExecutorService threadPool = Executors.newFixedThreadPool(1, new ThreadUtil.ThreadFactoryImpl(prefix));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntStream.rangeClosed(1, 10).forEach(i -&gt; threadPool.execute(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (i == 5) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new RuntimeException(&quot;error&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;I&#x27;m done : {}&quot;, i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(Thread.currentThread().getName() + &quot; I&#x27;m done : &quot; + i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (i &lt; 5) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Assert.assertEquals(prefix + &quot;1&quot;,  Thread.currentThread().getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Assert.assertEquals(prefix + &quot;2&quot;, Thread.currentThread().getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPool.shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPool.awaitTermination(1, TimeUnit.HOURS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // æœ¬æ¥æ˜¯é€šè¿‡test 1 çº¿ç¨‹æ‰§è¡Œçš„, åé¢å‡ºç°å¼‚å¸¸ ç¡®æ˜¯test2 æ‰§è¡Œçš„, è¯´æ˜xçº¿ç¨‹å·²ç»ç»ˆæ­¢2, å¹¶ä¸”é‡æ–°åˆ›å»ºçº¿ç¨‹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// çº¿ç¨‹åç§°æ²¡æœ‰å˜, è¯´æ˜å·²ç»å¸®ä½ æ•è·å¼‚å¸¸.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String prefix = &quot;test&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExecutorService threadPool = Executors.newFixedThreadPool(1, new ThreadUtil.ThreadFactoryImpl(prefix));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;Future&gt; futures = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntStream.rangeClosed(1, 10).forEach(i -&gt; futures.add(threadPool.submit(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (i == 5) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new RuntimeException(&quot;error&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;I&#x27;m done : {}&quot;, i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            if (i &lt; 5) Assert.assertEquals(prefix + &quot;1&quot;, Thread.currentThread().getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            else Assert.assertEquals(prefix + &quot;2&quot;, Thread.currentThread().getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (Future future : futures) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                future.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (ExecutionException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.warn(&quot;future ExecutionException&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPool.shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPool.awaitTermination(1, TimeUnit.HOURS);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="é¢è¯•é—®é¢˜">é¢è¯•é—®é¢˜<a class="hash-link" href="#é¢è¯•é—®é¢˜" title="Direct link to heading">â€‹</a></h4><ol><li>è¯´è¯´çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°æœ‰å“ªäº›</li><li>è¯´è¯´ä½ ä»¬çš„corePoolSize  çš„æ•°é‡æ˜¯å¦‚ä½•è®¾ç½®,è¶…æ—¶æ—¶é—´å¦‚ä½•è®¾ç½®</li><li>ä½ ä»¬ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆé˜Ÿåˆ—,  ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªé˜Ÿåˆ—.</li><li>ä½ ä»¬é¡¹ç›®æ˜¯å¦‚ä½•ä¼˜åŒ–è‡ªå·±çš„çº¿ç¨‹æ± å‚æ•°çš„.</li><li>å½“çº¿ç¨‹æ± è¿˜æ²¡è¾¾åˆ° corePoolSize çš„æ—¶å€™, çº¿ç¨‹æ± é‡Œé¢æœ‰ç©ºé—²çº¿ç¨‹, è¿™ä¸ªæ—¶å€™æ¥äº†ä¸€ä¸ªæ–°çš„ä»»åŠ¡, çº¿ç¨‹æ± æ˜¯åˆ›å»ºæ–°çš„çº¿ç¨‹è¿˜æ˜¯ä½¿ç”¨ç©ºé—²çº¿ç¨‹ ?</li></ol><blockquote><p> è·¯è¿‡ç‚¹èµ, æœˆå…¥10w</p></blockquote></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/java">java</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/log">log</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/java/log4j-print-log">log4jæ‰“å°æ—¥å¿—çš„åŸç†</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2018-12-01T00:00:00.000Z" itemprop="datePublished">December 1, 2018</time> Â· <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://shanjiancaofu.com/img/avtor.png" alt="jeesk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">jeesk</span></a></div><small class="avatar__subtitle" itemprop="description">java engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>log4j-slf4j-impl: log4jçš„æ—¥å¿—è½¬åˆ°slf4jä¸Š</p><p>LoggerFactory.getLogger () æ–¹æ³• å¯»æ‰¾å¯¹åº”çš„logger</p><p>org.slf4j.LoggerFactory#findPossibleStaticLoggerBinderPathSet
å¯»æ‰¾staticLoggerBinder</p><p>paths = loggerFactoryClassLoader.getResources(STATIC_LOGGER_BINDER_PATH);
é€šè¿‡è·¯å¾„å¯»æ‰¾æ‰€æœ‰çš„binder, è¿™é‡Œçš„STATIC_LOGGER_BINDER_PATH = org/slf4j/impl/StaticLoggerBinder.class, æ¯ä¸ªslf4jçš„å…·ä½“å®ç°ç±»éƒ½æœ‰ä¸€ä¸ªStaticLoggerBinder.class</p><p>org.slf4j.LoggerFactory#reportMultipleBindingAmbiguity
åˆ¤æ–­æ˜¯å¦æœ‰å¤šä¸ªbinder, å¦‚æœæœ‰å°†ä¼šæ‰“å°æ—¥å¿—: SLF4J: Class path contains multiple SLF4J bindings. SLF4J: Found binding in <!-- -->[jar:file:/Z:/repository/org/slf4j/slf4j-simple/1.7.28/slf4j-simple-1.7.28.jar!/org/slf4j/impl/StaticLoggerBinder.class]<!-- --> SLF4J: Found binding in <!-- -->[jar:file:/Z:/repository/org/slf4j/slf4j-nop/1.7.28/slf4j-nop-1.7.28.jar!/org/slf4j/impl/StaticLoggerBinder.class]<!-- --> SLF4J: See <a href="http://www.slf4j.org/codes.html#multiple_bindings" target="_blank" rel="noopener noreferrer">http://www.slf4j.org/codes.html#multiple_bindings</a> for an explanation.., è¿™ä¸ªæ—¥å¿—æ˜¯æˆ‘ä»¬å¸¸è§çš„, å› ä¸ºæœ‰å¤šä¸ªæ—¥å¿—å®ç°</p><p>org/slf4j/impl/StaticLoggerBinder.class, æ¯ä¸ªslf4jçš„æ—¥å¿—å®ç°éƒ½æœ‰è¿™ä¸ªç±»
æ‰¾åˆ°æ‰€æœ‰ç»‘å®šçš„logger</p><p>è°ƒç”¨ StaticLoggerBinder.getSingleton();
è¿™é‡Œå¦‚æœæœ‰å¤šä¸ªclass, åº”è¯¥æ˜¯æŒ‰é¡ºåºè°ƒç”¨ç¬¬ä¸€ä¸ªclassçš„getSingleton(),
è°ƒç”¨ reportActualBinding
æ‰“å°ç»‘å®šçš„æ˜¯å“ªä¸€ä¸ªæ—¥å¿—å®ç°
SLF4J: Actual binding is of type <!-- -->[org.slf4j.impl.SimpleLoggerFactory]<!-- -->
getILoggerFactory()
è·å¾—åˆ°åˆšæ‰StaticLoggerBinderçš„æ—¥å¿—å·¥å‚
SimpleLoggerFactory.getLogger
public Logger getLogger(String name) {
Logger simpleLogger = (Logger)this.loggerMap.get(name);
if (simpleLogger != null) {
return simpleLogger;
} else {
Logger newInstance = new SimpleLogger(name);
Logger oldInstance = (Logger)this.loggerMap.putIfAbsent(name, newInstance);
return (Logger)(oldInstance == null ? newInstance : oldInstance);
}
}
æŒ‡å®šçš„logger ä½œç¼“å­˜, ç„¶åè°ƒç”¨info() æ–¹æ³•æ‰“å°æ—¥å¿—.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/java">java</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/log">log</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Repository</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/jeesk" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitee.com/jeesk" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">GithubåŠ é€Ÿå™¨</div><ul class="footer__items"><li class="footer__item"><a href="https://toolwa.com/github/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>toolwa<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="http://shrill-pond-3e81.hunsh.workers.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>hunsh<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 å±±é—´è‰å¤«, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d6c809c7.js"></script>
<script src="/assets/js/main.0c9f8076.js"></script>
</body>
</html>