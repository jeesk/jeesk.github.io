<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/java/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/java/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/database/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/database/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/microservice/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/microservice/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/data-structure-and-algorithm/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/data-structure-and-algorithm/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/devops/rss.xml" title="å±±é—´è‰å¤«çš„å°ç«™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/devops/atom.xml" title="å±±é—´è‰å¤«çš„å°ç«™ Atom Feed"><title data-react-helmet="true">ThreadPoolExecutorå‚æ•°è¯¦è§£å’Œä¼˜åŒ–å»ºè®® | å±±é—´è‰å¤«çš„å°ç«™</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://shanjiancaofu.com/java/java-threadpool-config-opt-adivse"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="ThreadPoolExecutorå‚æ•°è¯¦è§£å’Œä¼˜åŒ–å»ºè®® | å±±é—´è‰å¤«çš„å°ç«™"><meta data-react-helmet="true" name="description" content="æŒ‰ç…§ä¸Šé¢å‚æ•°é¡ºåºè®²è§£"><meta data-react-helmet="true" property="og:description" content="æŒ‰ç…§ä¸Šé¢å‚æ•°é¡ºåºè®²è§£"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2019-02-03T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://shanjiancaofu.com"><meta data-react-helmet="true" property="article:tag" content="java,log"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://shanjiancaofu.com/java/java-threadpool-config-opt-adivse"><link data-react-helmet="true" rel="alternate" href="https://shanjiancaofu.com/java/java-threadpool-config-opt-adivse" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://shanjiancaofu.com/java/java-threadpool-config-opt-adivse" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7ec3e632.css">
<link rel="preload" href="/assets/js/runtime~main.d6c809c7.js" as="script">
<link rel="preload" href="/assets/js/main.0c9f8076.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/avtor.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/avtor.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">å±±é—´è‰å¤«</b></a><a class="navbar__item navbar__link" href="/docs/intro">æºç åˆ†æ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/java">Java</a><a class="navbar__item navbar__link" href="/devops">Devops</a><a class="navbar__item navbar__link" href="/data-structure-and-algorithm">æ•°æ®ç»“æ„ä¸ç®—æ³•</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jeesk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ğŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ğŸŒ</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">All Blog Posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/elasticsearch-user-rtb-ad">Elasticsearch åœ¨ç«ä»·å¹¿å‘Šä¸­çš„æ£€ç´¢ä½¿ç”¨</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/java-bio-diffrent-from-nio">Java BiOå’ŒNIOçš„åŒºåˆ«</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/spring-boot-mercy-flink">Spring-boot æ•´åˆflink æ•™ç¨‹</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/java-log-adapter-study">JAVA å¸¸è§æ—¥å¿—ä¾èµ–å¤„ç†ç»†èŠ‚</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/kafka-msg-keep-ordered">kafkaæ¶ˆæ¯é¡ºåºä¿æŒä¸€è‡´æ€§çš„å¤„ç†æ–¹å¼</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/webflux-vs-servlet3.0-pressure-test">webflux,kakfa,redis,protostuff ååé‡ä¼˜åŒ–è¿‘4000QPS</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/java-opt-note">java æ€§èƒ½ä¼˜åŒ–ç¬”è®°</a></li><li class="sidebarItem_CF0Q"><a aria-current="page" class="sidebarItemLink_miNk sidebarItemLinkActive_RRTD" href="/java/java-threadpool-config-opt-adivse">ThreadPoolExecutorå‚æ•°è¯¦è§£å’Œä¼˜åŒ–å»ºè®®</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/java/log4j-print-log">log4jæ‰“å°æ—¥å¿—çš„åŸç†</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">ThreadPoolExecutorå‚æ•°è¯¦è§£å’Œä¼˜åŒ–å»ºè®®</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-02-03T00:00:00.000Z" itemprop="datePublished">February 3, 2019</time> Â· <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://shanjiancaofu.com/img/avtor.png" alt="jeesk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://shanjiancaofu.com" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">jeesk</span></a></div><small class="avatar__subtitle" itemprop="description">java engineer</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            20,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TimeUnit.MINUTES,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new SynchronousQueue&lt;Runnable&gt;(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new ThreadFactory() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                public Thread newThread(Runnable r) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return new Thread();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new RejectedExecutionHandler() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>æŒ‰ç…§ä¸Šé¢å‚æ•°é¡ºåºè®²è§£</p><ol><li>$\color{#FF0000}{corePoolSize æ ¸å¿ƒçº¿ç¨‹æ± æ•°é‡ }$</li></ol><ul><li>åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™æ²¡æœ‰çº¿ç¨‹, å½“æäº¤ä»»åŠ¡çš„æ—¶å€™ä¼šé™†ç»­åˆ›å»ºçº¿ç¨‹, å½“corePoolSize æ»¡çš„æ—¶å€™, ä¼šå°†ä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ä¸­å», é˜Ÿåˆ—æ»¡äº†, é‚£ä¹ˆä¼šç»§ç»­åˆ›å»º corePoolIsze åˆ°maxPoolSizeä¹‹é—´çš„çº¿ç¨‹ .</li><li>è®¾ç½®allowCoreThreadTimeout=trueï¼ˆé»˜è®¤falseï¼‰æ—¶ï¼Œæ ¸å¿ƒçº¿ç¨‹ä¼šè¶…æ—¶å…³é—­</li><li>prestartAllCoreThread  æˆ–è€…prestartAllCoreThread åˆå§‹åŒ–æ ¸å¿ƒçº¿ç¨‹</li></ul><ol start="2"><li>$\color{#FF0000}{maxPoolSizeæœ€å¤§çº¿ç¨‹æ± æ•°é‡}$</li></ol><ul><li>å½“çº¿ç¨‹æ•°é‡ = maxPoolSize , ä¸”ä»»åŠ¡é˜Ÿåˆ—å·²ç»æ»¡äº†,  çº¿ç¨‹æ± ä¼šæ‹’ç»ä»»åŠ¡æŠ›å‡ºä¸€åœº</li><li>æˆ‘ä»¬çš„é¡¹ç›® è¿™ä¸ªå‚æ•°æ˜¯ Runtime.getRuntime().availableProcessors() * 4 +1 , æ ¹æ®å‹åŠ›æµ‹è¯•è·å¾—æœ€å¥½çš„æœ€å¤§æ ¸å¿ƒæ•°é‡</li></ul><ol start="3"><li>$\color{#FF0000}{keepAliveTime  çº¿ç¨‹ç©ºé—²æ—¶é—´}$</li></ol><ul><li>ç©ºé—²çš„çº¿ç¨‹èƒ½å¤Ÿä¿æŒç©ºé—²çš„æ—¶é—´, è¶…è¿‡è¿™ä¸ªæ—¶é—´, è¿™ä¸€éƒ¨åˆ†çº¿ç¨‹å°†è¢«å›æ”¶.</li><li>æ ¸å¿ƒçº¿ç¨‹åˆ°æœ€å¤§çº¿ç¨‹æ•°é‡çš„å·®å¼‚, å¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰, é‚£ä¹ˆè¿™ä¸ªå‚æ•°æ¯«æ— æ„ä¹‰.</li></ul><ol start="4"><li>$\color{#FF0000}{BlockingQueue é˜»å¡é˜Ÿåˆ—}$</li></ol><ul><li>å½“æ ¸å¿ƒçº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§æ—¶ï¼Œæ–°ä»»åŠ¡ä¼šæ”¾åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œ</li><li>å¸¸è§çš„é˜Ÿåˆ—<ol><li>ArrayBlockingQueueï¼š æœ‰ç•Œé˜Ÿåˆ—ï¼ŒåŸºäºæ•°ç»„ç»“æ„ï¼ŒæŒ‰ç…§é˜Ÿåˆ—FIFOåŸåˆ™å¯¹å…ƒç´ æ’åºï¼›</li><li>LinkedBlockingQueueï¼šæ— ç•Œé˜Ÿåˆ—ï¼ŒåŸºäºé“¾è¡¨ç»“æ„ï¼ŒæŒ‰ç…§é˜Ÿåˆ—FIFOåŸåˆ™å¯¹å…ƒç´ æ’åºï¼ŒExecutors.newFixedThreadPool()ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—</li><li>SynchronousQueue åŒæ­¥é˜Ÿåˆ—, è¯¥é˜Ÿåˆ—ä¸å­˜å‚¨å…ƒç´ ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¼šä¸€ç›´è¢«é˜»å¡ï¼ŒExecutors.newCachedThreadPool()ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ï¼›</li><li>PriorityBlockingQueueï¼šä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå…·æœ‰ä¼˜å…ˆçº§çš„æ— é™é˜»å¡é˜Ÿåˆ—ã€‚</li></ol></li></ul><p>6  .   $\color{#FF0000}{ThreadFactory çº¿ç¨‹å·¥å‚}$</p><ul><li>è‡ªå®šä¹‰çº¿ç¨‹çš„åå­—,daemon,ä¼˜å…ˆçº§ç­‰</li></ul><ol start="7"><li>$\color{#FF0000}{rejectedExecutionHandler æ‹’ç»ç­–ç•¥}$</li></ol><ul><li>è¿™é‡Œçš„æ‹’ç»å¯ä»¥é‡‡å–ä½ è‡ªå®šä¹‰çš„åŠæ³•, æ¯”å¦‚ä½¿ç”¨second çº¿ç¨‹æ± å¤„ç† r , æˆ–è€…ä¸¢å¼ƒr, æˆ–è€…æ‰“å°å‡ºæ—¥å¿—, å–å†³äºä½ çš„ä¸šåŠ¡.</li><li>çº¿ç¨‹æ± æ‰§è¡Œæ‹’ç»çš„ä¸¤ç§æƒ…å†µ<ol><li>å½“çº¿ç¨‹æ•°é‡è¾¾åˆ°maxPoolSize , é˜Ÿåˆ—å·²ç»æ»¡äº†, ä¼šæ‹’ç»æ–°ä»»åŠ¡</li><li>å½“çº¿ç¨‹æ± è°ƒç”¨shutdown çš„æ—¶å€™, ä¼šç­‰å¾…çº¿ç¨‹æ± çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•, å†shutdown, è¿™æ˜¯ä¸€ç§ä¼˜é›…çš„æ–¹å¼.  è°ƒç”¨shutdownå’Œshutdownå…³é—­ä¹‹å‰, è¿™æ®µæ—¶é—´ä¼šæ‹’ç»æ–°ä»»åŠ¡. shutdownNow, ä¼šç«‹åˆ»å…³é—­, å¹¶ä¸”åœæ­¢æ‰§è¡Œä»»åŠ¡. å’Œshutdown æœ‰å¾ˆå¤§åŒºåˆ«.</li></ol></li><li>å‡ ç§æ‹’ç»ç­–ç•¥<ol><li>AbortPolicy ä¸¢å¼ƒä»»åŠ¡, æŠ›è¿è¡Œå¼‚å¸¸(å¦‚æœä¸è®¾ç½®, é»˜è®¤å°±æ˜¯è¿™ä¸€ä¸ªç­–ç•¥)</li><li>CallerRunsPolicy æ‰§è¡Œä»»åŠ¡</li><li>DiscardPolicy å¿½è§†ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿ</li><li>DiscardOldestPolicy ä»é˜Ÿåˆ—ä¸­è¸¢å‡ºæœ€å…ˆè¿›å…¥é˜Ÿåˆ—ï¼ˆæœ€åä¸€ä¸ªæ‰§è¡Œï¼‰çš„ä»»åŠ¡</li></ol></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="çº¿ç¨‹æ‰§è¡Œçš„ä¸€äº›æµç¨‹">çº¿ç¨‹æ‰§è¡Œçš„ä¸€äº›æµç¨‹<a class="hash-link" href="#çº¿ç¨‹æ‰§è¡Œçš„ä¸€äº›æµç¨‹" title="Direct link to heading">â€‹</a></h4><ol><li>å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›® å°äº  &lt; corePoolSize ã€‚åˆ™å¯¹äºæ¯ä¸ªæ–°ä»»åŠ¡ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡(å³ä½¿coreçº¿ç¨‹ä¸­ä¹Ÿæœ‰ç©ºé—²çº¿ç¨‹, ä¹Ÿä¼šæ–°åˆ›å»ºçº¿ç¨‹ä¼šæ‰§è¡Œ)ã€‚</li><li>å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›® å¤§äºç­‰äº &gt;= corePoolSize ã€‚
å¯¹äºæ¯ä¸ªæ–°ä»»åŠ¡ï¼Œä¼šå°†å…¶æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚è‹¥æ·»åŠ æˆåŠŸï¼Œåˆ™ä»»åŠ¡ç”±ç©ºé—²çš„çº¿ç¨‹ä¸»åŠ¨å°†å…¶ä»é˜Ÿåˆ—ä¸­ç§»é™¤åæ‰§è¡Œã€‚è‹¥æ·»åŠ å¤±è´¥ï¼ˆä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™å°è¯•åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œã€‚</li><li>è‹¥å½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®åˆ°è¾¾ maximumPoolSize ï¼Œåˆ™å¯¹äºæ–°ä»»åŠ¡é‡‡å–æ‹’ç»ç­–ç•¥ã€‚</li><li>å¦‚æœçº¿ç¨‹æ± ä¸­çš„æ•°é‡å¤§äº corePoolSize æ—¶ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTime ï¼Œçº¿ç¨‹ä¼šè¢«ç»ˆæ­¢ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®ä¸è¶…è¿‡ corePoolSize ã€‚</li><li>å¦‚æœä¸ºæ ¸å¿ƒçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è®¾ç½®å­˜æ´»æ—¶é—´ï¼Œåˆ™å½“æ ¸å¿ƒçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTime ï¼Œåˆ™è¯¥çº¿ç¨‹ä¹Ÿä¼šè¢«ç»ˆæ­¢</li><li>å¦‚æœæ ¸å¿ƒçº¿ç¨‹æ•°å·²ç»è¾¾åˆ°, å¦‚æœæ²¡æœ‰é˜Ÿåˆ—æ²¡æœ‰æ»¡çš„è¯, æ˜¯ä¸ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹. æœ‰æ—¶å€™å–å†³ä½ ä½¿ç”¨ä»€ä¹ˆé˜Ÿåˆ—. æ¯”å¦‚ä½¿ç”¨ ArrayBlockingQueue(10), å½“æ ¸å¿ƒçº¿ç¨‹å·²ç»åˆ›å»ºå®Œæˆ, åªæœ‰å½“é˜Ÿåˆ—æ»¡äº†ä¹‹åæ‰ä¼šç»§ç»­åˆ›å»ºæ–°çš„çº¿ç¨‹. å¦‚æœä½ ä½¿ç”¨çš„æ˜¯SynchronousQueue, å†…éƒ¨åªèƒ½ä¸€ä¸ªçš„é˜Ÿåˆ—,é‚£ä¹ˆåªæœ‰é˜Ÿåˆ—ç›´æ¥åˆ›å»ºcoreçº¿ç¨‹åˆ°maxpoolSize ä¹‹é—´çš„çº¿ç¨‹</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="çº¿ç¨‹æ± æ€§èƒ½ä¼˜åŒ–å»ºè®®">çº¿ç¨‹æ± æ€§èƒ½ä¼˜åŒ–å»ºè®®<a class="hash-link" href="#çº¿ç¨‹æ± æ€§èƒ½ä¼˜åŒ–å»ºè®®" title="Direct link to heading">â€‹</a></h4><ol><li>å»ºè®®ä½¿ç”¨ prestartAllCoreThread  æˆ–è€…prestartAllCoreThread åˆå§‹åŒ–æ ¸å¿ƒçº¿ç¨‹</li><li>è€ƒè™‘ allowCoreThreadTimeOut  å…è®¸æ ¸å¿ƒçº¿ç¨‹èƒ½å¤Ÿå›æ”¶èŠ‚çº¦æœºå™¨çš„ä½¿ç”¨.</li><li>æ‹’ç»ç­–ç•¥å¯ä»¥å°†ä»»åŠ¡, æäº¤ç»™ second çº¿ç¨‹æ± å¤„ç†.</li><li>è‡ªå®šä¹‰ThreadFactory ,æ ‡è¯†çº¿ç¨‹, æ–¹ä¾¿æ’æŸ¥çº¿ç¨‹çš„ä½¿ç”¨æƒ…å†µ</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="å…³äºçº¿ç¨‹å¼‚å¸¸æ˜¯å¦å¤„ç†çš„é—®é¢˜">å…³äºçº¿ç¨‹å¼‚å¸¸æ˜¯å¦å¤„ç†çš„é—®é¢˜:<a class="hash-link" href="#å…³äºçº¿ç¨‹å¼‚å¸¸æ˜¯å¦å¤„ç†çš„é—®é¢˜" title="Direct link to heading">â€‹</a></h4><ol><li>execute : å¦‚æœä¸æ‰‹åŠ¨æ•è·ä¸€åœº, çº¿ç¨‹æ± åªèƒ½é‡æ–°åˆ›å»ºæ–°çš„å¼‚å¸¸æ¥å¡«è¡¥ç©ºç™½ï¼Œé‡æ–°åˆ›å»ºçº¿ç¨‹è¿™æ˜¯æœ‰ä»£ä»·çš„</li><li>submit:   å› ä¸ºèƒ½å¤Ÿè°ƒç”¨ future.get(). æ‰€ä»¥æœ‰å¼‚å¸¸ä¹Ÿä¼šæ•è·, ä¸ä¼šé€ æˆçº¿ç¨‹ç»ˆæ­¢.</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// è¯æ˜execute çš„å¼‚å¸¸</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void test1() throws InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread.setDefaultUncaughtExceptionHandler((Thread t, Throwable e) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.warn(&quot;Exception in thread {}&quot;, t, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String prefix = &quot;test&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExecutorService threadPool = Executors.newFixedThreadPool(1, new ThreadUtil.ThreadFactoryImpl(prefix));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntStream.rangeClosed(1, 10).forEach(i -&gt; threadPool.execute(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (i == 5) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new RuntimeException(&quot;error&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;I&#x27;m done : {}&quot;, i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(Thread.currentThread().getName() + &quot; I&#x27;m done : &quot; + i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (i &lt; 5) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Assert.assertEquals(prefix + &quot;1&quot;,  Thread.currentThread().getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Assert.assertEquals(prefix + &quot;2&quot;, Thread.currentThread().getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPool.shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPool.awaitTermination(1, TimeUnit.HOURS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // æœ¬æ¥æ˜¯é€šè¿‡test 1 çº¿ç¨‹æ‰§è¡Œçš„, åé¢å‡ºç°å¼‚å¸¸ ç¡®æ˜¯test2 æ‰§è¡Œçš„, è¯´æ˜xçº¿ç¨‹å·²ç»ç»ˆæ­¢2, å¹¶ä¸”é‡æ–°åˆ›å»ºçº¿ç¨‹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// çº¿ç¨‹åç§°æ²¡æœ‰å˜, è¯´æ˜å·²ç»å¸®ä½ æ•è·å¼‚å¸¸.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String prefix = &quot;test&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExecutorService threadPool = Executors.newFixedThreadPool(1, new ThreadUtil.ThreadFactoryImpl(prefix));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;Future&gt; futures = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntStream.rangeClosed(1, 10).forEach(i -&gt; futures.add(threadPool.submit(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (i == 5) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new RuntimeException(&quot;error&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;I&#x27;m done : {}&quot;, i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            if (i &lt; 5) Assert.assertEquals(prefix + &quot;1&quot;, Thread.currentThread().getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            else Assert.assertEquals(prefix + &quot;2&quot;, Thread.currentThread().getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (Future future : futures) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                future.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (ExecutionException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.warn(&quot;future ExecutionException&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPool.shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threadPool.awaitTermination(1, TimeUnit.HOURS);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="é¢è¯•é—®é¢˜">é¢è¯•é—®é¢˜<a class="hash-link" href="#é¢è¯•é—®é¢˜" title="Direct link to heading">â€‹</a></h4><ol><li>è¯´è¯´çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°æœ‰å“ªäº›</li><li>è¯´è¯´ä½ ä»¬çš„corePoolSize  çš„æ•°é‡æ˜¯å¦‚ä½•è®¾ç½®,è¶…æ—¶æ—¶é—´å¦‚ä½•è®¾ç½®</li><li>ä½ ä»¬ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆé˜Ÿåˆ—,  ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªé˜Ÿåˆ—.</li><li>ä½ ä»¬é¡¹ç›®æ˜¯å¦‚ä½•ä¼˜åŒ–è‡ªå·±çš„çº¿ç¨‹æ± å‚æ•°çš„.</li><li>å½“çº¿ç¨‹æ± è¿˜æ²¡è¾¾åˆ° corePoolSize çš„æ—¶å€™, çº¿ç¨‹æ± é‡Œé¢æœ‰ç©ºé—²çº¿ç¨‹, è¿™ä¸ªæ—¶å€™æ¥äº†ä¸€ä¸ªæ–°çš„ä»»åŠ¡, çº¿ç¨‹æ± æ˜¯åˆ›å»ºæ–°çš„çº¿ç¨‹è¿˜æ˜¯ä½¿ç”¨ç©ºé—²çº¿ç¨‹ ?</li></ol><blockquote><p> è·¯è¿‡ç‚¹èµ, æœˆå…¥10w</p></blockquote></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/java">java</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/java/tags/log">log</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/java/java-opt-note"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">java æ€§èƒ½ä¼˜åŒ–ç¬”è®°</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/java/log4j-print-log"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">log4jæ‰“å°æ—¥å¿—çš„åŸç†</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Repository</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/jeesk" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitee.com/jeesk" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">GithubåŠ é€Ÿå™¨</div><ul class="footer__items"><li class="footer__item"><a href="https://toolwa.com/github/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>toolwa<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="http://shrill-pond-3e81.hunsh.workers.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>hunsh<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 å±±é—´è‰å¤«, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d6c809c7.js"></script>
<script src="/assets/js/main.0c9f8076.js"></script>
</body>
</html>